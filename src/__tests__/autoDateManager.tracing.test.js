// @ts-ignore
import { describe, it } from "@jest/globals";
describe("autoDateManager - Execution Tracing", () => {
    it("should trace the exact problem with user's text", () => {
        const lineText = "- [-] 交流交底 🚀 2025-07-30 [stage::disclosure_communication] 🛫 2025-04-20 ^timer-161940-4775";
        console.log("\n=== DETAILED EXECUTION TRACE ===");
        console.log("Original line:", lineText);
        console.log("Line length:", lineText.length);
        // Step 1: Manually extract block reference
        const blockRefPattern = /\s*(\^[\w-]+)\s*$/;
        const blockRefMatch = lineText.match(blockRefPattern);
        if (blockRefMatch) {
            console.log("\n1. Block Reference Detection:");
            console.log("   - Full match:", JSON.stringify(blockRefMatch[0]));
            console.log("   - Block ID:", blockRefMatch[1]);
            console.log("   - Match index:", blockRefMatch.index);
            console.log("   - Match length:", blockRefMatch[0].length);
            const cleanedText = lineText.substring(0, blockRefMatch.index).trimEnd();
            console.log("   - Cleaned text:", JSON.stringify(cleanedText));
            console.log("   - Cleaned length:", cleanedText.length);
        }
        // Step 2: Check task pattern
        const taskMatch = lineText.match(/^[\s|\t]*([-*+]|\d+\.)\s\[.\]\s*/);
        if (taskMatch) {
            console.log("\n2. Task Pattern:");
            console.log("   - Task prefix:", JSON.stringify(taskMatch[0]));
            console.log("   - Initial position:", taskMatch[0].length);
        }
        // Step 3: Look for 🚀 emoji (configured)
        console.log("\n3. Configured Emoji Search (🚀):");
        const rocketPattern = /🚀\s*\d{4}-\d{2}-\d{2}/g;
        let match;
        while ((match = rocketPattern.exec(lineText)) !== null) {
            console.log("   - Found at index:", match.index);
            console.log("   - Match:", JSON.stringify(match[0]));
            console.log("   - End position:", match.index + match[0].length);
        }
        // Step 4: Look for 🛫 emoji (actual)
        console.log("\n4. Actual Emoji Search (🛫):");
        const planePattern = /🛫\s*\d{4}-\d{2}-\d{2}/g;
        while ((match = planePattern.exec(lineText)) !== null) {
            console.log("   - Found at index:", match.index);
            console.log("   - Match:", JSON.stringify(match[0]));
            console.log("   - End position:", match.index + match[0].length);
        }
        // Step 5: Find all metadata
        console.log("\n5. All Metadata Search:");
        const metadataPatterns = [
            { name: "Tags", pattern: /#[\w-]+/g },
            { name: "Dataview", pattern: /\[[a-zA-Z]+::[^\]]*\]/g },
            { name: "Date markers", pattern: /[📅🚀✅❌🛫▶️⏰🏁]\s*\d{4}-\d{2}-\d{2}(?:\s+\d{2}:\d{2}(?::\d{2})?)?/g }
        ];
        metadataPatterns.forEach(({ name, pattern }) => {
            console.log(`   - ${name}:`);
            pattern.lastIndex = 0;
            while ((match = pattern.exec(lineText)) !== null) {
                console.log(`     * Index ${match.index}: ${JSON.stringify(match[0])}`);
            }
        });
        // Step 6: Determine where cancelled date would go
        console.log("\n6. Position Analysis:");
        // If we found 🛫 2025-04-20
        const planeMatch = lineText.match(/🛫\s*\d{4}-\d{2}-\d{2}/);
        if (planeMatch) {
            const afterPlanePos = planeMatch.index + planeMatch[0].length;
            console.log("   - After 🛫 date:", afterPlanePos);
            console.log("   - Text after that position:", JSON.stringify(lineText.substring(afterPlanePos)));
        }
        // Find the last metadata item
        let lastMetadataEnd = 0;
        [/#[\w-]+/g, /\[[a-zA-Z]+::[^\]]*\]/g, /[📅🚀✅❌🛫▶️⏰🏁]\s*\d{4}-\d{2}-\d{2}/g].forEach(pattern => {
            pattern.lastIndex = 0;
            while ((match = pattern.exec(lineText)) !== null) {
                const end = match.index + match[0].length;
                if (end > lastMetadataEnd) {
                    lastMetadataEnd = end;
                }
            }
        });
        console.log("   - Last metadata ends at:", lastMetadataEnd);
        console.log("   - Text after last metadata:", JSON.stringify(lineText.substring(lastMetadataEnd)));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b0RhdGVNYW5hZ2VyLnRyYWNpbmcudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImF1dG9EYXRlTWFuYWdlci50cmFjaW5nLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsYUFBYTtBQUNiLE9BQU8sRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBS3JELFFBQVEsQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7SUFDcEQsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEdBQUcsRUFBRTtRQUMxRCxNQUFNLFFBQVEsR0FBRyw2RkFBNkYsQ0FBQztRQUUvRyxPQUFPLENBQUMsR0FBRyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7UUFDbEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN4QyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFN0MsMkNBQTJDO1FBQzNDLE1BQU0sZUFBZSxHQUFHLG1CQUFtQixDQUFDO1FBQzVDLE1BQU0sYUFBYSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUM7UUFFdEQsSUFBSSxhQUFhLEVBQUU7WUFDbEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1lBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xFLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxhQUFhLENB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SyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO2dCQUMxQyxJQUFJLEdBQUcsR0FBRyxlQUFlLEVBQUU7b0JBQzFCLGVBQWUsR0FBRyxHQUFHLENBQUM7aUJBQ3RCO2FBQ0Q7UUFDRixDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFDNUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BHLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtaWdub3JlXHJcbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0IH0gZnJvbSBcIkBqZXN0L2dsb2JhbHNcIjtcclxuXHJcbi8vIEltcG9ydCB0aGUgaW50ZXJuYWwgZnVuY3Rpb25zIHdlIG5lZWQgdG8gdGVzdFxyXG5pbXBvcnQgeyBUZXh0LCBFZGl0b3JTdGF0ZSB9IGZyb20gXCJAY29kZW1pcnJvci9zdGF0ZVwiO1xyXG5cclxuZGVzY3JpYmUoXCJhdXRvRGF0ZU1hbmFnZXIgLSBFeGVjdXRpb24gVHJhY2luZ1wiLCAoKSA9PiB7XHJcblx0aXQoXCJzaG91bGQgdHJhY2UgdGhlIGV4YWN0IHByb2JsZW0gd2l0aCB1c2VyJ3MgdGV4dFwiLCAoKSA9PiB7XHJcblx0XHRjb25zdCBsaW5lVGV4dCA9IFwiLSBbLV0g5Lqk5rWB5Lqk5bqVIPCfmoAgMjAyNS0wNy0zMCBbc3RhZ2U6OmRpc2Nsb3N1cmVfY29tbXVuaWNhdGlvbl0g8J+bqyAyMDI1LTA0LTIwIF50aW1lci0xNjE5NDAtNDc3NVwiO1xyXG5cdFx0XHJcblx0XHRjb25zb2xlLmxvZyhcIlxcbj09PSBERVRBSUxFRCBFWEVDVVRJT04gVFJBQ0UgPT09XCIpO1xyXG5cdFx0Y29uc29sZS5sb2coXCJPcmlnaW5hbCBsaW5lOlwiLCBsaW5lVGV4dCk7XHJcblx0XHRjb25zb2xlLmxvZyhcIkxpbmUgbGVuZ3RoOlwiLCBsaW5lVGV4dC5sZW5ndGgpO1xyXG5cdFx0XHJcblx0XHQvLyBTdGVwIDE6IE1hbnVhbGx5IGV4dHJhY3QgYmxvY2sgcmVmZXJlbmNlXHJcblx0XHRjb25zdCBibG9ja1JlZlBhdHRlcm4gPSAvXFxzKihcXF5bXFx3LV0rKVxccyokLztcclxuXHRcdGNvbnN0IGJsb2NrUmVmTWF0Y2ggPSBsaW5lVGV4dC5tYXRjaChibG9ja1JlZlBhdHRlcm4pO1xyXG5cdFx0XHJcblx0XHRpZiAoYmxvY2tSZWZNYXRjaCkge1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcIlxcbjEuIEJsb2NrIFJlZmVyZW5jZSBEZXRlY3Rpb246XCIpO1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcIiAgIC0gRnVsbCBtYXRjaDpcIiwgSlNPTi5zdHJpbmdpZnkoYmxvY2tSZWZNYXRjaFswXSkpO1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcIiAgIC0gQmxvY2sgSUQ6XCIsIGJsb2NrUmVmTWF0Y2hbMV0pO1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcIiAgIC0gTWF0Y2ggaW5kZXg6XCIsIGJsb2NrUmVmTWF0Y2guaW5kZXgpO1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcIiAgIC0gTWF0Y2ggbGVuZ3RoOlwiLCBibG9ja1JlZk1hdGNoWzBdLmxlbmd0aCk7XHJcblx0XHRcdFxyXG5cdFx0XHRjb25zdCBjbGVhbmVkVGV4dCA9IGxpbmVUZXh0LnN1YnN0cmluZygwLCBibG9ja1JlZk1hdGNoLmluZGV4KS50cmltRW5kKCk7XHJcblx0XHRcdGNvbnNvbGUubG9nKFwiICAgLSBDbGVhbmVkIHRleHQ6XCIsIEpTT04uc3RyaW5naWZ5KGNsZWFuZWRUZXh0KSk7XHJcblx0XHRcdGNvbnNvbGUubG9nKFwiICAgLSBDbGVhbmVkIGxlbmd0aDpcIiwgY2xlYW5lZFRleHQubGVuZ3RoKTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0Ly8gU3RlcCAyOiBDaGVjayB0YXNrIHBhdHRlcm5cclxuXHRcdGNvbnN0IHRhc2tNYXRjaCA9IGxpbmVUZXh0Lm1hdGNoKC9eW1xcc3xcXHRdKihbLSorXXxcXGQrXFwuKVxcc1xcWy5cXF1cXHMqLyk7XHJcblx0XHRpZiAodGFza01hdGNoKSB7XHJcblx0XHRcdGNvbnNvbGUubG9nKFwiXFxuMi4gVGFzayBQYXR0ZXJuOlwiKTtcclxuXHRcdFx0Y29uc29sZS5sb2coXCIgICAtIFRhc2sgcHJlZml4OlwiLCBKU09OLnN0cmluZ2lmeSh0YXNrTWF0Y2hbMF0pKTtcclxuXHRcdFx0Y29uc29sZS5sb2coXCIgICAtIEluaXRpYWwgcG9zaXRpb246XCIsIHRhc2tNYXRjaFswXS5sZW5ndGgpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHQvLyBTdGVwIDM6IExvb2sgZm9yIPCfmoAgZW1vamkgKGNvbmZpZ3VyZWQpXHJcblx0XHRjb25zb2xlLmxvZyhcIlxcbjMuIENvbmZpZ3VyZWQgRW1vamkgU2VhcmNoICjwn5qAKTpcIik7XHJcblx0XHRjb25zdCByb2NrZXRQYXR0ZXJuID0gL/CfmoBcXHMqXFxkezR9LVxcZHsyfS1cXGR7Mn0vZztcclxuXHRcdGxldCBtYXRjaDtcclxuXHRcdHdoaWxlICgobWF0Y2ggPSByb2NrZXRQYXR0ZXJuLmV4ZWMobGluZVRleHQpKSAhPT0gbnVsbCkge1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcIiAgIC0gRm91bmQgYXQgaW5kZXg6XCIsIG1hdGNoLmluZGV4KTtcclxuXHRcdFx0Y29uc29sZS5sb2coXCIgICAtIE1hdGNoOlwiLCBKU09OLnN0cmluZ2lmeShtYXRjaFswXSkpO1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcIiAgIC0gRW5kIHBvc2l0aW9uOlwiLCBtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aCk7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdC8vIFN0ZXAgNDogTG9vayBmb3Ig8J+bqyBlbW9qaSAoYWN0dWFsKVxyXG5cdFx0Y29uc29sZS5sb2coXCJcXG40LiBBY3R1YWwgRW1vamkgU2VhcmNoICjwn5urKTpcIik7XHJcblx0XHRjb25zdCBwbGFuZVBhdHRlcm4gPSAv8J+bq1xccypcXGR7NH0tXFxkezJ9LVxcZHsyfS9nO1xyXG5cdFx0d2hpbGUgKChtYXRjaCA9IHBsYW5lUGF0dGVybi5leGVjKGxpbmVUZXh0KSkgIT09IG51bGwpIHtcclxuXHRcdFx0Y29uc29sZS5sb2coXCIgICAtIEZvdW5kIGF0IGluZGV4OlwiLCBtYXRjaC5pbmRleCk7XHJcblx0XHRcdGNvbnNvbGUubG9nKFwiICAgLSBNYXRjaDpcIiwgSlNPTi5zdHJpbmdpZnkobWF0Y2hbMF0pKTtcclxuXHRcdFx0Y29uc29sZS5sb2coXCIgICAtIEVuZCBwb3NpdGlvbjpcIiwgbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGgpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHQvLyBTdGVwIDU6IEZpbmQgYWxsIG1ldGFkYXRhXHJcblx0XHRjb25zb2xlLmxvZyhcIlxcbjUuIEFsbCBNZXRhZGF0YSBTZWFyY2g6XCIpO1xyXG5cdFx0Y29uc3QgbWV0YWRhdGFQYXR0ZXJucyA9IFtcclxuXHRcdFx0eyBuYW1lOiBcIlRhZ3NcIiwgcGF0dGVybjogLyNbXFx3LV0rL2cgfSxcclxuXHRcdFx0eyBuYW1lOiBcIkRhdGF2aWV3XCIsIHBhdHRlcm46IC9cXFtbYS16QS1aXSs6OlteXFxdXSpcXF0vZyB9LFxyXG5cdFx0XHR7IG5hbWU6IFwiRGF0ZSBtYXJrZXJzXCIsIHBhdHRlcm46IC9b8J+ThfCfmoDinIXinYzwn5ur4pa277iP4o+w8J+PgV1cXHMqXFxkezR9LVxcZHsyfS1cXGR7Mn0oPzpcXHMrXFxkezJ9OlxcZHsyfSg/OjpcXGR7Mn0pPyk/L2cgfVxyXG5cdFx0XTtcclxuXHRcdFxyXG5cdFx0bWV0YWRhdGFQYXR0ZXJucy5mb3JFYWNoKCh7IG5hbWUsIHBhdHRlcm4gfSkgPT4ge1xyXG5cdFx0XHRjb25zb2xlLmxvZyhgICAgLSAke25hbWV9OmApO1xyXG5cdFx0XHRwYXR0ZXJuLmxhc3RJbmRleCA9IDA7XHJcblx0XHRcdHdoaWxlICgobWF0Y2ggPSBwYXR0ZXJuLmV4ZWMobGluZVRleHQpKSAhPT0gbnVsbCkge1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKGAgICAgICogSW5kZXggJHttYXRjaC5pbmRleH06ICR7SlNPTi5zdHJpbmdpZnkobWF0Y2hbMF0pfWApO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHRcdFxyXG5cdFx0Ly8gU3RlcCA2OiBEZXRlcm1pbmUgd2hlcmUgY2FuY2VsbGVkIGRhdGUgd291bGQgZ29cclxuXHRcdGNvbnNvbGUubG9nKFwiXFxuNi4gUG9zaXRpb24gQW5hbHlzaXM6XCIpO1xyXG5cdFx0XHJcblx0XHQvLyBJZiB3ZSBmb3VuZCDwn5urIDIwMjUtMDQtMjBcclxuXHRcdGNvbnN0IHBsYW5lTWF0Y2ggPSBsaW5lVGV4dC5tYXRjaCgv8J+bq1xccypcXGR7NH0tXFxkezJ9LVxcZHsyfS8pO1xyXG5cdFx0aWYgKHBsYW5lTWF0Y2gpIHtcclxuXHRcdFx0Y29uc3QgYWZ0ZXJQbGFuZVBvcyA9IHBsYW5lTWF0Y2guaW5kZXghICsgcGxhbmVNYXRjaFswXS5sZW5ndGg7XHJcblx0XHRcdGNvbnNvbGUubG9nKFwiICAgLSBBZnRlciDwn5urIGRhdGU6XCIsIGFmdGVyUGxhbmVQb3MpO1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcIiAgIC0gVGV4dCBhZnRlciB0aGF0IHBvc2l0aW9uOlwiLCBKU09OLnN0cmluZ2lmeShsaW5lVGV4dC5zdWJzdHJpbmcoYWZ0ZXJQbGFuZVBvcykpKTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0Ly8gRmluZCB0aGUgbGFzdCBtZXRhZGF0YSBpdGVtXHJcblx0XHRsZXQgbGFzdE1ldGFkYXRhRW5kID0gMDtcclxuXHRcdFsvI1tcXHctXSsvZywgL1xcW1thLXpBLVpdKzo6W15cXF1dKlxcXS9nLCAvW/Cfk4Xwn5qA4pyF4p2M8J+bq+KWtu+4j+KPsPCfj4FdXFxzKlxcZHs0fS1cXGR7Mn0tXFxkezJ9L2ddLmZvckVhY2gocGF0dGVybiA9PiB7XHJcblx0XHRcdHBhdHRlcm4ubGFzdEluZGV4ID0gMDtcclxuXHRcdFx0d2hpbGUgKChtYXRjaCA9IHBhdHRlcm4uZXhlYyhsaW5lVGV4dCkpICE9PSBudWxsKSB7XHJcblx0XHRcdFx0Y29uc3QgZW5kID0gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7XHJcblx0XHRcdFx0aWYgKGVuZCA+IGxhc3RNZXRhZGF0YUVuZCkge1xyXG5cdFx0XHRcdFx0bGFzdE1ldGFkYXRhRW5kID0gZW5kO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0XHRcclxuXHRcdGNvbnNvbGUubG9nKFwiICAgLSBMYXN0IG1ldGFkYXRhIGVuZHMgYXQ6XCIsIGxhc3RNZXRhZGF0YUVuZCk7XHJcblx0XHRjb25zb2xlLmxvZyhcIiAgIC0gVGV4dCBhZnRlciBsYXN0IG1ldGFkYXRhOlwiLCBKU09OLnN0cmluZ2lmeShsaW5lVGV4dC5zdWJzdHJpbmcobGFzdE1ldGFkYXRhRW5kKSkpO1xyXG5cdH0pO1xyXG59KTsiXX0=