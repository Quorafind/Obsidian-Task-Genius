/**
 * Tests for Settings Migration functionality
 */
import { migrateFileParsingSettings, cleanupDeprecatedSettings, hasSettingsDuplicates, runAllMigrations } from '../utils/SettingsMigration';
import { DEFAULT_SETTINGS } from '../common/setting-definition';
describe('Settings Migration', () => {
    let testSettings;
    beforeEach(() => {
        // Create a copy of default settings for testing
        testSettings = JSON.parse(JSON.stringify(DEFAULT_SETTINGS));
    });
    describe('hasSettingsDuplicates', () => {
        it('should detect when file metadata parsing is enabled but FileSource is disabled', () => {
            testSettings.fileParsingConfig.enableFileMetadataParsing = true;
            testSettings.fileSource.enabled = false;
            expect(hasSettingsDuplicates(testSettings)).toBe(true);
        });
        it('should detect when tag parsing is enabled but FileSource tag recognition is disabled', () => {
            testSettings.fileParsingConfig.enableTagBasedTaskParsing = true;
            testSettings.fileSource.recognitionStrategies.tags.enabled = false;
            expect(hasSettingsDuplicates(testSettings)).toBe(true);
        });
        it('should return false when no duplicates exist', () => {
            expect(hasSettingsDuplicates(testSettings)).toBe(false);
        });
    });
    describe('migrateFileParsingSettings', () => {
        it('should migrate file metadata parsing to FileSource', () => {
            testSettings.fileParsingConfig.enableFileMetadataParsing = true;
            testSettings.fileSource.enabled = false;
            const result = migrateFileParsingSettings(testSettings);
            expect(result.migrated).toBe(true);
            expect(testSettings.fileSource.enabled).toBe(true);
            expect(result.details).toContain('Migrated: Enable file metadata parsing â†’ Enable FileSource');
        });
        it('should migrate tag-based parsing settings', () => {
            testSettings.fileParsingConfig.enableTagBasedTaskParsing = true;
            testSettings.fileParsingConfig.tagsToParseAsTasks = ['#custom-tag', '#work'];
            testSettings.fileSource.recognitionStrategies.tags.enabled = false;
            const result = migrateFileParsingSettings(testSettings);
            expect(result.migrated).toBe(true);
            expect(testSettings.fileSource.recognitionStrategies.tags.enabled).toBe(true);
            expect(testSettings.fileSource.recognitionStrategies.tags.taskTags).toContain('#custom-tag');
            expect(testSettings.fileSource.recognitionStrategies.tags.taskTags).toContain('#work');
        });
        it('should migrate metadata fields for task recognition', () => {
            testSettings.fileParsingConfig.metadataFieldsToParseAsTasks = ['custom-field', 'project-task'];
            testSettings.fileSource.recognitionStrategies.metadata.enabled = false;
            const result = migrateFileParsingSettings(testSettings);
            expect(result.migrated).toBe(true);
            expect(testSettings.fileSource.recognitionStrategies.metadata.enabled).toBe(true);
            expect(testSettings.fileSource.recognitionStrategies.metadata.taskFields).toContain('custom-field');
            expect(testSettings.fileSource.recognitionStrategies.metadata.taskFields).toContain('project-task');
        });
        it('should migrate worker processing settings', () => {
            testSettings.fileParsingConfig.enableWorkerProcessing = true;
            const result = migrateFileParsingSettings(testSettings);
            expect(result.migrated).toBe(true);
            expect(testSettings.fileSource.performance.enableWorkerProcessing).toBe(true);
            expect(result.details).toContain('Migrated: Worker processing setting');
        });
        it('should migrate task content source settings', () => {
            testSettings.fileParsingConfig.taskContentFromMetadata = 'custom-title';
            const result = migrateFileParsingSettings(testSettings);
            expect(testSettings.fileSource.fileTaskProperties.contentSource).toBe('custom');
            expect(testSettings.fileSource.fileTaskProperties.customContentField).toBe('custom-title');
            expect(result.details).toContain('Migrated: Task content source');
        });
        it('should handle title content source correctly', () => {
            testSettings.fileParsingConfig.taskContentFromMetadata = 'title';
            const result = migrateFileParsingSettings(testSettings);
            expect(testSettings.fileSource.fileTaskProperties.contentSource).toBe('title');
            expect(testSettings.fileSource.fileTaskProperties.customContentField).toBeUndefined();
        });
    });
    describe('cleanupDeprecatedSettings', () => {
        it('should not cleanup if FileSource is disabled', () => {
            testSettings.fileParsingConfig.enableFileMetadataParsing = true;
            testSettings.fileSource.enabled = false;
            const result = cleanupDeprecatedSettings(testSettings);
            expect(result.migrated).toBe(false);
            expect(result.warnings).toContain('Skipping cleanup: FileSource not enabled');
            expect(testSettings.fileParsingConfig.enableFileMetadataParsing).toBe(true);
        });
        it('should cleanup deprecated settings when FileSource is enabled', () => {
            testSettings.fileParsingConfig.enableFileMetadataParsing = true;
            testSettings.fileParsingConfig.enableTagBasedTaskParsing = true;
            testSettings.fileParsingConfig.metadataFieldsToParseAsTasks = ['old-field'];
            testSettings.fileParsingConfig.tagsToParseAsTasks = ['#old-tag'];
            testSettings.fileSource.enabled = true;
            const result = cleanupDeprecatedSettings(testSettings);
            expect(result.migrated).toBe(true);
            expect(testSettings.fileParsingConfig.enableFileMetadataParsing).toBe(false);
            expect(testSettings.fileParsingConfig.enableTagBasedTaskParsing).toBe(false);
            expect(testSettings.fileParsingConfig.metadataFieldsToParseAsTasks).toEqual([]);
            expect(testSettings.fileParsingConfig.tagsToParseAsTasks).toEqual([]);
            expect(result.details).toContain('Disabled deprecated: Enable file metadata parsing');
            expect(result.details).toContain('Disabled deprecated: Tag-based task parsing');
            expect(result.details).toContain('Cleared deprecated: Metadata fields array');
            expect(result.details).toContain('Cleared deprecated: Task tags array');
        });
    });
    describe('runAllMigrations', () => {
        it('should run complete migration workflow', () => {
            // Set up scenario with duplicates
            testSettings.fileParsingConfig.enableFileMetadataParsing = true;
            testSettings.fileParsingConfig.enableTagBasedTaskParsing = true;
            testSettings.fileParsingConfig.metadataFieldsToParseAsTasks = ['task-field'];
            testSettings.fileParsingConfig.tagsToParseAsTasks = ['#task-tag'];
            testSettings.fileSource.enabled = false;
            const result = runAllMigrations(testSettings);
            expect(result.migrated).toBe(true);
            // Check migration happened
            expect(testSettings.fileSource.enabled).toBe(true);
            expect(testSettings.fileSource.recognitionStrategies.tags.enabled).toBe(true);
            expect(testSettings.fileSource.recognitionStrategies.metadata.enabled).toBe(true);
            // Check cleanup happened
            expect(testSettings.fileParsingConfig.enableFileMetadataParsing).toBe(false);
            expect(testSettings.fileParsingConfig.enableTagBasedTaskParsing).toBe(false);
            expect(testSettings.fileParsingConfig.metadataFieldsToParseAsTasks).toEqual([]);
            expect(testSettings.fileParsingConfig.tagsToParseAsTasks).toEqual([]);
            // Check we have migration details
            expect(result.details.length).toBeGreaterThan(0);
        });
        it('should not run cleanup if migration fails', () => {
            // No migration needed
            const result = runAllMigrations(testSettings);
            expect(result.migrated).toBe(false);
            expect(result.details.length).toBeLessThanOrEqual(1); // Only project config detail
        });
    });
    describe('edge cases', () => {
        it('should handle missing fileSource gracefully', () => {
            // @ts-ignore - Simulating corrupted settings
            delete testSettings.fileSource;
            testSettings.fileParsingConfig.enableFileMetadataParsing = true;
            const result = migrateFileParsingSettings(testSettings);
            expect(result.migrated).toBe(true);
            expect(testSettings.fileSource).toBeDefined();
            expect(testSettings.fileSource.enabled).toBe(true);
            expect(result.details).toContain('Created default FileSource configuration');
        });
        it('should merge tags without duplicates', () => {
            testSettings.fileParsingConfig.enableTagBasedTaskParsing = true;
            testSettings.fileParsingConfig.tagsToParseAsTasks = ['#task', '#work'];
            testSettings.fileSource.recognitionStrategies.tags.taskTags = ['#task', '#existing'];
            const result = migrateFileParsingSettings(testSettings);
            const finalTags = testSettings.fileSource.recognitionStrategies.tags.taskTags;
            expect(finalTags).toContain('#task');
            expect(finalTags).toContain('#work');
            expect(finalTags).toContain('#existing');
            // Should not have duplicates
            expect(finalTags.filter(tag => tag === '#task')).toHaveLength(1);
        });
        it('should merge metadata fields without duplicates', () => {
            testSettings.fileParsingConfig.metadataFieldsToParseAsTasks = ['dueDate', 'custom'];
            testSettings.fileSource.recognitionStrategies.metadata.taskFields = ['dueDate', 'existing'];
            const result = migrateFileParsingSettings(testSettings);
            const finalFields = testSettings.fileSource.recognitionStrategies.metadata.taskFields;
            expect(finalFields).toContain('dueDate');
            expect(finalFields).toContain('custom');
            expect(finalFields).toContain('existing');
            // Should not have duplicates
            expect(finalFields.filter(field => field === 'dueDate')).toHaveLength(1);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2V0dGluZ3NNaWdyYXRpb24udGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlNldHRpbmdzTWlncmF0aW9uLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0dBRUc7QUFFSCxPQUFPLEVBQ0wsMEJBQTBCLEVBQzFCLHlCQUF5QixFQUN6QixxQkFBcUIsRUFDckIsZ0JBQWdCLEVBQ2pCLE1BQU0sNEJBQTRCLENBQUM7QUFDcEMsT0FBTyxFQUFFLGdCQUFnQixFQUFnQyxNQUFNLDhCQUE4QixDQUFDO0FBRTlGLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUU7SUFDbEMsSUFBSSxZQUFxQyxDQUFDO0lBRTFDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxnREFBZ0Q7UUFDaEQsWUFBWSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7SUFDOUQsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO1FBQ3JDLEVBQUUsQ0FBQyxnRkFBZ0YsRUFBRSxHQUFHLEVBQUU7WUFDeEYsWUFBWSxDQUFDLGlCQUFpQixDQUFDLHlCQUF5QixHQUFHLElBQUksQ0FBQztZQUNoRSxZQUFZLENBQUMsVUFBVSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7WUFFeEMsTUFBTSxDQUFDLHFCQUFxQixDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNGQUFzRixFQUFFLEdBQUcsRUFBRTtZQUM5RixZQUFZLENBQUMsaUJBQWlCLENBQUMseUJBQXlCLEdBQUcsSUFBSSxDQUFDO1lBQ2hFLFlBQVksQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7WUFFbkUsTUFBTSxDQUFD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QyxDQUFDLENBQUMsQ0FBQztRQUNuRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpREFBaUQsRUFBRSxHQUFHLEVBQUU7WUFDekQsWUFBWSxDQUFDLGlCQUFpQixDQUFDLDRCQUE0QixHQUFHLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQ3BGLFlBQVksQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQUMsUUFBUSxDQUFDLFVBQVUsR0FBRyxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUU1RixNQUFNLE1BQU0sR0FBRywwQkFBMEIsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUV4RCxNQUFNLFdBQVcsR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFDLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUM7WUFDdEYsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN6QyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDMUMsNkJBQTZCO1lBQzdCLE1BQU0sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBUZXN0cyBmb3IgU2V0dGluZ3MgTWlncmF0aW9uIGZ1bmN0aW9uYWxpdHlcclxuICovXHJcblxyXG5pbXBvcnQgeyBcclxuICBtaWdyYXRlRmlsZVBhcnNpbmdTZXR0aW5ncywgXHJcbiAgY2xlYW51cERlcHJlY2F0ZWRTZXR0aW5ncyxcclxuICBoYXNTZXR0aW5nc0R1cGxpY2F0ZXMsXHJcbiAgcnVuQWxsTWlncmF0aW9ucyBcclxufSBmcm9tICcuLi91dGlscy9TZXR0aW5nc01pZ3JhdGlvbic7XHJcbmltcG9ydCB7IERFRkFVTFRfU0VUVElOR1MsIHR5cGUgVGFza1Byb2dyZXNzQmFyU2V0dGluZ3MgfSBmcm9tICcuLi9jb21tb24vc2V0dGluZy1kZWZpbml0aW9uJztcclxuXHJcbmRlc2NyaWJlKCdTZXR0aW5ncyBNaWdyYXRpb24nLCAoKSA9PiB7XHJcbiAgbGV0IHRlc3RTZXR0aW5nczogVGFza1Byb2dyZXNzQmFyU2V0dGluZ3M7XHJcblxyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgLy8gQ3JlYXRlIGEgY29weSBvZiBkZWZhdWx0IHNldHRpbmdzIGZvciB0ZXN0aW5nXHJcbiAgICB0ZXN0U2V0dGluZ3MgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KERFRkFVTFRfU0VUVElOR1MpKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2hhc1NldHRpbmdzRHVwbGljYXRlcycsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IHdoZW4gZmlsZSBtZXRhZGF0YSBwYXJzaW5nIGlzIGVuYWJsZWQgYnV0IEZpbGVTb3VyY2UgaXMgZGlzYWJsZWQnLCAoKSA9PiB7XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5lbmFibGVGaWxlTWV0YWRhdGFQYXJzaW5nID0gdHJ1ZTtcclxuICAgICAgdGVzdFNldHRpbmdzLmZpbGVTb3VyY2UuZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGhhc1NldHRpbmdzRHVwbGljYXRlcyh0ZXN0U2V0dGluZ3MpKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3Qgd2hlbiB0YWcgcGFyc2luZyBpcyBlbmFibGVkIGJ1dCBGaWxlU291cmNlIHRhZyByZWNvZ25pdGlvbiBpcyBkaXNhYmxlZCcsICgpID0+IHtcclxuICAgICAgdGVzdFNldHRpbmdzLmZpbGVQYXJzaW5nQ29uZmlnLmVuYWJsZVRhZ0Jhc2VkVGFza1BhcnNpbmcgPSB0cnVlO1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZS5yZWNvZ25pdGlvblN0cmF0ZWdpZXMudGFncy5lbmFibGVkID0gZmFsc2U7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaGFzU2V0dGluZ3NEdXBsaWNhdGVzKHRlc3RTZXR0aW5ncykpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSB3aGVuIG5vIGR1cGxpY2F0ZXMgZXhpc3QnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChoYXNTZXR0aW5nc0R1cGxpY2F0ZXModGVzdFNldHRpbmdzKSkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ21pZ3JhdGVGaWxlUGFyc2luZ1NldHRpbmdzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBtaWdyYXRlIGZpbGUgbWV0YWRhdGEgcGFyc2luZyB0byBGaWxlU291cmNlJywgKCkgPT4ge1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVBhcnNpbmdDb25maWcuZW5hYmxlRmlsZU1ldGFkYXRhUGFyc2luZyA9IHRydWU7XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlU291cmNlLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG1pZ3JhdGVGaWxlUGFyc2luZ1NldHRpbmdzKHRlc3RTZXR0aW5ncyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1pZ3JhdGVkKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QodGVzdFNldHRpbmdzLmZpbGVTb3VyY2UuZW5hYmxlZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRhaWxzKS50b0NvbnRhaW4oJ01pZ3JhdGVkOiBFbmFibGUgZmlsZSBtZXRhZGF0YSBwYXJzaW5nIOKGkiBFbmFibGUgRmlsZVNvdXJjZScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBtaWdyYXRlIHRhZy1iYXNlZCBwYXJzaW5nIHNldHRpbmdzJywgKCkgPT4ge1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVBhcnNpbmdDb25maWcuZW5hYmxlVGFnQmFzZWRUYXNrUGFyc2luZyA9IHRydWU7XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy50YWdzVG9QYXJzZUFzVGFza3MgPSBbJyNjdXN0b20tdGFnJywgJyN3b3JrJ107XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlU291cmNlLnJlY29nbml0aW9uU3RyYXRlZ2llcy50YWdzLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG1pZ3JhdGVGaWxlUGFyc2luZ1NldHRpbmdzKHRlc3RTZXR0aW5ncyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1pZ3JhdGVkKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QodGVzdFNldHRpbmdzLmZpbGVTb3VyY2UucmVjb2duaXRpb25TdHJhdGVnaWVzLnRhZ3MuZW5hYmxlZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlU291cmNlLnJlY29nbml0aW9uU3RyYXRlZ2llcy50YWdzLnRhc2tUYWdzKS50b0NvbnRhaW4oJyNjdXN0b20tdGFnJyk7XHJcbiAgICAgIGV4cGVjdCh0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZS5yZWNvZ25pdGlvblN0cmF0ZWdpZXMudGFncy50YXNrVGFncykudG9Db250YWluKCcjd29yaycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBtaWdyYXRlIG1ldGFkYXRhIGZpZWxkcyBmb3IgdGFzayByZWNvZ25pdGlvbicsICgpID0+IHtcclxuICAgICAgdGVzdFNldHRpbmdzLmZpbGVQYXJzaW5nQ29uZmlnLm1ldGFkYXRhRmllbGRzVG9QYXJzZUFzVGFza3MgPSBbJ2N1c3RvbS1maWVsZCcsICdwcm9qZWN0LXRhc2snXTtcclxuICAgICAgdGVzdFNldHRpbmdzLmZpbGVTb3VyY2UucmVjb2duaXRpb25TdHJhdGVnaWVzLm1ldGFkYXRhLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG1pZ3JhdGVGaWxlUGFyc2luZ1NldHRpbmdzKHRlc3RTZXR0aW5ncyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocmVzdWx0Lm1pZ3JhdGVkKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QodGVzdFNldHRpbmdzLmZpbGVTb3VyY2UucmVjb2duaXRpb25TdHJhdGVnaWVzLm1ldGFkYXRhLmVuYWJsZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdCh0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZS5yZWNvZ25pdGlvblN0cmF0ZWdpZXMubWV0YWRhdGEudGFza0ZpZWxkcykudG9Db250YWluKCdjdXN0b20tZmllbGQnKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlU291cmNlLnJlY29nbml0aW9uU3RyYXRlZ2llcy5tZXRhZGF0YS50YXNrRmllbGRzKS50b0NvbnRhaW4oJ3Byb2plY3QtdGFzaycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBtaWdyYXRlIHdvcmtlciBwcm9jZXNzaW5nIHNldHRpbmdzJywgKCkgPT4ge1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVBhcnNpbmdDb25maWcuZW5hYmxlV29ya2VyUHJvY2Vzc2luZyA9IHRydWU7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBtaWdyYXRlRmlsZVBhcnNpbmdTZXR0aW5ncyh0ZXN0U2V0dGluZ3MpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5taWdyYXRlZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlU291cmNlLnBlcmZvcm1hbmNlLmVuYWJsZVdvcmtlclByb2Nlc3NpbmcpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0YWlscykudG9Db250YWluKCdNaWdyYXRlZDogV29ya2VyIHByb2Nlc3Npbmcgc2V0dGluZycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBtaWdyYXRlIHRhc2sgY29udGVudCBzb3VyY2Ugc2V0dGluZ3MnLCAoKSA9PiB7XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy50YXNrQ29udGVudEZyb21NZXRhZGF0YSA9ICdjdXN0b20tdGl0bGUnO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gbWlncmF0ZUZpbGVQYXJzaW5nU2V0dGluZ3ModGVzdFNldHRpbmdzKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdCh0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZS5maWxlVGFza1Byb3BlcnRpZXMuY29udGVudFNvdXJjZSkudG9CZSgnY3VzdG9tJyk7XHJcbiAgICAgIGV4cGVjdCh0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZS5maWxlVGFza1Byb3BlcnRpZXMuY3VzdG9tQ29udGVudEZpZWxkKS50b0JlKCdjdXN0b20tdGl0bGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRhaWxzKS50b0NvbnRhaW4oJ01pZ3JhdGVkOiBUYXNrIGNvbnRlbnQgc291cmNlJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0aXRsZSBjb250ZW50IHNvdXJjZSBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy50YXNrQ29udGVudEZyb21NZXRhZGF0YSA9ICd0aXRsZSc7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCByZXN1bHQgPSBtaWdyYXRlRmlsZVBhcnNpbmdTZXR0aW5ncyh0ZXN0U2V0dGluZ3MpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlU291cmNlLmZpbGVUYXNrUHJvcGVydGllcy5jb250ZW50U291cmNlKS50b0JlKCd0aXRsZScpO1xyXG4gICAgICBleHBlY3QodGVzdFNldHRpbmdzLmZpbGVTb3VyY2UuZmlsZVRhc2tQcm9wZXJ0aWVzLmN1c3RvbUNvbnRlbnRGaWVsZCkudG9CZVVuZGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjbGVhbnVwRGVwcmVjYXRlZFNldHRpbmdzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBub3QgY2xlYW51cCBpZiBGaWxlU291cmNlIGlzIGRpc2FibGVkJywgKCkgPT4ge1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVBhcnNpbmdDb25maWcuZW5hYmxlRmlsZU1ldGFkYXRhUGFyc2luZyA9IHRydWU7XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlU291cmNlLmVuYWJsZWQgPSBmYWxzZTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGNsZWFudXBEZXByZWNhdGVkU2V0dGluZ3ModGVzdFNldHRpbmdzKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWlncmF0ZWQpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lndhcm5pbmdzKS50b0NvbnRhaW4oJ1NraXBwaW5nIGNsZWFudXA6IEZpbGVTb3VyY2Ugbm90IGVuYWJsZWQnKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5lbmFibGVGaWxlTWV0YWRhdGFQYXJzaW5nKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBjbGVhbnVwIGRlcHJlY2F0ZWQgc2V0dGluZ3Mgd2hlbiBGaWxlU291cmNlIGlzIGVuYWJsZWQnLCAoKSA9PiB7XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5lbmFibGVGaWxlTWV0YWRhdGFQYXJzaW5nID0gdHJ1ZTtcclxuICAgICAgdGVzdFNldHRpbmdzLmZpbGVQYXJzaW5nQ29uZmlnLmVuYWJsZVRhZ0Jhc2VkVGFza1BhcnNpbmcgPSB0cnVlO1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVBhcnNpbmdDb25maWcubWV0YWRhdGFGaWVsZHNUb1BhcnNlQXNUYXNrcyA9IFsnb2xkLWZpZWxkJ107XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy50YWdzVG9QYXJzZUFzVGFza3MgPSBbJyNvbGQtdGFnJ107XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlU291cmNlLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gY2xlYW51cERlcHJlY2F0ZWRTZXR0aW5ncyh0ZXN0U2V0dGluZ3MpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5taWdyYXRlZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5lbmFibGVGaWxlTWV0YWRhdGFQYXJzaW5nKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5lbmFibGVUYWdCYXNlZFRhc2tQYXJzaW5nKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5tZXRhZGF0YUZpZWxkc1RvUGFyc2VBc1Rhc2tzKS50b0VxdWFsKFtdKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy50YWdzVG9QYXJzZUFzVGFza3MpLnRvRXF1YWwoW10pO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRhaWxzKS50b0NvbnRhaW4oJ0Rpc2FibGVkIGRlcHJlY2F0ZWQ6IEVuYWJsZSBmaWxlIG1ldGFkYXRhIHBhcnNpbmcnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRhaWxzKS50b0NvbnRhaW4oJ0Rpc2FibGVkIGRlcHJlY2F0ZWQ6IFRhZy1iYXNlZCB0YXNrIHBhcnNpbmcnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXRhaWxzKS50b0NvbnRhaW4oJ0NsZWFyZWQgZGVwcmVjYXRlZDogTWV0YWRhdGEgZmllbGRzIGFycmF5Jyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0YWlscykudG9Db250YWluKCdDbGVhcmVkIGRlcHJlY2F0ZWQ6IFRhc2sgdGFncyBhcnJheScpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdydW5BbGxNaWdyYXRpb25zJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBydW4gY29tcGxldGUgbWlncmF0aW9uIHdvcmtmbG93JywgKCkgPT4ge1xyXG4gICAgICAvLyBTZXQgdXAgc2NlbmFyaW8gd2l0aCBkdXBsaWNhdGVzXHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5lbmFibGVGaWxlTWV0YWRhdGFQYXJzaW5nID0gdHJ1ZTtcclxuICAgICAgdGVzdFNldHRpbmdzLmZpbGVQYXJzaW5nQ29uZmlnLmVuYWJsZVRhZ0Jhc2VkVGFza1BhcnNpbmcgPSB0cnVlO1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVBhcnNpbmdDb25maWcubWV0YWRhdGFGaWVsZHNUb1BhcnNlQXNUYXNrcyA9IFsndGFzay1maWVsZCddO1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVBhcnNpbmdDb25maWcudGFnc1RvUGFyc2VBc1Rhc2tzID0gWycjdGFzay10YWcnXTtcclxuICAgICAgdGVzdFNldHRpbmdzLmZpbGVTb3VyY2UuZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gcnVuQWxsTWlncmF0aW9ucyh0ZXN0U2V0dGluZ3MpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5taWdyYXRlZCkudG9CZSh0cnVlKTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIG1pZ3JhdGlvbiBoYXBwZW5lZFxyXG4gICAgICBleHBlY3QodGVzdFNldHRpbmdzLmZpbGVTb3VyY2UuZW5hYmxlZCkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlU291cmNlLnJlY29nbml0aW9uU3RyYXRlZ2llcy50YWdzLmVuYWJsZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdCh0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZS5yZWNvZ25pdGlvblN0cmF0ZWdpZXMubWV0YWRhdGEuZW5hYmxlZCkudG9CZSh0cnVlKTtcclxuICAgICAgXHJcbiAgICAgIC8vIENoZWNrIGNsZWFudXAgaGFwcGVuZWRcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5lbmFibGVGaWxlTWV0YWRhdGFQYXJzaW5nKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5lbmFibGVUYWdCYXNlZFRhc2tQYXJzaW5nKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5tZXRhZGF0YUZpZWxkc1RvUGFyc2VBc1Rhc2tzKS50b0VxdWFsKFtdKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy50YWdzVG9QYXJzZUFzVGFza3MpLnRvRXF1YWwoW10pO1xyXG4gICAgICBcclxuICAgICAgLy8gQ2hlY2sgd2UgaGF2ZSBtaWdyYXRpb24gZGV0YWlsc1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRldGFpbHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG5vdCBydW4gY2xlYW51cCBpZiBtaWdyYXRpb24gZmFpbHMnLCAoKSA9PiB7XHJcbiAgICAgIC8vIE5vIG1pZ3JhdGlvbiBuZWVkZWRcclxuICAgICAgY29uc3QgcmVzdWx0ID0gcnVuQWxsTWlncmF0aW9ucyh0ZXN0U2V0dGluZ3MpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJlc3VsdC5taWdyYXRlZCkudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0YWlscy5sZW5ndGgpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMSk7IC8vIE9ubHkgcHJvamVjdCBjb25maWcgZGV0YWlsXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2VkZ2UgY2FzZXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXNzaW5nIGZpbGVTb3VyY2UgZ3JhY2VmdWxseScsICgpID0+IHtcclxuICAgICAgLy8gQHRzLWlnbm9yZSAtIFNpbXVsYXRpbmcgY29ycnVwdGVkIHNldHRpbmdzXHJcbiAgICAgIGRlbGV0ZSB0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZTtcclxuICAgICAgdGVzdFNldHRpbmdzLmZpbGVQYXJzaW5nQ29uZmlnLmVuYWJsZUZpbGVNZXRhZGF0YVBhcnNpbmcgPSB0cnVlO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gbWlncmF0ZUZpbGVQYXJzaW5nU2V0dGluZ3ModGVzdFNldHRpbmdzKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChyZXN1bHQubWlncmF0ZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdCh0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZSkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHRlc3RTZXR0aW5ncy5maWxlU291cmNlLmVuYWJsZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGV0YWlscykudG9Db250YWluKCdDcmVhdGVkIGRlZmF1bHQgRmlsZVNvdXJjZSBjb25maWd1cmF0aW9uJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG1lcmdlIHRhZ3Mgd2l0aG91dCBkdXBsaWNhdGVzJywgKCkgPT4ge1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVBhcnNpbmdDb25maWcuZW5hYmxlVGFnQmFzZWRUYXNrUGFyc2luZyA9IHRydWU7XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy50YWdzVG9QYXJzZUFzVGFza3MgPSBbJyN0YXNrJywgJyN3b3JrJ107XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlU291cmNlLnJlY29nbml0aW9uU3RyYXRlZ2llcy50YWdzLnRhc2tUYWdzID0gWycjdGFzaycsICcjZXhpc3RpbmcnXTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG1pZ3JhdGVGaWxlUGFyc2luZ1NldHRpbmdzKHRlc3RTZXR0aW5ncyk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBmaW5hbFRhZ3MgPSB0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZS5yZWNvZ25pdGlvblN0cmF0ZWdpZXMudGFncy50YXNrVGFncztcclxuICAgICAgZXhwZWN0KGZpbmFsVGFncykudG9Db250YWluKCcjdGFzaycpO1xyXG4gICAgICBleHBlY3QoZmluYWxUYWdzKS50b0NvbnRhaW4oJyN3b3JrJyk7XHJcbiAgICAgIGV4cGVjdChmaW5hbFRhZ3MpLnRvQ29udGFpbignI2V4aXN0aW5nJyk7XHJcbiAgICAgIC8vIFNob3VsZCBub3QgaGF2ZSBkdXBsaWNhdGVzXHJcbiAgICAgIGV4cGVjdChmaW5hbFRhZ3MuZmlsdGVyKHRhZyA9PiB0YWcgPT09ICcjdGFzaycpKS50b0hhdmVMZW5ndGgoMSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIG1lcmdlIG1ldGFkYXRhIGZpZWxkcyB3aXRob3V0IGR1cGxpY2F0ZXMnLCAoKSA9PiB7XHJcbiAgICAgIHRlc3RTZXR0aW5ncy5maWxlUGFyc2luZ0NvbmZpZy5tZXRhZGF0YUZpZWxkc1RvUGFyc2VBc1Rhc2tzID0gWydkdWVEYXRlJywgJ2N1c3RvbSddO1xyXG4gICAgICB0ZXN0U2V0dGluZ3MuZmlsZVNvdXJjZS5yZWNvZ25pdGlvblN0cmF0ZWdpZXMubWV0YWRhdGEudGFza0ZpZWxkcyA9IFsnZHVlRGF0ZScsICdleGlzdGluZyddO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0ID0gbWlncmF0ZUZpbGVQYXJzaW5nU2V0dGluZ3ModGVzdFNldHRpbmdzKTtcclxuICAgICAgXHJcbiAgICAgIGNvbnN0IGZpbmFsRmllbGRzID0gdGVzdFNldHRpbmdzLmZpbGVTb3VyY2UucmVjb2duaXRpb25TdHJhdGVnaWVzLm1ldGFkYXRhLnRhc2tGaWVsZHM7XHJcbiAgICAgIGV4cGVjdChmaW5hbEZpZWxkcykudG9Db250YWluKCdkdWVEYXRlJyk7XHJcbiAgICAgIGV4cGVjdChmaW5hbEZpZWxkcykudG9Db250YWluKCdjdXN0b20nKTtcclxuICAgICAgZXhwZWN0KGZpbmFsRmllbGRzKS50b0NvbnRhaW4oJ2V4aXN0aW5nJyk7XHJcbiAgICAgIC8vIFNob3VsZCBub3QgaGF2ZSBkdXBsaWNhdGVzXHJcbiAgICAgIGV4cGVjdChmaW5hbEZpZWxkcy5maWx0ZXIoZmllbGQgPT4gZmllbGQgPT09ICdkdWVEYXRlJykpLnRvSGF2ZUxlbmd0aCgxKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXX0=