/**
 * Status Mapping Tests
 *
 * Tests for the status mapping functionality in FileSource
 */
import { FileSourceConfig } from "../../dataflow/sources/FileSourceConfig";
describe("FileSource Status Mapping", () => {
    let config;
    beforeEach(() => {
        config = new FileSourceConfig({
            enabled: true,
            statusMapping: {
                enabled: true,
                metadataToSymbol: {
                    'completed': 'x',
                    'done': 'x',
                    'in-progress': '/',
                    'in progress': '/',
                    'planned': '?',
                    'todo': '?',
                    'cancelled': '-',
                    'not-started': ' ',
                    'not started': ' '
                },
                symbolToMetadata: {
                    'x': 'completed',
                    'X': 'completed',
                    '/': 'in-progress',
                    '?': 'planned',
                    '-': 'cancelled',
                    ' ': 'not-started'
                },
                autoDetect: true,
                caseSensitive: false
            }
        });
    });
    describe("Metadata to Symbol Mapping", () => {
        test("should map common status values to symbols", () => {
            expect(config.mapMetadataToSymbol("completed")).toBe("x");
            expect(config.mapMetadataToSymbol("done")).toBe("x");
            expect(config.mapMetadataToSymbol("in-progress")).toBe("/");
            expect(config.mapMetadataToSymbol("planned")).toBe("?");
            expect(config.mapMetadataToSymbol("cancelled")).toBe("-");
            expect(config.mapMetadataToSymbol("not-started")).toBe(" ");
        });
        test("should handle case-insensitive matching when configured", () => {
            expect(config.mapMetadataToSymbol("Completed")).toBe("x");
            expect(config.mapMetadataToSymbol("DONE")).toBe("x");
            expect(config.mapMetadataToSymbol("In-Progress")).toBe("/");
            expect(config.mapMetadataToSymbol("ToDo")).toBe("?");
        });
        test("should handle values with spaces", () => {
            expect(config.mapMetadataToSymbol("in progress")).toBe("/");
            expect(config.mapMetadataToSymbol("not started")).toBe(" ");
        });
        test("should return original value if no mapping exists", () => {
            expect(config.mapMetadataToSymbol("unknown")).toBe("unknown");
            expect(config.mapMetadataToSymbol("custom-status")).toBe("custom-status");
        });
        test("should return original value when mapping is disabled", () => {
            const disabledConfig = new FileSourceConfig({
                enabled: true,
                statusMapping: {
                    enabled: false,
                    metadataToSymbol: { 'completed': 'x' },
                    symbolToMetadata: { 'x': 'completed' },
                    autoDetect: false,
                    caseSensitive: false
                }
            });
            expect(disabledConfig.mapMetadataToSymbol("completed")).toBe("completed");
            expect(disabledConfig.mapMetadataToSymbol("done")).toBe("done");
        });
        test("should handle case-sensitive matching when configured", () => {
            const caseSensitiveConfig = new FileSourceConfig({
                enabled: true,
                statusMapping: {
                    enabled: true,
                    metadataToSymbol: {
                        'completed': 'x',
                        'Completed': 'X'
                    },
                    symbolToMetadata: {},
                    autoDetect: false,
                    caseSensitive: true
                }
            });
            expect(caseSensitiveConfig.mapMetadataToSymbol("completed")).toBe("x");
            expect(caseSensitiveConfig.mapMetadataToSymbol("Completed")).toBe("X");
            expect(caseSensitiveConfig.mapMetadataToSymbol("COMPLETED")).toBe("COMPLETED");
        });
    });
    describe("Symbol to Metadata Mapping", () => {
        test("should map symbols back to metadata values", () => {
            expect(config.mapSymbolToMetadata("x")).toBe("completed");
            expect(config.mapSymbolToMetadata("X")).toBe("completed");
            expect(config.mapSymbolToMetadata("/")).toBe("in-progress");
            expect(config.mapSymbolToMetadata("?")).toBe("planned");
            expect(config.mapSymbolToMetadata("-")).toBe("cancelled");
            expect(config.mapSymbolToMetadata(" ")).toBe("not-started");
        });
        test("should return original symbol if no mapping exists", () => {
            expect(config.mapSymbolToMetadata("@")).toBe("@");
            expect(config.mapSymbolToMetadata("!")).toBe("!");
        });
        test("should return original symbol when mapping is disabled", () => {
            const disabledConfig = new FileSourceConfig({
                enabled: true,
                statusMapping: {
                    enabled: false,
                    metadataToSymbol: {},
                    symbolToMetadata: { 'x': 'completed' },
                    autoDetect: false,
                    caseSensitive: false
                }
            });
            expect(disabledConfig.mapSymbolToMetadata("x")).toBe("x");
            expect(disabledConfig.mapSymbolToMetadata("/")).toBe("/");
        });
    });
    describe("Status Recognition", () => {
        test("should recognize known status values", () => {
            expect(config.isRecognizedStatus("completed")).toBe(true);
            expect(config.isRecognizedStatus("done")).toBe(true);
            expect(config.isRecognizedStatus("x")).toBe(true);
            expect(config.isRecognizedStatus("/")).toBe(true);
            expect(config.isRecognizedStatus("?")).toBe(true);
        });
        test("should recognize status values case-insensitively", () => {
            expect(config.isRecognizedStatus("Completed")).toBe(true);
            expect(config.isRecognizedStatus("DONE")).toBe(true);
            expect(config.isRecognizedStatus("In-Progress")).toBe(true);
        });
        test("should not recognize unknown values", () => {
            expect(config.isRecognizedStatus("unknown")).toBe(false);
            expect(config.isRecognizedStatus("@")).toBe(false);
            expect(config.isRecognizedStatus("custom")).toBe(false);
        });
        test("should return false when mapping is disabled", () => {
            const disabledConfig = new FileSourceConfig({
                enabled: true,
                statusMapping: {
                    enabled: false,
                    metadataToSymbol: { 'completed': 'x' },
                    symbolToMetadata: { 'x': 'completed' },
                    autoDetect: false,
                    caseSensitive: false
                }
            });
            expect(disabledConfig.isRecognizedStatus("completed")).toBe(false);
            expect(disabledConfig.isRecognizedStatus("x")).toBe(false);
        });
    });
    describe("Task Status Sync", () => {
        test("should sync with task status configuration", () => {
            const taskStatuses = {
                completed: "x|X",
                inProgress: "/>",
                planned: "?",
                abandoned: "-",
                notStarted: " "
            };
            config.syncWithTaskStatuses(taskStatuses);
            const updatedConfig = config.getConfig();
            expect(updatedConfig.statusMapping.symbolToMetadata['x']).toBe('completed');
            expect(updatedConfig.statusMapping.symbolToMetadata['X']).toBe('completed');
            expect(updatedConfig.statusMapping.symbolToMetadata['/']).toBe('in-progress');
            expect(updatedConfig.statusMapping.symbolToMetadata['>']).toBe('in-progress');
            expect(updatedConfig.statusMapping.symbolToMetadata['?']).toBe('planned');
            expect(updatedConfig.statusMapping.symbolToMetadata['-']).toBe('cancelled');
            expect(updatedConfig.statusMapping.symbolToMetadata[' ']).toBe('not-started');
        });
        test("should not sync when autoDetect is disabled", () => {
            const noAutoConfig = new FileSourceConfig({
                enabled: true,
                statusMapping: {
                    enabled: true,
                    metadataToSymbol: {},
                    symbolToMetadata: { 'x': 'old-value' },
                    autoDetect: false,
                    caseSensitive: false
                }
            });
            const taskStatuses = {
                completed: "x|X",
                inProgress: "/"
            };
            noAutoConfig.syncWithTaskStatuses(taskStatuses);
            const updatedConfig = noAutoConfig.getConfig();
            // Should remain unchanged
            expect(updatedConfig.statusMapping.symbolToMetadata['x']).toBe('old-value');
        });
    });
    describe("Configuration Updates", () => {
        test("should notify listeners when configuration changes", (done) => {
            config.onChange((newConfig) => {
                expect(newConfig.statusMapping.metadataToSymbol['custom']).toBe('!');
                done();
            });
            config.updateConfig({
                statusMapping: {
                    enabled: true,
                    metadataToSymbol: { 'custom': '!' },
                    symbolToMetadata: { '!': 'custom' },
                    autoDetect: true,
                    caseSensitive: false
                }
            });
        });
        test("should merge partial updates with existing configuration", () => {
            config.updateConfig({
                statusMapping: {
                    enabled: true,
                    metadataToSymbol: { 'extra': '!' },
                    symbolToMetadata: {},
                    autoDetect: true,
                    caseSensitive: false
                }
            });
            const updatedConfig = config.getConfig();
            expect(updatedConfig.statusMapping.metadataToSymbol['extra']).toBe('!');
            // Original mappings should be lost with this update pattern
            // This is expected behavior for the current implementation
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLW1hcHBpbmcudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInN0YXR1cy1tYXBwaW5nLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBRzNFLFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7SUFDekMsSUFBSSxNQUF3QixDQUFDO0lBRTdCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxNQUFNLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBQztZQUM1QixPQUFPLEVBQUUsSUFBSTtZQUNiLGFBQWEsRUFBRTtnQkFDYixPQUFPLEVBQUUsSUFBSTtnQkFDYixnQkFBZ0IsRUFBRTtvQkFDaEIsV0FBVyxFQUFFLEdBQUc7b0JBQ2hCLE1BQU0sRUFBRSxHQUFHO29CQUNYLGFBQWEsRUFBRSxHQUFHO29CQUNsQixhQUFhLEVBQUUsR0FBRztvQkFDbEIsU0FBUyxFQUFFLEdBQUc7b0JBQ2QsTUFBTSxFQUFFLEdBQUc7b0JBQ1gsV0FBVyxFQUFFLEdBQUc7b0JBQ2hCLGFBQWEsRUFBRSxHQUFHO29CQUNsQixhQUFhLEVBQUUsR0FBRztpQkFDbkI7Z0JBQ0QsZ0JBQWdCLEVBQUU7b0JBQ2hCLEdBQUcsRUFBRSxXQUFXO29CQUNoQixHQUFHLEVBQUUsV0FBVztvQkFDaEIsR0FBRyxFQUFFLGFBQWE7b0JBQ2xCLEdBQUcsRUFBRSxTQUFTO29CQUNkLEdBQUcsRUFBRSxXQUFXO29CQUNoQixHQUFHLEVBQUUsYUFBYTtpQkFDbkI7Z0JBQ0QsVUFBVSxFQUFFLElBQUk7Z0JBQ2hCLGFBQWEsRUFBRSxLQUFLO2FBQ3JCO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1FBQzFDLElBQUksQ0FBQyw0Q0FBNEMsRUFBRSxHQUFHLEVBQUU7WUFDdEQsTUFBTSxD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QkFDYixnQkFBZ0IsRUFBRSxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUU7b0JBQ25DLGdCQUFnQixFQUFFLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRTtvQkFDbkMsVUFBVSxFQUFFLElBQUk7b0JBQ2hCLGFBQWEsRUFBRSxLQUFLO2lCQUNyQjthQUNGLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLDBEQUEwRCxFQUFFLEdBQUcsRUFBRTtZQUNwRSxNQUFNLENBQUMsWUFBWSxDQUFDO2dCQUNsQixhQUFhLEVBQUU7b0JBQ2IsT0FBTyxFQUFFLElBQUk7b0JBQ2IsZ0JBQWdCLEVBQUUsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFO29CQUNsQyxnQkFBZ0IsRUFBRSxFQUFFO29CQUNwQixVQUFVLEVBQUUsSUFBSTtvQkFDaEIsYUFBYSxFQUFFLEtBQUs7aUJBQ3JCO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3hFLDREQUE0RDtZQUM1RCwyREFBMkQ7UUFDN0QsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFN0YXR1cyBNYXBwaW5nIFRlc3RzXHJcbiAqIFxyXG4gKiBUZXN0cyBmb3IgdGhlIHN0YXR1cyBtYXBwaW5nIGZ1bmN0aW9uYWxpdHkgaW4gRmlsZVNvdXJjZVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEZpbGVTb3VyY2VDb25maWcgfSBmcm9tIFwiLi4vLi4vZGF0YWZsb3cvc291cmNlcy9GaWxlU291cmNlQ29uZmlnXCI7XHJcbmltcG9ydCB0eXBlIHsgRmlsZVNvdXJjZUNvbmZpZ3VyYXRpb24gfSBmcm9tIFwiLi4vLi4vdHlwZXMvZmlsZS1zb3VyY2VcIjtcclxuXHJcbmRlc2NyaWJlKFwiRmlsZVNvdXJjZSBTdGF0dXMgTWFwcGluZ1wiLCAoKSA9PiB7XHJcbiAgbGV0IGNvbmZpZzogRmlsZVNvdXJjZUNvbmZpZztcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBjb25maWcgPSBuZXcgRmlsZVNvdXJjZUNvbmZpZyh7XHJcbiAgICAgIGVuYWJsZWQ6IHRydWUsXHJcbiAgICAgIHN0YXR1c01hcHBpbmc6IHtcclxuICAgICAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgICAgIG1ldGFkYXRhVG9TeW1ib2w6IHtcclxuICAgICAgICAgICdjb21wbGV0ZWQnOiAneCcsXHJcbiAgICAgICAgICAnZG9uZSc6ICd4JyxcclxuICAgICAgICAgICdpbi1wcm9ncmVzcyc6ICcvJyxcclxuICAgICAgICAgICdpbiBwcm9ncmVzcyc6ICcvJyxcclxuICAgICAgICAgICdwbGFubmVkJzogJz8nLFxyXG4gICAgICAgICAgJ3RvZG8nOiAnPycsXHJcbiAgICAgICAgICAnY2FuY2VsbGVkJzogJy0nLFxyXG4gICAgICAgICAgJ25vdC1zdGFydGVkJzogJyAnLFxyXG4gICAgICAgICAgJ25vdCBzdGFydGVkJzogJyAnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzeW1ib2xUb01ldGFkYXRhOiB7XHJcbiAgICAgICAgICAneCc6ICdjb21wbGV0ZWQnLFxyXG4gICAgICAgICAgJ1gnOiAnY29tcGxldGVkJyxcclxuICAgICAgICAgICcvJzogJ2luLXByb2dyZXNzJyxcclxuICAgICAgICAgICc/JzogJ3BsYW5uZWQnLFxyXG4gICAgICAgICAgJy0nOiAnY2FuY2VsbGVkJyxcclxuICAgICAgICAgICcgJzogJ25vdC1zdGFydGVkJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXV0b0RldGVjdDogdHJ1ZSxcclxuICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoXCJNZXRhZGF0YSB0byBTeW1ib2wgTWFwcGluZ1wiLCAoKSA9PiB7XHJcbiAgICB0ZXN0KFwic2hvdWxkIG1hcCBjb21tb24gc3RhdHVzIHZhbHVlcyB0byBzeW1ib2xzXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBNZXRhZGF0YVRvU3ltYm9sKFwiY29tcGxldGVkXCIpKS50b0JlKFwieFwiKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBNZXRhZGF0YVRvU3ltYm9sKFwiZG9uZVwiKSkudG9CZShcInhcIik7XHJcbiAgICAgIGV4cGVjdChjb25maWcubWFwTWV0YWRhdGFUb1N5bWJvbChcImluLXByb2dyZXNzXCIpKS50b0JlKFwiL1wiKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBNZXRhZGF0YVRvU3ltYm9sKFwicGxhbm5lZFwiKSkudG9CZShcIj9cIik7XHJcbiAgICAgIGV4cGVjdChjb25maWcubWFwTWV0YWRhdGFUb1N5bWJvbChcImNhbmNlbGxlZFwiKSkudG9CZShcIi1cIik7XHJcbiAgICAgIGV4cGVjdChjb25maWcubWFwTWV0YWRhdGFUb1N5bWJvbChcIm5vdC1zdGFydGVkXCIpKS50b0JlKFwiIFwiKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoXCJzaG91bGQgaGFuZGxlIGNhc2UtaW5zZW5zaXRpdmUgbWF0Y2hpbmcgd2hlbiBjb25maWd1cmVkXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBNZXRhZGF0YVRvU3ltYm9sKFwiQ29tcGxldGVkXCIpKS50b0JlKFwieFwiKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBNZXRhZGF0YVRvU3ltYm9sKFwiRE9ORVwiKSkudG9CZShcInhcIik7XHJcbiAgICAgIGV4cGVjdChjb25maWcubWFwTWV0YWRhdGFUb1N5bWJvbChcIkluLVByb2dyZXNzXCIpKS50b0JlKFwiL1wiKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBNZXRhZGF0YVRvU3ltYm9sKFwiVG9Eb1wiKSkudG9CZShcIj9cIik7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KFwic2hvdWxkIGhhbmRsZSB2YWx1ZXMgd2l0aCBzcGFjZXNcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoY29uZmlnLm1hcE1ldGFkYXRhVG9TeW1ib2woXCJpbiBwcm9ncmVzc1wiKSkudG9CZShcIi9cIik7XHJcbiAgICAgIGV4cGVjdChjb25maWcubWFwTWV0YWRhdGFUb1N5bWJvbChcIm5vdCBzdGFydGVkXCIpKS50b0JlKFwiIFwiKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoXCJzaG91bGQgcmV0dXJuIG9yaWdpbmFsIHZhbHVlIGlmIG5vIG1hcHBpbmcgZXhpc3RzXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBNZXRhZGF0YVRvU3ltYm9sKFwidW5rbm93blwiKSkudG9CZShcInVua25vd25cIik7XHJcbiAgICAgIGV4cGVjdChjb25maWcubWFwTWV0YWRhdGFUb1N5bWJvbChcImN1c3RvbS1zdGF0dXNcIikpLnRvQmUoXCJjdXN0b20tc3RhdHVzXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdChcInNob3VsZCByZXR1cm4gb3JpZ2luYWwgdmFsdWUgd2hlbiBtYXBwaW5nIGlzIGRpc2FibGVkXCIsICgpID0+IHtcclxuICAgICAgY29uc3QgZGlzYWJsZWRDb25maWcgPSBuZXcgRmlsZVNvdXJjZUNvbmZpZyh7XHJcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICBzdGF0dXNNYXBwaW5nOiB7XHJcbiAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcclxuICAgICAgICAgIG1ldGFkYXRhVG9TeW1ib2w6IHsgJ2NvbXBsZXRlZCc6ICd4JyB9LFxyXG4gICAgICAgICAgc3ltYm9sVG9NZXRhZGF0YTogeyAneCc6ICdjb21wbGV0ZWQnIH0sXHJcbiAgICAgICAgICBhdXRvRGV0ZWN0OiBmYWxzZSxcclxuICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChkaXNhYmxlZENvbmZpZy5tYXBNZXRhZGF0YVRvU3ltYm9sKFwiY29tcGxldGVkXCIpKS50b0JlKFwiY29tcGxldGVkXCIpO1xyXG4gICAgICBleHBlY3QoZGlzYWJsZWRDb25maWcubWFwTWV0YWRhdGFUb1N5bWJvbChcImRvbmVcIikpLnRvQmUoXCJkb25lXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdChcInNob3VsZCBoYW5kbGUgY2FzZS1zZW5zaXRpdmUgbWF0Y2hpbmcgd2hlbiBjb25maWd1cmVkXCIsICgpID0+IHtcclxuICAgICAgY29uc3QgY2FzZVNlbnNpdGl2ZUNvbmZpZyA9IG5ldyBGaWxlU291cmNlQ29uZmlnKHtcclxuICAgICAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgICAgIHN0YXR1c01hcHBpbmc6IHtcclxuICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICBtZXRhZGF0YVRvU3ltYm9sOiB7XHJcbiAgICAgICAgICAgICdjb21wbGV0ZWQnOiAneCcsXHJcbiAgICAgICAgICAgICdDb21wbGV0ZWQnOiAnWCdcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBzeW1ib2xUb01ldGFkYXRhOiB7fSxcclxuICAgICAgICAgIGF1dG9EZXRlY3Q6IGZhbHNlLFxyXG4gICAgICAgICAgY2FzZVNlbnNpdGl2ZTogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QoY2FzZVNlbnNpdGl2ZUNvbmZpZy5tYXBNZXRhZGF0YVRvU3ltYm9sKFwiY29tcGxldGVkXCIpKS50b0JlKFwieFwiKTtcclxuICAgICAgZXhwZWN0KGNhc2VTZW5zaXRpdmVDb25maWcubWFwTWV0YWRhdGFUb1N5bWJvbChcIkNvbXBsZXRlZFwiKSkudG9CZShcIlhcIik7XHJcbiAgICAgIGV4cGVjdChjYXNlU2Vuc2l0aXZlQ29uZmlnLm1hcE1ldGFkYXRhVG9TeW1ib2woXCJDT01QTEVURURcIikpLnRvQmUoXCJDT01QTEVURURcIik7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoXCJTeW1ib2wgdG8gTWV0YWRhdGEgTWFwcGluZ1wiLCAoKSA9PiB7XHJcbiAgICB0ZXN0KFwic2hvdWxkIG1hcCBzeW1ib2xzIGJhY2sgdG8gbWV0YWRhdGEgdmFsdWVzXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBTeW1ib2xUb01ldGFkYXRhKFwieFwiKSkudG9CZShcImNvbXBsZXRlZFwiKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBTeW1ib2xUb01ldGFkYXRhKFwiWFwiKSkudG9CZShcImNvbXBsZXRlZFwiKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBTeW1ib2xUb01ldGFkYXRhKFwiL1wiKSkudG9CZShcImluLXByb2dyZXNzXCIpO1xyXG4gICAgICBleHBlY3QoY29uZmlnLm1hcFN5bWJvbFRvTWV0YWRhdGEoXCI/XCIpKS50b0JlKFwicGxhbm5lZFwiKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBTeW1ib2xUb01ldGFkYXRhKFwiLVwiKSkudG9CZShcImNhbmNlbGxlZFwiKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBTeW1ib2xUb01ldGFkYXRhKFwiIFwiKSkudG9CZShcIm5vdC1zdGFydGVkXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdChcInNob3VsZCByZXR1cm4gb3JpZ2luYWwgc3ltYm9sIGlmIG5vIG1hcHBpbmcgZXhpc3RzXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5tYXBTeW1ib2xUb01ldGFkYXRhKFwiQFwiKSkudG9CZShcIkBcIik7XHJcbiAgICAgIGV4cGVjdChjb25maWcubWFwU3ltYm9sVG9NZXRhZGF0YShcIiFcIikpLnRvQmUoXCIhXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdChcInNob3VsZCByZXR1cm4gb3JpZ2luYWwgc3ltYm9sIHdoZW4gbWFwcGluZyBpcyBkaXNhYmxlZFwiLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRpc2FibGVkQ29uZmlnID0gbmV3IEZpbGVTb3VyY2VDb25maWcoe1xyXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgc3RhdHVzTWFwcGluZzoge1xyXG4gICAgICAgICAgZW5hYmxlZDogZmFsc2UsXHJcbiAgICAgICAgICBtZXRhZGF0YVRvU3ltYm9sOiB7fSxcclxuICAgICAgICAgIHN5bWJvbFRvTWV0YWRhdGE6IHsgJ3gnOiAnY29tcGxldGVkJyB9LFxyXG4gICAgICAgICAgYXV0b0RldGVjdDogZmFsc2UsXHJcbiAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBleHBlY3QoZGlzYWJsZWRDb25maWcubWFwU3ltYm9sVG9NZXRhZGF0YShcInhcIikpLnRvQmUoXCJ4XCIpO1xyXG4gICAgICBleHBlY3QoZGlzYWJsZWRDb25maWcubWFwU3ltYm9sVG9NZXRhZGF0YShcIi9cIikpLnRvQmUoXCIvXCIpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKFwiU3RhdHVzIFJlY29nbml0aW9uXCIsICgpID0+IHtcclxuICAgIHRlc3QoXCJzaG91bGQgcmVjb2duaXplIGtub3duIHN0YXR1cyB2YWx1ZXNcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoY29uZmlnLmlzUmVjb2duaXplZFN0YXR1cyhcImNvbXBsZXRlZFwiKSkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5pc1JlY29nbml6ZWRTdGF0dXMoXCJkb25lXCIpKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QoY29uZmlnLmlzUmVjb2duaXplZFN0YXR1cyhcInhcIikpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChjb25maWcuaXNSZWNvZ25pemVkU3RhdHVzKFwiL1wiKSkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5pc1JlY29nbml6ZWRTdGF0dXMoXCI/XCIpKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdChcInNob3VsZCByZWNvZ25pemUgc3RhdHVzIHZhbHVlcyBjYXNlLWluc2Vuc2l0aXZlbHlcIiwgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoY29uZmlnLmlzUmVjb2duaXplZFN0YXR1cyhcIkNvbXBsZXRlZFwiKSkudG9CZSh0cnVlKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5pc1JlY29nbml6ZWRTdGF0dXMoXCJET05FXCIpKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QoY29uZmlnLmlzUmVjb2duaXplZFN0YXR1cyhcIkluLVByb2dyZXNzXCIpKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdChcInNob3VsZCBub3QgcmVjb2duaXplIHVua25vd24gdmFsdWVzXCIsICgpID0+IHtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5pc1JlY29nbml6ZWRTdGF0dXMoXCJ1bmtub3duXCIpKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5pc1JlY29nbml6ZWRTdGF0dXMoXCJAXCIpKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KGNvbmZpZy5pc1JlY29nbml6ZWRTdGF0dXMoXCJjdXN0b21cIikpLnRvQmUoZmFsc2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdChcInNob3VsZCByZXR1cm4gZmFsc2Ugd2hlbiBtYXBwaW5nIGlzIGRpc2FibGVkXCIsICgpID0+IHtcclxuICAgICAgY29uc3QgZGlzYWJsZWRDb25maWcgPSBuZXcgRmlsZVNvdXJjZUNvbmZpZyh7XHJcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICBzdGF0dXNNYXBwaW5nOiB7XHJcbiAgICAgICAgICBlbmFibGVkOiBmYWxzZSxcclxuICAgICAgICAgIG1ldGFkYXRhVG9TeW1ib2w6IHsgJ2NvbXBsZXRlZCc6ICd4JyB9LFxyXG4gICAgICAgICAgc3ltYm9sVG9NZXRhZGF0YTogeyAneCc6ICdjb21wbGV0ZWQnIH0sXHJcbiAgICAgICAgICBhdXRvRGV0ZWN0OiBmYWxzZSxcclxuICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGZhbHNlXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChkaXNhYmxlZENvbmZpZy5pc1JlY29nbml6ZWRTdGF0dXMoXCJjb21wbGV0ZWRcIikpLnRvQmUoZmFsc2UpO1xyXG4gICAgICBleHBlY3QoZGlzYWJsZWRDb25maWcuaXNSZWNvZ25pemVkU3RhdHVzKFwieFwiKSkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoXCJUYXNrIFN0YXR1cyBTeW5jXCIsICgpID0+IHtcclxuICAgIHRlc3QoXCJzaG91bGQgc3luYyB3aXRoIHRhc2sgc3RhdHVzIGNvbmZpZ3VyYXRpb25cIiwgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0YXNrU3RhdHVzZXMgPSB7XHJcbiAgICAgICAgY29tcGxldGVkOiBcInh8WFwiLFxyXG4gICAgICAgIGluUHJvZ3Jlc3M6IFwiLz5cIixcclxuICAgICAgICBwbGFubmVkOiBcIj9cIixcclxuICAgICAgICBhYmFuZG9uZWQ6IFwiLVwiLFxyXG4gICAgICAgIG5vdFN0YXJ0ZWQ6IFwiIFwiXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25maWcuc3luY1dpdGhUYXNrU3RhdHVzZXModGFza1N0YXR1c2VzKTtcclxuICAgICAgY29uc3QgdXBkYXRlZENvbmZpZyA9IGNvbmZpZy5nZXRDb25maWcoKTtcclxuXHJcbiAgICAgIGV4cGVjdCh1cGRhdGVkQ29uZmlnLnN0YXR1c01hcHBpbmcuc3ltYm9sVG9NZXRhZGF0YVsneCddKS50b0JlKCdjb21wbGV0ZWQnKTtcclxuICAgICAgZXhwZWN0KHVwZGF0ZWRDb25maWcuc3RhdHVzTWFwcGluZy5zeW1ib2xUb01ldGFkYXRhWydYJ10pLnRvQmUoJ2NvbXBsZXRlZCcpO1xyXG4gICAgICBleHBlY3QodXBkYXRlZENvbmZpZy5zdGF0dXNNYXBwaW5nLnN5bWJvbFRvTWV0YWRhdGFbJy8nXSkudG9CZSgnaW4tcHJvZ3Jlc3MnKTtcclxuICAgICAgZXhwZWN0KHVwZGF0ZWRDb25maWcuc3RhdHVzTWFwcGluZy5zeW1ib2xUb01ldGFkYXRhWyc+J10pLnRvQmUoJ2luLXByb2dyZXNzJyk7XHJcbiAgICAgIGV4cGVjdCh1cGRhdGVkQ29uZmlnLnN0YXR1c01hcHBpbmcuc3ltYm9sVG9NZXRhZGF0YVsnPyddKS50b0JlKCdwbGFubmVkJyk7XHJcbiAgICAgIGV4cGVjdCh1cGRhdGVkQ29uZmlnLnN0YXR1c01hcHBpbmcuc3ltYm9sVG9NZXRhZGF0YVsnLSddKS50b0JlKCdjYW5jZWxsZWQnKTtcclxuICAgICAgZXhwZWN0KHVwZGF0ZWRDb25maWcuc3RhdHVzTWFwcGluZy5zeW1ib2xUb01ldGFkYXRhWycgJ10pLnRvQmUoJ25vdC1zdGFydGVkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KFwic2hvdWxkIG5vdCBzeW5jIHdoZW4gYXV0b0RldGVjdCBpcyBkaXNhYmxlZFwiLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IG5vQXV0b0NvbmZpZyA9IG5ldyBGaWxlU291cmNlQ29uZmlnKHtcclxuICAgICAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgICAgIHN0YXR1c01hcHBpbmc6IHtcclxuICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXHJcbiAgICAgICAgICBtZXRhZGF0YVRvU3ltYm9sOiB7fSxcclxuICAgICAgICAgIHN5bWJvbFRvTWV0YWRhdGE6IHsgJ3gnOiAnb2xkLXZhbHVlJyB9LFxyXG4gICAgICAgICAgYXV0b0RldGVjdDogZmFsc2UsXHJcbiAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCB0YXNrU3RhdHVzZXMgPSB7XHJcbiAgICAgICAgY29tcGxldGVkOiBcInh8WFwiLFxyXG4gICAgICAgIGluUHJvZ3Jlc3M6IFwiL1wiXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBub0F1dG9Db25maWcuc3luY1dpdGhUYXNrU3RhdHVzZXModGFza1N0YXR1c2VzKTtcclxuICAgICAgY29uc3QgdXBkYXRlZENvbmZpZyA9IG5vQXV0b0NvbmZpZy5nZXRDb25maWcoKTtcclxuXHJcbiAgICAgIC8vIFNob3VsZCByZW1haW4gdW5jaGFuZ2VkXHJcbiAgICAgIGV4cGVjdCh1cGRhdGVkQ29uZmlnLnN0YXR1c01hcHBpbmcuc3ltYm9sVG9NZXRhZGF0YVsneCddKS50b0JlKCdvbGQtdmFsdWUnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZShcIkNvbmZpZ3VyYXRpb24gVXBkYXRlc1wiLCAoKSA9PiB7XHJcbiAgICB0ZXN0KFwic2hvdWxkIG5vdGlmeSBsaXN0ZW5lcnMgd2hlbiBjb25maWd1cmF0aW9uIGNoYW5nZXNcIiwgKGRvbmU6ICgpID0+IHZvaWQpID0+IHtcclxuICAgICAgY29uZmlnLm9uQ2hhbmdlKChuZXdDb25maWcpID0+IHtcclxuICAgICAgICBleHBlY3QobmV3Q29uZmlnLnN0YXR1c01hcHBpbmcubWV0YWRhdGFUb1N5bWJvbFsnY3VzdG9tJ10pLnRvQmUoJyEnKTtcclxuICAgICAgICBkb25lKCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uZmlnLnVwZGF0ZUNvbmZpZyh7XHJcbiAgICAgICAgc3RhdHVzTWFwcGluZzoge1xyXG4gICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgIG1ldGFkYXRhVG9TeW1ib2w6IHsgJ2N1c3RvbSc6ICchJyB9LFxyXG4gICAgICAgICAgc3ltYm9sVG9NZXRhZGF0YTogeyAnISc6ICdjdXN0b20nIH0sXHJcbiAgICAgICAgICBhdXRvRGV0ZWN0OiB0cnVlLFxyXG4gICAgICAgICAgY2FzZVNlbnNpdGl2ZTogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdChcInNob3VsZCBtZXJnZSBwYXJ0aWFsIHVwZGF0ZXMgd2l0aCBleGlzdGluZyBjb25maWd1cmF0aW9uXCIsICgpID0+IHtcclxuICAgICAgY29uZmlnLnVwZGF0ZUNvbmZpZyh7XHJcbiAgICAgICAgc3RhdHVzTWFwcGluZzoge1xyXG4gICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcclxuICAgICAgICAgIG1ldGFkYXRhVG9TeW1ib2w6IHsgJ2V4dHJhJzogJyEnIH0sXHJcbiAgICAgICAgICBzeW1ib2xUb01ldGFkYXRhOiB7fSxcclxuICAgICAgICAgIGF1dG9EZXRlY3Q6IHRydWUsXHJcbiAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zdCB1cGRhdGVkQ29uZmlnID0gY29uZmlnLmdldENvbmZpZygpO1xyXG4gICAgICBleHBlY3QodXBkYXRlZENvbmZpZy5zdGF0dXNNYXBwaW5nLm1ldGFkYXRhVG9TeW1ib2xbJ2V4dHJhJ10pLnRvQmUoJyEnKTtcclxuICAgICAgLy8gT3JpZ2luYWwgbWFwcGluZ3Mgc2hvdWxkIGJlIGxvc3Qgd2l0aCB0aGlzIHVwZGF0ZSBwYXR0ZXJuXHJcbiAgICAgIC8vIFRoaXMgaXMgZXhwZWN0ZWQgYmVoYXZpb3IgZm9yIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uXHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il19