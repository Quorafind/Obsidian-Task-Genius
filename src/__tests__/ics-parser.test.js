/**
 * ICS Parser Tests
 * Tests for parsing Chinese Lunar Calendar ICS data
 */
import { __awaiter } from "tslib";
import { IcsParser } from "../parsers/ics-parser";
describe("ICS Parser", () => {
    const testSource = {
        id: "test-chinese-lunar",
        name: "Chinese Lunar Calendar Test",
        url: "https://lwlsw.github.io/Chinese-Lunar-Calendar-ics/chinese_lunar_my.ics",
        enabled: true,
        refreshInterval: 60,
        showAllDayEvents: true,
        showTimedEvents: true,
        showType: "event",
    };
    let icsContent;
    beforeAll(() => __awaiter(void 0, void 0, void 0, function* () {
        // Fetch the actual ICS content for testing
        try {
            const response = yield fetch(testSource.url);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            icsContent = yield response.text();
            console.log(`Fetched ICS content: ${icsContent.length} characters`);
        }
        catch (error) {
            console.warn("Failed to fetch ICS content, using mock data");
            icsContent = getMockIcsContent();
        }
    }));
    describe("Basic Parsing", () => {
        test("should parse ICS content without errors", () => {
            const result = IcsParser.parse(icsContent, testSource);
            expect(result).toBeDefined();
            expect(result.events).toBeDefined();
            expect(result.errors).toBeDefined();
            expect(result.metadata).toBeDefined();
            console.log(`Parsed ${result.events.length} events with ${result.errors.length} errors`);
        });
        test("should extract calendar metadata", () => {
            const result = IcsParser.parse(icsContent, testSource);
            expect(result.metadata).toBeDefined();
            // Chinese Lunar Calendar should have some metadata
            if (result.metadata.calendarName) {
                expect(typeof result.metadata.calendarName).toBe("string");
            }
            if (result.metadata.version) {
                expect(result.metadata.version).toBe("2.0");
            }
        });
        test("should parse events with required fields", () => {
            const result = IcsParser.parse(icsContent, testSource);
            expect(result.events.length).toBeGreaterThan(0);
            // Check first few events have required fields
            const sampleEvents = result.events.slice(0, 5);
            sampleEvents.forEach((event, index) => {
                expect(event.uid).toBeDefined();
                expect(event.summary).toBeDefined();
                expect(event.dtstart).toBeDefined();
                expect(event.source).toBe(testSource);
                console.log(`Event ${index + 1}: ${event.summary} on ${event.dtstart.toDateString()}`);
            });
        });
    });
    describe("Chinese Lunar Calendar Specific Tests", () => {
        test("should parse lunar festival events", () => {
            const result = IcsParser.parse(icsContent, testSource);
            // Look for common Chinese festivals
            const festivals = result.events.filter((event) => event.summary.includes("春节") ||
                event.summary.includes("中秋") ||
                event.summary.includes("端午") ||
                event.summary.includes("元宵") ||
                event.summary.includes("七夕") ||
                event.summary.includes("重阳"));
            expect(festivals.length).toBeGreaterThan(0);
            console.log(`Found ${festivals.length} Chinese festival events`);
            festivals.slice(0, 3).forEach((festival) => {
                console.log(`Festival: ${festival.summary} on ${festival.dtstart.toDateString()}`);
            });
        });
        test("should parse lunar month events", () => {
            const result = IcsParser.parse(icsContent, testSource);
            // Look for lunar month indicators
            const lunarEvents = result.events.filter((event) => event.summary.includes("农历") ||
                event.summary.includes("正月") ||
                event.summary.includes("二月") ||
                event.summary.includes("三月") ||
                event.summary.includes("初一") ||
                event.summary.includes("十五"));
            expect(lunarEvents.length).toBeGreaterThan(0);
            console.log(`Found ${lunarEvents.length} lunar calendar events`);
        });
        test("should handle all-day events correctly", () => {
            const result = IcsParser.parse(icsContent, testSource);
            const allDayEvents = result.events.filter((event) => event.allDay);
            const timedEvents = result.events.filter((event) => !event.allDay);
            console.log(`All-day events: ${allDayEvents.length}, Timed events: ${timedEvents.length}`);
            // Most Chinese lunar calendar events should be all-day
            expect(allDayEvents.length).toBeGreaterThan(0);
        });
    });
    describe("Date Parsing", () => {
        test("should parse dates correctly", () => {
            const result = IcsParser.parse(icsContent, testSource);
            result.events.slice(0, 10).forEach((event) => {
                expect(event.dtstart).toBeInstanceOf(Date);
                expect(event.dtstart.getTime()).not.toBeNaN();
                if (event.dtend) {
                    expect(event.dtend).toBeInstanceOf(Date);
                    expect(event.dtend.getTime()).not.toBeNaN();
                    expect(event.dtend.getTime()).toBeGreaterThanOrEqual(event.dtstart.getTime());
                }
            });
        });
        test("should handle current year events", () => {
            const result = IcsParser.parse(icsContent, testSource);
            const currentYear = new Date().getFullYear();
            const currentYearEvents = result.events.filter((event) => event.dtstart.getFullYear() === currentYear);
            expect(currentYearEvents.length).toBeGreaterThan(0);
            console.log(`Found ${currentYearEvents.length} events for ${currentYear}`);
        });
    });
    describe("Error Handling", () => {
        test("should handle malformed ICS content gracefully", () => {
            const malformedContent = `
BEGIN:VCALENDAR
VERSION:2.0
PRODID:Test
BEGIN:VEVENT
UID:test-1
SUMMARY:Test Event
INVALID_PROPERTY_WITHOUT_COLON
END:VEVENT
END:VCALENDAR
			`;
            const result = IcsParser.parse(malformedContent, testSource);
            expect(result.events).toBeDefined();
            expect(result.errors).toBeDefined();
            expect(result.errors.length).toBeGreaterThan(0);
        });
        test("should handle empty content", () => {
            const result = IcsParser.parse("", testSource);
            expect(result.events).toHaveLength(0);
            expect(result.errors).toBeDefined();
        });
        test("should handle non-ICS content", () => {
            const result = IcsParser.parse("This is not ICS content", testSource);
            expect(result.events).toHaveLength(0);
            expect(result.errors).toBeDefined();
        });
    });
    describe("Performance Tests", () => {
        test("should parse large ICS content efficiently", () => {
            const startTime = performance.now();
            const result = IcsParser.parse(icsContent, testSource);
            const endTime = performance.now();
            const parseTime = endTime - startTime;
            console.log(`Parsing took ${parseTime.toFixed(2)}ms for ${result.events.length} events`);
            // Should parse within reasonable time (adjust threshold as needed)
            expect(parseTime).toBeLessThan(5000); // 5 seconds max
        });
    });
});
/**
 * Mock ICS content for testing when network is unavailable
 */
function getMockIcsContent() {
    return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Test//Chinese Lunar Calendar//EN
CALSCALE:GREGORIAN
X-WR-CALNAME:中国农历
X-WR-CALDESC:中国传统农历节日
BEGIN:VEVENT
UID:spring-festival-2024
DTSTART;VALUE=DATE:20240210
SUMMARY:春节 (农历正月初一)
DESCRIPTION:中国传统新年，农历正月初一
CATEGORIES:节日,传统节日
STATUS:CONFIRMED
TRANSP:TRANSPARENT
END:VEVENT
BEGIN:VEVENT
UID:lantern-festival-2024
DTSTART;VALUE=DATE:20240224
SUMMARY:元宵节 (农历正月十五)
DESCRIPTION:农历正月十五，传统元宵节
CATEGORIES:节日,传统节日
STATUS:CONFIRMED
TRANSP:TRANSPARENT
END:VEVENT
BEGIN:VEVENT
UID:dragon-boat-festival-2024
DTSTART;VALUE=DATE:20240610
SUMMARY:端午节 (农历五月初五)
DESCRIPTION:农历五月初五，纪念屈原
CATEGORIES:节日,传统节日
STATUS:CONFIRMED
TRANSP:TRANSPARENT
END:VEVENT
BEGIN:VEVENT
UID:mid-autumn-festival-2024
DTSTART;VALUE=DATE:20240917
SUMMARY:中秋节 (农历八月十五)
DESCRIPTION:农历八月十五，团圆节
CATEGORIES:节日,传统节日
STATUS:CONFIRMED
TRANSP:TRANSPARENT
END:VEVENT
BEGIN:VEVENT
UID:double-ninth-festival-2024
DTSTART;VALUE=DATE:20241011
SUMMARY:重阳节 (农历九月初九)
DESCRIPTION:农历九月初九，登高节
CATEGORIES:节日,传统节日
STATUS:CONFIRMED
TRANSP:TRANSPARENT
END:VEVENT
END:VCALENDAR`;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWNzLXBhcnNlci50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaWNzLXBhcnNlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7R0FHRzs7QUFFSCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFHbEQsUUFBUSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUU7SUFDM0IsTUFBTSxVQUFVLEdBQWM7UUFDN0IsRUFBRSxFQUFFLG9CQUFvQjtRQUN4QixJQUFJLEVBQUUsNkJBQTZCO1FBQ25DLEdBQUcsRUFBRSx5RUFBeUU7UUFDOUUsT0FBTyxFQUFFLElBQUk7UUFDYixlQUFlLEVBQUUsRUFBRTtRQUNuQixnQkFBZ0IsRUFBRSxJQUFJO1FBQ3RCLGVBQWUsRUFBRSxJQUFJO1FBQ3JCLFFBQVEsRUFBRSxPQUFPO0tBQ2pCLENBQUM7SUFFRixJQUFJLFVBQWtCLENBQUM7SUFFdkIsU0FBUyxDQUFDLEdBQVMsRUFBRTtRQUNwQiwyQ0FBMkM7UUFDM0MsSUFBSTtZQUNILE1BQU0sUUFBUSxHQUFHLE1BQU0sS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM3QyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRTtnQkFDakIsTUFBTSxJQUFJLEtBQUssQ0FDZCxRQUFRLFFBQVEsQ0FBQyxNQUFNLEtBQUssUUFBUSxDQUFDLFVBQVUsRUFBRSxDQUNqRCxDQUFDO2FBQ0Y7WUFDRCxVQUFVLEdBQUcsTUFBTSxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDbkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsVUFBVSxDQUFDLE1BQU0sYUFBYSxDQUFDLENBQUM7U0FDcEU7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNmLE9BQU8sQ0FBQyxJQUFJLENBQUMsOENBQThDLENBQUMsQ0FBQztZQUM3RCxVQUFVLEdBQUcsaUJBQWlCLEVBQUUsQ0FBQztTQUNqQztJQUNGLENBQUMsQ0FBQSxDQUFD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O0dBRUc7QUFDSCxTQUFTLGlCQUFpQjtJQUN6QixPQUFPOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Y0FtRE0sQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogSUNTIFBhcnNlciBUZXN0c1xyXG4gKiBUZXN0cyBmb3IgcGFyc2luZyBDaGluZXNlIEx1bmFyIENhbGVuZGFyIElDUyBkYXRhXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgSWNzUGFyc2VyIH0gZnJvbSBcIi4uL3BhcnNlcnMvaWNzLXBhcnNlclwiO1xyXG5pbXBvcnQgeyBJY3NTb3VyY2UsIEljc0V2ZW50IH0gZnJvbSBcIi4uL3R5cGVzL2ljc1wiO1xyXG5cclxuZGVzY3JpYmUoXCJJQ1MgUGFyc2VyXCIsICgpID0+IHtcclxuXHRjb25zdCB0ZXN0U291cmNlOiBJY3NTb3VyY2UgPSB7XHJcblx0XHRpZDogXCJ0ZXN0LWNoaW5lc2UtbHVuYXJcIixcclxuXHRcdG5hbWU6IFwiQ2hpbmVzZSBMdW5hciBDYWxlbmRhciBUZXN0XCIsXHJcblx0XHR1cmw6IFwiaHR0cHM6Ly9sd2xzdy5naXRodWIuaW8vQ2hpbmVzZS1MdW5hci1DYWxlbmRhci1pY3MvY2hpbmVzZV9sdW5hcl9teS5pY3NcIixcclxuXHRcdGVuYWJsZWQ6IHRydWUsXHJcblx0XHRyZWZyZXNoSW50ZXJ2YWw6IDYwLFxyXG5cdFx0c2hvd0FsbERheUV2ZW50czogdHJ1ZSxcclxuXHRcdHNob3dUaW1lZEV2ZW50czogdHJ1ZSwgXHJcblx0XHRzaG93VHlwZTogXCJldmVudFwiLFxyXG5cdH07XHJcblxyXG5cdGxldCBpY3NDb250ZW50OiBzdHJpbmc7XHJcblxyXG5cdGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XHJcblx0XHQvLyBGZXRjaCB0aGUgYWN0dWFsIElDUyBjb250ZW50IGZvciB0ZXN0aW5nXHJcblx0XHR0cnkge1xyXG5cdFx0XHRjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHRlc3RTb3VyY2UudXJsKTtcclxuXHRcdFx0aWYgKCFyZXNwb25zZS5vaykge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcclxuXHRcdFx0XHRcdGBIVFRQICR7cmVzcG9uc2Uuc3RhdHVzfTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWBcclxuXHRcdFx0XHQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGljc0NvbnRlbnQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XHJcblx0XHRcdGNvbnNvbGUubG9nKGBGZXRjaGVkIElDUyBjb250ZW50OiAke2ljc0NvbnRlbnQubGVuZ3RofSBjaGFyYWN0ZXJzYCk7XHJcblx0XHR9IGNhdGNoIChlcnJvcikge1xyXG5cdFx0XHRjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gZmV0Y2ggSUNTIGNvbnRlbnQsIHVzaW5nIG1vY2sgZGF0YVwiKTtcclxuXHRcdFx0aWNzQ29udGVudCA9IGdldE1vY2tJY3NDb250ZW50KCk7XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdGRlc2NyaWJlKFwiQmFzaWMgUGFyc2luZ1wiLCAoKSA9PiB7XHJcblx0XHR0ZXN0KFwic2hvdWxkIHBhcnNlIElDUyBjb250ZW50IHdpdGhvdXQgZXJyb3JzXCIsICgpID0+IHtcclxuXHRcdFx0Y29uc3QgcmVzdWx0ID0gSWNzUGFyc2VyLnBhcnNlKGljc0NvbnRlbnQsIHRlc3RTb3VyY2UpO1xyXG5cclxuXHRcdFx0ZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcclxuXHRcdFx0ZXhwZWN0KHJlc3VsdC5ldmVudHMpLnRvQmVEZWZpbmVkKCk7XHJcblx0XHRcdGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0JlRGVmaW5lZCgpO1xyXG5cdFx0XHRleHBlY3QocmVzdWx0Lm1ldGFkYXRhKS50b0JlRGVmaW5lZCgpO1xyXG5cclxuXHRcdFx0Y29uc29sZS5sb2coXHJcblx0XHRcdFx0YFBhcnNlZCAke3Jlc3VsdC5ldmVudHMubGVuZ3RofSBldmVudHMgd2l0aCAke3Jlc3VsdC5lcnJvcnMubGVuZ3RofSBlcnJvcnNgXHJcblx0XHRcdCk7XHJcblx0XHR9KTtcclxuXHJcblx0XHR0ZXN0KFwic2hvdWxkIGV4dHJhY3QgY2FsZW5kYXIgbWV0YWRhdGFcIiwgKCkgPT4ge1xyXG5cdFx0XHRjb25zdCByZXN1bHQgPSBJY3NQYXJzZXIucGFyc2UoaWNzQ29udGVudCwgdGVzdFNvdXJjZSk7XHJcblxyXG5cdFx0XHRleHBlY3QocmVzdWx0Lm1ldGFkYXRhKS50b0JlRGVmaW5lZCgpO1xyXG5cdFx0XHQvLyBDaGluZXNlIEx1bmFyIENhbGVuZGFyIHNob3VsZCBoYXZlIHNvbWUgbWV0YWRhdGFcclxuXHRcdFx0aWYgKHJlc3VsdC5tZXRhZGF0YS5jYWxlbmRhck5hbWUpIHtcclxuXHRcdFx0XHRleHBlY3QodHlwZW9mIHJlc3VsdC5tZXRhZGF0YS5jYWxlbmRhck5hbWUpLnRvQmUoXCJzdHJpbmdcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHJlc3VsdC5tZXRhZGF0YS52ZXJzaW9uKSB7XHJcblx0XHRcdFx0ZXhwZWN0KHJlc3VsdC5tZXRhZGF0YS52ZXJzaW9uKS50b0JlKFwiMi4wXCIpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0XHR0ZXN0KFwic2hvdWxkIHBhcnNlIGV2ZW50cyB3aXRoIHJlcXVpcmVkIGZpZWxkc1wiLCAoKSA9PiB7XHJcblx0XHRcdGNvbnN0IHJlc3VsdCA9IEljc1BhcnNlci5wYXJzZShpY3NDb250ZW50LCB0ZXN0U291cmNlKTtcclxuXHJcblx0XHRcdGV4cGVjdChyZXN1bHQuZXZlbnRzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG5cclxuXHRcdFx0Ly8gQ2hlY2sgZmlyc3QgZmV3IGV2ZW50cyBoYXZlIHJlcXVpcmVkIGZpZWxkc1xyXG5cdFx0XHRjb25zdCBzYW1wbGVFdmVudHMgPSByZXN1bHQuZXZlbnRzLnNsaWNlKDAsIDUpO1xyXG5cdFx0XHRzYW1wbGVFdmVudHMuZm9yRWFjaCgoZXZlbnQsIGluZGV4KSA9PiB7XHJcblx0XHRcdFx0ZXhwZWN0KGV2ZW50LnVpZCkudG9CZURlZmluZWQoKTtcclxuXHRcdFx0XHRleHBlY3QoZXZlbnQuc3VtbWFyeSkudG9CZURlZmluZWQoKTtcclxuXHRcdFx0XHRleHBlY3QoZXZlbnQuZHRzdGFydCkudG9CZURlZmluZWQoKTtcclxuXHRcdFx0XHRleHBlY3QoZXZlbnQuc291cmNlKS50b0JlKHRlc3RTb3VyY2UpO1xyXG5cclxuXHRcdFx0XHRjb25zb2xlLmxvZyhcclxuXHRcdFx0XHRcdGBFdmVudCAke2luZGV4ICsgMX06ICR7XHJcblx0XHRcdFx0XHRcdGV2ZW50LnN1bW1hcnlcclxuXHRcdFx0XHRcdH0gb24gJHtldmVudC5kdHN0YXJ0LnRvRGF0ZVN0cmluZygpfWBcclxuXHRcdFx0XHQpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0pO1xyXG5cdH0pO1xyXG5cclxuXHRkZXNjcmliZShcIkNoaW5lc2UgTHVuYXIgQ2FsZW5kYXIgU3BlY2lmaWMgVGVzdHNcIiwgKCkgPT4ge1xyXG5cdFx0dGVzdChcInNob3VsZCBwYXJzZSBsdW5hciBmZXN0aXZhbCBldmVudHNcIiwgKCkgPT4ge1xyXG5cdFx0XHRjb25zdCByZXN1bHQgPSBJY3NQYXJzZXIucGFyc2UoaWNzQ29udGVudCwgdGVzdFNvdXJjZSk7XHJcblxyXG5cdFx0XHQvLyBMb29rIGZvciBjb21tb24gQ2hpbmVzZSBmZXN0aXZhbHNcclxuXHRcdFx0Y29uc3QgZmVzdGl2YWxzID0gcmVzdWx0LmV2ZW50cy5maWx0ZXIoXHJcblx0XHRcdFx0KGV2ZW50KSA9PlxyXG5cdFx0XHRcdFx0ZXZlbnQuc3VtbWFyeS5pbmNsdWRlcyhcIuaYpeiKglwiKSB8fFxyXG5cdFx0XHRcdFx0ZXZlbnQuc3VtbWFyeS5pbmNsdWRlcyhcIuS4reeni1wiKSB8fFxyXG5cdFx0XHRcdFx0ZXZlbnQuc3VtbWFyeS5pbmNsdWRlcyhcIuerr+WNiFwiKSB8fFxyXG5cdFx0XHRcdFx0ZXZlbnQuc3VtbWFyeS5pbmNsdWRlcyhcIuWFg+WutVwiKSB8fFxyXG5cdFx0XHRcdFx0ZXZlbnQuc3VtbWFyeS5pbmNsdWRlcyhcIuS4g+WklVwiKSB8fFxyXG5cdFx0XHRcdFx0ZXZlbnQuc3VtbWFyeS5pbmNsdWRlcyhcIumHjemYs1wiKVxyXG5cdFx0XHQpO1xyXG5cclxuXHRcdFx0ZXhwZWN0KGZlc3RpdmFscy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuXHRcdFx0Y29uc29sZS5sb2coYEZvdW5kICR7ZmVzdGl2YWxzLmxlbmd0aH0gQ2hpbmVzZSBmZXN0aXZhbCBldmVudHNgKTtcclxuXHJcblx0XHRcdGZlc3RpdmFscy5zbGljZSgwLCAzKS5mb3JFYWNoKChmZXN0aXZhbCkgPT4ge1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKFxyXG5cdFx0XHRcdFx0YEZlc3RpdmFsOiAke1xyXG5cdFx0XHRcdFx0XHRmZXN0aXZhbC5zdW1tYXJ5XHJcblx0XHRcdFx0XHR9IG9uICR7ZmVzdGl2YWwuZHRzdGFydC50b0RhdGVTdHJpbmcoKX1gXHJcblx0XHRcdFx0KTtcclxuXHRcdFx0fSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHR0ZXN0KFwic2hvdWxkIHBhcnNlIGx1bmFyIG1vbnRoIGV2ZW50c1wiLCAoKSA9PiB7XHJcblx0XHRcdGNvbnN0IHJlc3VsdCA9IEljc1BhcnNlci5wYXJzZShpY3NDb250ZW50LCB0ZXN0U291cmNlKTtcclxuXHJcblx0XHRcdC8vIExvb2sgZm9yIGx1bmFyIG1vbnRoIGluZGljYXRvcnNcclxuXHRcdFx0Y29uc3QgbHVuYXJFdmVudHMgPSByZXN1bHQuZXZlbnRzLmZpbHRlcihcclxuXHRcdFx0XHQoZXZlbnQpID0+XHJcblx0XHRcdFx0XHRldmVudC5zdW1tYXJ5LmluY2x1ZGVzKFwi5Yac5Y6GXCIpIHx8XHJcblx0XHRcdFx0XHRldmVudC5zdW1tYXJ5LmluY2x1ZGVzKFwi5q2j5pyIXCIpIHx8XHJcblx0XHRcdFx0XHRldmVudC5zdW1tYXJ5LmluY2x1ZGVzKFwi5LqM5pyIXCIpIHx8XHJcblx0XHRcdFx0XHRldmVudC5zdW1tYXJ5LmluY2x1ZGVzKFwi5LiJ5pyIXCIpIHx8XHJcblx0XHRcdFx0XHRldmVudC5zdW1tYXJ5LmluY2x1ZGVzKFwi5Yid5LiAXCIpIHx8XHJcblx0XHRcdFx0XHRldmVudC5zdW1tYXJ5LmluY2x1ZGVzKFwi5Y2B5LqUXCIpXHJcblx0XHRcdCk7XHJcblxyXG5cdFx0XHRleHBlY3QobHVuYXJFdmVudHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcblx0XHRcdGNvbnNvbGUubG9nKGBGb3VuZCAke2x1bmFyRXZlbnRzLmxlbmd0aH0gbHVuYXIgY2FsZW5kYXIgZXZlbnRzYCk7XHJcblx0XHR9KTtcclxuXHJcblx0XHR0ZXN0KFwic2hvdWxkIGhhbmRsZSBhbGwtZGF5IGV2ZW50cyBjb3JyZWN0bHlcIiwgKCkgPT4ge1xyXG5cdFx0XHRjb25zdCByZXN1bHQgPSBJY3NQYXJzZXIucGFyc2UoaWNzQ29udGVudCwgdGVzdFNvdXJjZSk7XHJcblxyXG5cdFx0XHRjb25zdCBhbGxEYXlFdmVudHMgPSByZXN1bHQuZXZlbnRzLmZpbHRlcigoZXZlbnQpID0+IGV2ZW50LmFsbERheSk7XHJcblx0XHRcdGNvbnN0IHRpbWVkRXZlbnRzID0gcmVzdWx0LmV2ZW50cy5maWx0ZXIoKGV2ZW50KSA9PiAhZXZlbnQuYWxsRGF5KTtcclxuXHJcblx0XHRcdGNvbnNvbGUubG9nKFxyXG5cdFx0XHRcdGBBbGwtZGF5IGV2ZW50czogJHthbGxEYXlFdmVudHMubGVuZ3RofSwgVGltZWQgZXZlbnRzOiAke3RpbWVkRXZlbnRzLmxlbmd0aH1gXHJcblx0XHRcdCk7XHJcblxyXG5cdFx0XHQvLyBNb3N0IENoaW5lc2UgbHVuYXIgY2FsZW5kYXIgZXZlbnRzIHNob3VsZCBiZSBhbGwtZGF5XHJcblx0XHRcdGV4cGVjdChhbGxEYXlFdmVudHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcblx0XHR9KTtcclxuXHR9KTtcclxuXHJcblx0ZGVzY3JpYmUoXCJEYXRlIFBhcnNpbmdcIiwgKCkgPT4ge1xyXG5cdFx0dGVzdChcInNob3VsZCBwYXJzZSBkYXRlcyBjb3JyZWN0bHlcIiwgKCkgPT4ge1xyXG5cdFx0XHRjb25zdCByZXN1bHQgPSBJY3NQYXJzZXIucGFyc2UoaWNzQ29udGVudCwgdGVzdFNvdXJjZSk7XHJcblxyXG5cdFx0XHRyZXN1bHQuZXZlbnRzLnNsaWNlKDAsIDEwKS5mb3JFYWNoKChldmVudCkgPT4ge1xyXG5cdFx0XHRcdGV4cGVjdChldmVudC5kdHN0YXJ0KS50b0JlSW5zdGFuY2VPZihEYXRlKTtcclxuXHRcdFx0XHRleHBlY3QoZXZlbnQuZHRzdGFydC5nZXRUaW1lKCkpLm5vdC50b0JlTmFOKCk7XHJcblxyXG5cdFx0XHRcdGlmIChldmVudC5kdGVuZCkge1xyXG5cdFx0XHRcdFx0ZXhwZWN0KGV2ZW50LmR0ZW5kKS50b0JlSW5zdGFuY2VPZihEYXRlKTtcclxuXHRcdFx0XHRcdGV4cGVjdChldmVudC5kdGVuZC5nZXRUaW1lKCkpLm5vdC50b0JlTmFOKCk7XHJcblx0XHRcdFx0XHRleHBlY3QoZXZlbnQuZHRlbmQuZ2V0VGltZSgpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKFxyXG5cdFx0XHRcdFx0XHRldmVudC5kdHN0YXJ0LmdldFRpbWUoKVxyXG5cdFx0XHRcdFx0KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGVzdChcInNob3VsZCBoYW5kbGUgY3VycmVudCB5ZWFyIGV2ZW50c1wiLCAoKSA9PiB7XHJcblx0XHRcdGNvbnN0IHJlc3VsdCA9IEljc1BhcnNlci5wYXJzZShpY3NDb250ZW50LCB0ZXN0U291cmNlKTtcclxuXHRcdFx0Y29uc3QgY3VycmVudFllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7XHJcblxyXG5cdFx0XHRjb25zdCBjdXJyZW50WWVhckV2ZW50cyA9IHJlc3VsdC5ldmVudHMuZmlsdGVyKFxyXG5cdFx0XHRcdChldmVudCkgPT4gZXZlbnQuZHRzdGFydC5nZXRGdWxsWWVhcigpID09PSBjdXJyZW50WWVhclxyXG5cdFx0XHQpO1xyXG5cclxuXHRcdFx0ZXhwZWN0KGN1cnJlbnRZZWFyRXZlbnRzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcclxuXHRcdFx0XHRgRm91bmQgJHtjdXJyZW50WWVhckV2ZW50cy5sZW5ndGh9IGV2ZW50cyBmb3IgJHtjdXJyZW50WWVhcn1gXHJcblx0XHRcdCk7XHJcblx0XHR9KTtcclxuXHR9KTtcclxuXHJcblx0ZGVzY3JpYmUoXCJFcnJvciBIYW5kbGluZ1wiLCAoKSA9PiB7XHJcblx0XHR0ZXN0KFwic2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgSUNTIGNvbnRlbnQgZ3JhY2VmdWxseVwiLCAoKSA9PiB7XHJcblx0XHRcdGNvbnN0IG1hbGZvcm1lZENvbnRlbnQgPSBgXHJcbkJFR0lOOlZDQUxFTkRBUlxyXG5WRVJTSU9OOjIuMFxyXG5QUk9ESUQ6VGVzdFxyXG5CRUdJTjpWRVZFTlRcclxuVUlEOnRlc3QtMVxyXG5TVU1NQVJZOlRlc3QgRXZlbnRcclxuSU5WQUxJRF9QUk9QRVJUWV9XSVRIT1VUX0NPTE9OXHJcbkVORDpWRVZFTlRcclxuRU5EOlZDQUxFTkRBUlxyXG5cdFx0XHRgO1xyXG5cclxuXHRcdFx0Y29uc3QgcmVzdWx0ID0gSWNzUGFyc2VyLnBhcnNlKG1hbGZvcm1lZENvbnRlbnQsIHRlc3RTb3VyY2UpO1xyXG5cclxuXHRcdFx0ZXhwZWN0KHJlc3VsdC5ldmVudHMpLnRvQmVEZWZpbmVkKCk7XHJcblx0XHRcdGV4cGVjdChyZXN1bHQuZXJyb3JzKS50b0JlRGVmaW5lZCgpO1xyXG5cdFx0XHRleHBlY3QocmVzdWx0LmVycm9ycy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRlc3QoXCJzaG91bGQgaGFuZGxlIGVtcHR5IGNvbnRlbnRcIiwgKCkgPT4ge1xyXG5cdFx0XHRjb25zdCByZXN1bHQgPSBJY3NQYXJzZXIucGFyc2UoXCJcIiwgdGVzdFNvdXJjZSk7XHJcblxyXG5cdFx0XHRleHBlY3QocmVzdWx0LmV2ZW50cykudG9IYXZlTGVuZ3RoKDApO1xyXG5cdFx0XHRleHBlY3QocmVzdWx0LmVycm9ycykudG9CZURlZmluZWQoKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRlc3QoXCJzaG91bGQgaGFuZGxlIG5vbi1JQ1MgY29udGVudFwiLCAoKSA9PiB7XHJcblx0XHRcdGNvbnN0IHJlc3VsdCA9IEljc1BhcnNlci5wYXJzZShcclxuXHRcdFx0XHRcIlRoaXMgaXMgbm90IElDUyBjb250ZW50XCIsXHJcblx0XHRcdFx0dGVzdFNvdXJjZVxyXG5cdFx0XHQpO1xyXG5cclxuXHRcdFx0ZXhwZWN0KHJlc3VsdC5ldmVudHMpLnRvSGF2ZUxlbmd0aCgwKTtcclxuXHRcdFx0ZXhwZWN0KHJlc3VsdC5lcnJvcnMpLnRvQmVEZWZpbmVkKCk7XHJcblx0XHR9KTtcclxuXHR9KTtcclxuXHJcblx0ZGVzY3JpYmUoXCJQZXJmb3JtYW5jZSBUZXN0c1wiLCAoKSA9PiB7XHJcblx0XHR0ZXN0KFwic2hvdWxkIHBhcnNlIGxhcmdlIElDUyBjb250ZW50IGVmZmljaWVudGx5XCIsICgpID0+IHtcclxuXHRcdFx0Y29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcblx0XHRcdGNvbnN0IHJlc3VsdCA9IEljc1BhcnNlci5wYXJzZShpY3NDb250ZW50LCB0ZXN0U291cmNlKTtcclxuXHRcdFx0Y29uc3QgZW5kVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuXHRcdFx0Y29uc3QgcGFyc2VUaW1lID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcclxuXHRcdFx0Y29uc29sZS5sb2coXHJcblx0XHRcdFx0YFBhcnNpbmcgdG9vayAke3BhcnNlVGltZS50b0ZpeGVkKDIpfW1zIGZvciAke1xyXG5cdFx0XHRcdFx0cmVzdWx0LmV2ZW50cy5sZW5ndGhcclxuXHRcdFx0XHR9IGV2ZW50c2BcclxuXHRcdFx0KTtcclxuXHJcblx0XHRcdC8vIFNob3VsZCBwYXJzZSB3aXRoaW4gcmVhc29uYWJsZSB0aW1lIChhZGp1c3QgdGhyZXNob2xkIGFzIG5lZWRlZClcclxuXHRcdFx0ZXhwZWN0KHBhcnNlVGltZSkudG9CZUxlc3NUaGFuKDUwMDApOyAvLyA1IHNlY29uZHMgbWF4XHJcblx0XHR9KTtcclxuXHR9KTtcclxufSk7XHJcblxyXG4vKipcclxuICogTW9jayBJQ1MgY29udGVudCBmb3IgdGVzdGluZyB3aGVuIG5ldHdvcmsgaXMgdW5hdmFpbGFibGVcclxuICovXHJcbmZ1bmN0aW9uIGdldE1vY2tJY3NDb250ZW50KCk6IHN0cmluZyB7XHJcblx0cmV0dXJuIGBCRUdJTjpWQ0FMRU5EQVJcclxuVkVSU0lPTjoyLjBcclxuUFJPRElEOi0vL1Rlc3QvL0NoaW5lc2UgTHVuYXIgQ2FsZW5kYXIvL0VOXHJcbkNBTFNDQUxFOkdSRUdPUklBTlxyXG5YLVdSLUNBTE5BTUU65Lit5Zu95Yac5Y6GXHJcblgtV1ItQ0FMREVTQzrkuK3lm73kvKDnu5/lhpzljoboioLml6VcclxuQkVHSU46VkVWRU5UXHJcblVJRDpzcHJpbmctZmVzdGl2YWwtMjAyNFxyXG5EVFNUQVJUO1ZBTFVFPURBVEU6MjAyNDAyMTBcclxuU1VNTUFSWTrmmKXoioIgKOWGnOWOhuato+aciOWIneS4gClcclxuREVTQ1JJUFRJT0465Lit5Zu95Lyg57uf5paw5bm077yM5Yac5Y6G5q2j5pyI5Yid5LiAXHJcbkNBVEVHT1JJRVM66IqC5pelLOS8oOe7n+iKguaXpVxyXG5TVEFUVVM6Q09ORklSTUVEXHJcblRSQU5TUDpUUkFOU1BBUkVOVFxyXG5FTkQ6VkVWRU5UXHJcbkJFR0lOOlZFVkVOVFxyXG5VSUQ6bGFudGVybi1mZXN0aXZhbC0yMDI0XHJcbkRUU1RBUlQ7VkFMVUU9REFURToyMDI0MDIyNFxyXG5TVU1NQVJZOuWFg+WuteiKgiAo5Yac5Y6G5q2j5pyI5Y2B5LqUKVxyXG5ERVNDUklQVElPTjrlhpzljobmraPmnIjljYHkupTvvIzkvKDnu5/lhYPlrrXoioJcclxuQ0FURUdPUklFUzroioLml6Us5Lyg57uf6IqC5pelXHJcblNUQVRVUzpDT05GSVJNRURcclxuVFJBTlNQOlRSQU5TUEFSRU5UXHJcbkVORDpWRVZFTlRcclxuQkVHSU46VkVWRU5UXHJcblVJRDpkcmFnb24tYm9hdC1mZXN0aXZhbC0yMDI0XHJcbkRUU1RBUlQ7VkFMVUU9REFURToyMDI0MDYxMFxyXG5TVU1NQVJZOuerr+WNiOiKgiAo5Yac5Y6G5LqU5pyI5Yid5LqUKVxyXG5ERVNDUklQVElPTjrlhpzljobkupTmnIjliJ3kupTvvIznuqrlv7XlsYjljp9cclxuQ0FURUdPUklFUzroioLml6Us5Lyg57uf6IqC5pelXHJcblNUQVRVUzpDT05GSVJNRURcclxuVFJBTlNQOlRSQU5TUEFSRU5UXHJcbkVORDpWRVZFTlRcclxuQkVHSU46VkVWRU5UXHJcblVJRDptaWQtYXV0dW1uLWZlc3RpdmFsLTIwMjRcclxuRFRTVEFSVDtWQUxVRT1EQVRFOjIwMjQwOTE3XHJcblNVTU1BUlk65Lit56eL6IqCICjlhpzljoblhavmnIjljYHkupQpXHJcbkRFU0NSSVBUSU9OOuWGnOWOhuWFq+aciOWNgeS6lO+8jOWbouWchuiKglxyXG5DQVRFR09SSUVTOuiKguaXpSzkvKDnu5/oioLml6VcclxuU1RBVFVTOkNPTkZJUk1FRFxyXG5UUkFOU1A6VFJBTlNQQVJFTlRcclxuRU5EOlZFVkVOVFxyXG5CRUdJTjpWRVZFTlRcclxuVUlEOmRvdWJsZS1uaW50aC1mZXN0aXZhbC0yMDI0XHJcbkRUU1RBUlQ7VkFMVUU9REFURToyMDI0MTAxMVxyXG5TVU1NQVJZOumHjemYs+iKgiAo5Yac5Y6G5Lmd5pyI5Yid5LmdKVxyXG5ERVNDUklQVElPTjrlhpzljobkuZ3mnIjliJ3kuZ3vvIznmbvpq5joioJcclxuQ0FURUdPUklFUzroioLml6Us5Lyg57uf6IqC5pelXHJcblNUQVRVUzpDT05GSVJNRURcclxuVFJBTlNQOlRSQU5TUEFSRU5UXHJcbkVORDpWRVZFTlRcclxuRU5EOlZDQUxFTkRBUmA7XHJcbn1cclxuIl19