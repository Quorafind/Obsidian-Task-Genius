/**
 * Tests for Canvas file parsing functionality
 */
import { CanvasParser } from '../dataflow/core/CanvasParser';
import { getConfig } from '../common/task-parser-config';
describe('CanvasParser', () => {
    let parser;
    beforeEach(() => {
        const config = getConfig('tasks');
        parser = new CanvasParser(config);
    });
    describe('parseCanvasFile', () => {
        it('should parse a simple canvas with text nodes containing tasks', () => {
            const canvasData = {
                nodes: [
                    {
                        id: 'node1',
                        type: 'text',
                        text: '- [ ] Task 1\n- [x] Task 2 completed',
                        x: 100,
                        y: 100,
                        width: 200,
                        height: 100
                    },
                    {
                        id: 'node2',
                        type: 'text',
                        text: '- [ ] Another task\n- [ ] Yet another task',
                        x: 300,
                        y: 200,
                        width: 200,
                        height: 100
                    }
                ],
                edges: []
            };
            const canvasContent = JSON.stringify(canvasData);
            const tasks = parser.parseCanvasFile(canvasContent, 'test.canvas');
            expect(tasks).toHaveLength(4);
            expect(tasks[0].content).toBe('Task 1');
            expect(tasks[0].completed).toBe(false);
            expect(tasks[1].content).toBe('Task 2 completed');
            expect(tasks[1].completed).toBe(true);
            expect(tasks[2].content).toBe('Another task');
            expect(tasks[3].content).toBe('Yet another task');
        });
        it('should handle canvas with no text nodes', () => {
            const canvasData = {
                nodes: [
                    {
                        id: 'file1',
                        type: 'file',
                        file: 'some-file.md',
                        x: 100,
                        y: 100,
                        width: 200,
                        height: 100
                    }
                ],
                edges: []
            };
            const canvasContent = JSON.stringify(canvasData);
            const tasks = parser.parseCanvasFile(canvasContent, 'test.canvas');
            expect(tasks).toHaveLength(0);
        });
        it('should handle canvas with text nodes but no tasks', () => {
            const canvasData = {
                nodes: [
                    {
                        id: 'node1',
                        type: 'text',
                        text: 'This is just regular text\nNo tasks here',
                        x: 100,
                        y: 100,
                        width: 200,
                        height: 100
                    }
                ],
                edges: []
            };
            const canvasContent = JSON.stringify(canvasData);
            const tasks = parser.parseCanvasFile(canvasContent, 'test.canvas');
            expect(tasks).toHaveLength(0);
        });
        it('should add canvas-specific metadata to tasks', () => {
            const canvasData = {
                nodes: [
                    {
                        id: 'node1',
                        type: 'text',
                        text: '- [ ] Task with metadata',
                        x: 100,
                        y: 200,
                        width: 300,
                        height: 150,
                        color: '#ff0000'
                    }
                ],
                edges: []
            };
            const canvasContent = JSON.stringify(canvasData);
            const tasks = parser.parseCanvasFile(canvasContent, 'test.canvas');
            expect(tasks).toHaveLength(1);
            const task = tasks[0];
            expect(task.metadata.canvasNodeId).toBe('node1');
            expect(task.metadata.canvasPosition).toEqual({
                x: 100,
                y: 200,
                width: 300,
                height: 150
            });
            expect(task.metadata.canvasColor).toBe('#ff0000');
            expect(task.metadata.sourceType).toBe('canvas');
        });
        it('should handle invalid JSON gracefully', () => {
            const invalidJson = '{ invalid json }';
            const tasks = parser.parseCanvasFile(invalidJson, 'test.canvas');
            expect(tasks).toHaveLength(0);
        });
        it('should handle mixed node types', () => {
            const canvasData = {
                nodes: [
                    {
                        id: 'text1',
                        type: 'text',
                        text: '- [ ] Text node task',
                        x: 100,
                        y: 100,
                        width: 200,
                        height: 100
                    },
                    {
                        id: 'file1',
                        type: 'file',
                        file: 'some-file.md',
                        x: 300,
                        y: 100,
                        width: 200,
                        height: 100
                    },
                    {
                        id: 'link1',
                        type: 'link',
                        url: 'https://example.com',
                        x: 500,
                        y: 100,
                        width: 200,
                        height: 100
                    },
                    {
                        id: 'text2',
                        type: 'text',
                        text: '- [x] Another text task',
                        x: 100,
                        y: 300,
                        width: 200,
                        height: 100
                    }
                ],
                edges: []
            };
            const canvasContent = JSON.stringify(canvasData);
            const tasks = parser.parseCanvasFile(canvasContent, 'test.canvas');
            expect(tasks).toHaveLength(2);
            expect(tasks[0].content).toBe('Text node task');
            expect(tasks[0].completed).toBe(false);
            expect(tasks[1].content).toBe('Another text task');
            expect(tasks[1].completed).toBe(true);
        });
    });
    describe('isValidCanvasContent', () => {
        it('should validate correct canvas JSON', () => {
            const validCanvas = JSON.stringify({
                nodes: [],
                edges: []
            });
            expect(CanvasParser.isValidCanvasContent(validCanvas)).toBe(true);
        });
        it('should reject invalid JSON', () => {
            const invalidJson = '{ invalid }';
            expect(CanvasParser.isValidCanvasContent(invalidJson)).toBe(false);
        });
        it('should reject JSON without required properties', () => {
            const missingNodes = JSON.stringify({ edges: [] });
            const missingEdges = JSON.stringify({ nodes: [] });
            expect(CanvasParser.isValidCanvasContent(missingNodes)).toBe(false);
            expect(CanvasParser.isValidCanvasContent(missingEdges)).toBe(false);
        });
    });
    describe('extractTextOnly', () => {
        it('should extract text content from all text nodes', () => {
            const canvasData = {
                nodes: [
                    {
                        id: 'node1',
                        type: 'text',
                        text: 'First text node',
                        x: 100,
                        y: 100,
                        width: 200,
                        height: 100
                    },
                    {
                        id: 'file1',
                        type: 'file',
                        file: 'some-file.md',
                        x: 300,
                        y: 100,
                        width: 200,
                        height: 100
                    },
                    {
                        id: 'node2',
                        type: 'text',
                        text: 'Second text node',
                        x: 100,
                        y: 300,
                        width: 200,
                        height: 100
                    }
                ],
                edges: []
            };
            const canvasContent = JSON.stringify(canvasData);
            const textContent = parser.extractTextOnly(canvasContent);
            expect(textContent).toBe('First text node\n\nSecond text node');
        });
        it('should handle canvas with no text nodes', () => {
            const canvasData = {
                nodes: [
                    {
                        id: 'file1',
                        type: 'file',
                        file: 'some-file.md',
                        x: 100,
                        y: 100,
                        width: 200,
                        height: 100
                    }
                ],
                edges: []
            };
            const canvasContent = JSON.stringify(canvasData);
            const textContent = parser.extractTextOnly(canvasContent);
            expect(textContent).toBe('');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FudmFzUGFyc2VyLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJDYW52YXNQYXJzZXIudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7R0FFRztBQUVILE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUU3RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFFekQsUUFBUSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUU7SUFDMUIsSUFBSSxNQUFvQixDQUFDO0lBRXpCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDbEMsTUFBTSxHQUFHLElBQUksWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUM3QixFQUFFLENBQUMsK0RBQStELEVBQUUsR0FBRyxFQUFFO1lBQ3JFLE1BQU0sVUFBVSxHQUFlO2dCQUMzQixLQUFLLEVBQUU7b0JBQ0g7d0JBQ0ksRUFBRSxFQUFFLE9BQU87d0JBQ1gsSUFBSSxFQUFFLE1BQU07d0JBQ1osSUFBSSxFQUFFLHNDQUFzQzt3QkFDNUMsQ0FBQyxFQUFFLEdBQUc7d0JBQ04sQ0FBQyxFQUFFLEdBQUc7d0JBQ04sS0FBSyxFQUFFLEdBQUc7d0JBQ1YsTUFBTSxFQUFFLEdBQUc7cUJBQ0k7b0JBQ25CO3dCQUNJLEVBQUUsRUFBRSxPQUFPO3dCQUNYLElBQUksRUFBRSxNQUFNO3dCQUNaLElBQUksRUFBRSw0Q0FBNEM7d0JBQ2xELENBQUMsRUFBRSxHQUFHO3dCQUNOLENBQUMsRUFBRSxHQUFHO3dCQUNOLEtBQUssRUFBRSxHQUFHO3dCQUNWLE1BQU0sRUFBRSxHQUFHO3FCQUNJO2lCQUN0QjtnQkFDRCxLQUFLLEVBQUUsRUFBRTthQUNaLENBQUM7WUFFRixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUMsYUFBYSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUNsRCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUM5QyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3RELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtZQUMvQyxNQUFNLFVBQVUsR0FBZTtnQkFDM0IsS0FBSyxFQUFFO29CQUNIO3dCQUNJLEVBQUUsRUFBRSxPQUFPO3dCQUNYLElBQUksRUFBRSxNQUFNO3dCQUNaLElBQUksRUFBRSxjQUFjO3dCQUNwQixDQUFDLEVBQUUsR0FBRzt3QkFDTixDQUFDLEVBQUUsR0FBRzt3QkFDTixLQUFLLEVBQUUsR0FBRzt3QkFDVixNQUFNLEVBQUUsR0FBRztxQkFDZDtpQkFDSjtnQkFDRCxLQUFLLEVBQUUsRUFBRTthQUNaLENBQUM7WUFFRixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUMsYUFBYSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1lBRW5FLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsbURBQW1ELEVBQUUsR0FBRyxFQUFFO1lBQ3pELE1BQU0sVUFBVSxHQUFlO2dCQUMzQixLQUFLLEVBQUU7b0JBQ0g7d0JBQ0ksRUFBRSxFQUFFLE9BQU87d0JBQ1gsSUFBSSxFQUFFLE1BQU07d0JBQ1osSUFBSSxFQUFFLDBDQUEwQzt3QkFDaEQsQ0FBQyxFQUFFLEdBQUc7d0JBQ04sQ0FBQyxFQUFFLEdBQUc7d0JBQ04sS0FBSyxFQUFFLEdBQUc7d0JBQ1YsTUFBTSxFQUFFLEdBQUc7cUJBQ0k7aUJBQ3RCO2dCQUNELEtBQUssRUFBRSxFQUFFO2FBQ1osQ0FBQztZQUVGLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDakQsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxhQUFhLEVBQUUsYUFBYSxDQUFDLENBQUM7WUFFbkUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxHQUFHLEVBQUU7WUFDcEQsTUFBTSxVQUFVLEdBQWU7Z0JBQzNCLEtBQUssRUFBRTtvQkFDSDt3QkFDSSxFQUFFLEVBQUUsT0FBTzt3QkFDWCxJQUFJLEVBQUUsTUFBTTt3QkFDWixJQUFJLEVBQUUsMEJBQTBCO3dCQUNoQyxDQUFDLEVBQUUsR0FBRzt3QkFDTixDQUFDLEVBQUUsR0FBRzt3QkFDTixLQUFLLEVBQUUsR0FBRzt3QkFDVixNQUFNLEVBQUUsR0FBRzt3QkFDWCxLQUFLLEVBQUUsU0FBUztxQkFDRDtpQkFDdEI7Z0JBQ0QsS0FBSyxFQUFFLEVBQUU7YUFDWixDQUFDO1lBRUYsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNqRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsZUFBZSxDQUFDLGFBQWEsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUVuRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QixNQUFNLENBQUUsSUFBSSxDQUFDLFFBQWdCLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzFELE1BQU0sQ0FBRSxJQUFJLENBQUMsUUFBZ0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxPQUFPLENBQUM7Z0JBQ2xELENBQUMsRUFBRSxHQUFHO2dCQUNOLENBQUMsRUFBRSxHQUFHO2dCQUNOLEtBQUssRUFBRSxHQUFHO2dCQUNWLE1BQU0sRUFBRSxHQUFHO2FBQ2QsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxDQUFFLElBQUksQ0FBQyxRQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMzRCxNQUFNLENBQUUsSUFBSSxDQUFDLFFBQWdCLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzdELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxNQUFNLFdBQVcsR0FBRyxrQkFBa0IsQ0FBQztZQUN2QyxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsZUFBZSxDQUFDLFdBQVcsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUVqRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdDQUFnQyxFQUFFLEdBQUcsRUFBRTtZQUN0QyxNQUFNLFVBQVUsR0FBZTtnQkFDM0IsS0FBSyxFQUFFO29CQUNIO3dCQUNJLEVBQUUsRUFBRSxPQUFPO3dCQUNYLElBQUksRUFBRSxNQUFNO3dCQUNaLElBQUksRUFBRSxzQkFBc0I7d0JBQzVCLENBQUMsRUFBRSxHQUFHO3dCQUNOLENBQUMsRUFBRSxHQUFHO3dCQUNOLEtBQUssRUFBRSxHQUFHO3dCQUNWLE1BQU0sRUFBRSxHQUFHO3FCQUNJO29CQUNuQjt3QkFDSSxFQUFFLEVBQUUsT0FBTzt3QkFDWCxJQUFJLEVBQUUsTUFBTTt3QkFDWixJQUFJLEVBQUUsY0FBYzt3QkFDcEIsQ0FBQyxFQUFFLEdBQUc7d0JBQ04sQ0FBQyxFQUFFLEdBQUc7d0JBQ04sS0FBSyxFQUFFLEdBQUc7d0JBQ1YsTUFBTSxFQUFFLEdBQUc7cUJBQ2Q7b0JBQ0Q7d0JBQ0ksRUFBRSxFQUFFLE9BQU87d0JBQ1gsSUFBSSxFQUFFLE1BQU07d0JBQ1osR0FBRyxFQUFFLHFCQUFxQjt3QkFDMUIsQ0FBQyxFQUFFLEdBQUc7d0JBQ04sQ0FBQyxFQUFFLEdBQUc7d0JBQ04sS0FBSyxFQUFFLEdBQUc7d0JBQ1YsTUFBTSxFQUFFLEdBQUc7cUJBQ2Q7b0JBQ0Q7d0JBQ0ksRUFBRSxFQUFFLE9BQU87d0JBQ1gsSUFBSSxFQUFFLE1BQU07d0JBQ1osSUFBSSxFQUFFLHlCQUF5Qjt3QkFDL0IsQ0FBQyxFQUFFLEdBQUc7d0JBQ04sQ0FBQyxFQUFFLEdBQUc7d0JBQ04sS0FBSyxFQUFFLEdBQUc7d0JBQ1YsTUFBTSxFQUFFLEdBQUc7cUJBQ0k7aUJBQ3RCO2dCQUNELEtBQUssRUFBRSxFQUFFO2FBQ1osQ0FBQztZQUVGLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDakQsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLGVBQWUsQ0FBQyxhQUFhLEVBQUUsYUFBYSxDQUFDLENBQUM7WUFFbkUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3ZDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDbkQsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7UUFDbEMsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtZQUMzQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO2dCQUMvQixLQUFLLEVBQUUsRUFBRTtnQkFDVCxLQUFLLEVBQUUsRUFBRTthQUNaLENBQUMsQ0FBQztZQUVILE1BQU0sQ0FBQyxZQUFZLENBQUMsb0JBQW9CLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1lBQ2xDLE1BQU0sV0FBVyxHQUFHLGFBQWEsQ0FBQztZQUNsQyxNQUFNLENBQUMsWUFBWSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3ZFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLEdBQUcsRUFBRTtZQUN0RCxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDbkQsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRW5ELE1BQU0sQ0FBQyxZQUFZLENBQUMsb0JBQW9CLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDcEUsTUFBTSxDQUFDLFlBQVksQ0FBQyxvQkFBb0IsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4RSxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEdBQUcsRUFBRTtRQUM3QixFQUFFLENBQUMsaURBQWlELEVBQUUsR0FBRyxFQUFFO1lBQ3ZELE1BQU0sVUFBVSxHQUFlO2dCQUMzQixLQUFLLEVBQUU7b0JBQ0g7d0JBQ0ksRUFBRSxFQUFFLE9BQU87d0JBQ1gsSUFBSSxFQUFFLE1BQU07d0JBQ1osSUFBSSxFQUFFLGlCQUFpQjt3QkFDdkIsQ0FBQyxFQUFFLEdBQUc7d0JBQ04sQ0FBQyxFQUFFLEdBQUc7d0JBQ04sS0FBSyxFQUFFLEdBQUc7d0JBQ1YsTUFBTSxFQUFFLEdBQUc7cUJBQ0k7b0JBQ25CO3dCQUNJLEVBQUUsRUFBRSxPQUFPO3dCQUNYLElBQUksRUFBRSxNQUFNO3dCQUNaLElBQUksRUFBRSxjQUFjO3dCQUNwQixDQUFDLEVBQUUsR0FBRzt3QkFDTixDQUFDLEVBQUUsR0FBRzt3QkFDTixLQUFLLEVBQUUsR0FBRzt3QkFDVixNQUFNLEVBQUUsR0FBRztxQkFDZDtvQkFDRDt3QkFDSSxFQUFFLEVBQUUsT0FBTzt3QkFDWCxJQUFJLEVBQUUsTUFBTTt3QkFDWixJQUFJLEVBQUUsa0JBQWtCO3dCQUN4QixDQUFDLEVBQUUsR0FBRzt3QkFDTixDQUFDLEVBQUUsR0FBRzt3QkFDTixLQUFLLEVBQUUsR0FBRzt3QkFDVixNQUFNLEVBQUUsR0FBRztxQkFDSTtpQkFDdEI7Z0JBQ0QsS0FBSyxFQUFFLEVBQUU7YUFDWixDQUFDO1lBRUYsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNqRCxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTFELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMscUNBQXFDLENBQUMsQ0FBQztRQUNwRSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7WUFDL0MsTUFBTSxVQUFVLEdBQWU7Z0JBQzNCLEtBQUssRUFBRTtvQkFDSDt3QkFDSSxFQUFFLEVBQUUsT0FBTzt3QkFDWCxJQUFJLEVBQUUsTUFBTTt3QkFDWixJQUFJLEVBQUUsY0FBYzt3QkFDcEIsQ0FBQyxFQUFFLEdBQUc7d0JBQ04sQ0FBQyxFQUFFLEdBQUc7d0JBQ04sS0FBSyxFQUFFLEdBQUc7d0JBQ1YsTUFBTSxFQUFFLEdBQUc7cUJBQ2Q7aUJBQ0o7Z0JBQ0QsS0FBSyxFQUFFLEVBQUU7YUFDWixDQUFDO1lBRUYsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNqRCxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTFELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDakMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFRlc3RzIGZvciBDYW52YXMgZmlsZSBwYXJzaW5nIGZ1bmN0aW9uYWxpdHlcclxuICovXHJcblxyXG5pbXBvcnQgeyBDYW52YXNQYXJzZXIgfSBmcm9tICcuLi9kYXRhZmxvdy9jb3JlL0NhbnZhc1BhcnNlcic7XHJcbmltcG9ydCB7IENhbnZhc0RhdGEsIENhbnZhc1RleHREYXRhIH0gZnJvbSAnLi4vdHlwZXMvY2FudmFzJztcclxuaW1wb3J0IHsgZ2V0Q29uZmlnIH0gZnJvbSAnLi4vY29tbW9uL3Rhc2stcGFyc2VyLWNvbmZpZyc7XHJcblxyXG5kZXNjcmliZSgnQ2FudmFzUGFyc2VyJywgKCkgPT4ge1xyXG4gICAgbGV0IHBhcnNlcjogQ2FudmFzUGFyc2VyO1xyXG5cclxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygndGFza3MnKTtcclxuICAgICAgICBwYXJzZXIgPSBuZXcgQ2FudmFzUGFyc2VyKGNvbmZpZyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgncGFyc2VDYW52YXNGaWxlJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgcGFyc2UgYSBzaW1wbGUgY2FudmFzIHdpdGggdGV4dCBub2RlcyBjb250YWluaW5nIHRhc2tzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjYW52YXNEYXRhOiBDYW52YXNEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgbm9kZXM6IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnbm9kZTEnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICctIFsgXSBUYXNrIDFcXG4tIFt4XSBUYXNrIDIgY29tcGxldGVkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeDogMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTAwXHJcbiAgICAgICAgICAgICAgICAgICAgfSBhcyBDYW52YXNUZXh0RGF0YSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnbm9kZTInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICctIFsgXSBBbm90aGVyIHRhc2tcXG4tIFsgXSBZZXQgYW5vdGhlciB0YXNrJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeDogMzAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTAwXHJcbiAgICAgICAgICAgICAgICAgICAgfSBhcyBDYW52YXNUZXh0RGF0YVxyXG4gICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgIGVkZ2VzOiBbXVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgY29uc3QgY2FudmFzQ29udGVudCA9IEpTT04uc3RyaW5naWZ5KGNhbnZhc0RhdGEpO1xyXG4gICAgICAgICAgICBjb25zdCB0YXNrcyA9IHBhcnNlci5wYXJzZUNhbnZhc0ZpbGUoY2FudmFzQ29udGVudCwgJ3Rlc3QuY2FudmFzJyk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QodGFza3MpLnRvSGF2ZUxlbmd0aCg0KTtcclxuICAgICAgICAgICAgZXhwZWN0KHRhc2tzWzBdLmNvbnRlbnQpLnRvQmUoJ1Rhc2sgMScpO1xyXG4gICAgICAgICAgICBleHBlY3QodGFza3NbMF0uY29tcGxldGVkKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHRhc2tzWzFdLmNvbnRlbnQpLnRvQmUoJ1Rhc2sgMiBjb21wbGV0ZWQnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHRhc2tzWzFdLmNvbXBsZXRlZCkudG9CZSh0cnVlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHRhc2tzWzJdLmNvbnRlbnQpLnRvQmUoJ0Fub3RoZXIgdGFzaycpO1xyXG4gICAgICAgICAgICBleHBlY3QodGFza3NbM10uY29udGVudCkudG9CZSgnWWV0IGFub3RoZXIgdGFzaycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBjYW52YXMgd2l0aCBubyB0ZXh0IG5vZGVzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjYW52YXNEYXRhOiBDYW52YXNEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgbm9kZXM6IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnZmlsZTEnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZmlsZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGU6ICdzb21lLWZpbGUubWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgZWRnZXM6IFtdXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjYW52YXNDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoY2FudmFzRGF0YSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhc2tzID0gcGFyc2VyLnBhcnNlQ2FudmFzRmlsZShjYW52YXNDb250ZW50LCAndGVzdC5jYW52YXMnKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdCh0YXNrcykudG9IYXZlTGVuZ3RoKDApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBjYW52YXMgd2l0aCB0ZXh0IG5vZGVzIGJ1dCBubyB0YXNrcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY2FudmFzRGF0YTogQ2FudmFzRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIG5vZGVzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogJ25vZGUxJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnVGhpcyBpcyBqdXN0IHJlZ3VsYXIgdGV4dFxcbk5vIHRhc2tzIGhlcmUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDBcclxuICAgICAgICAgICAgICAgICAgICB9IGFzIENhbnZhc1RleHREYXRhXHJcbiAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgZWRnZXM6IFtdXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjYW52YXNDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoY2FudmFzRGF0YSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhc2tzID0gcGFyc2VyLnBhcnNlQ2FudmFzRmlsZShjYW52YXNDb250ZW50LCAndGVzdC5jYW52YXMnKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdCh0YXNrcykudG9IYXZlTGVuZ3RoKDApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGFkZCBjYW52YXMtc3BlY2lmaWMgbWV0YWRhdGEgdG8gdGFza3MnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbnZhc0RhdGE6IENhbnZhc0RhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBub2RlczogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdub2RlMScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJy0gWyBdIFRhc2sgd2l0aCBtZXRhZGF0YScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeTogMjAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMzAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDE1MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjZmYwMDAwJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0gYXMgQ2FudmFzVGV4dERhdGFcclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBlZGdlczogW11cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNhbnZhc0NvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShjYW52YXNEYXRhKTtcclxuICAgICAgICAgICAgY29uc3QgdGFza3MgPSBwYXJzZXIucGFyc2VDYW52YXNGaWxlKGNhbnZhc0NvbnRlbnQsICd0ZXN0LmNhbnZhcycpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHRhc2tzKS50b0hhdmVMZW5ndGgoMSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhc2sgPSB0YXNrc1swXTtcclxuICAgICAgICAgICAgZXhwZWN0KCh0YXNrLm1ldGFkYXRhIGFzIGFueSkuY2FudmFzTm9kZUlkKS50b0JlKCdub2RlMScpO1xyXG4gICAgICAgICAgICBleHBlY3QoKHRhc2subWV0YWRhdGEgYXMgYW55KS5jYW52YXNQb3NpdGlvbikudG9FcXVhbCh7XHJcbiAgICAgICAgICAgICAgICB4OiAxMDAsXHJcbiAgICAgICAgICAgICAgICB5OiAyMDAsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogMzAwLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAxNTBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGV4cGVjdCgodGFzay5tZXRhZGF0YSBhcyBhbnkpLmNhbnZhc0NvbG9yKS50b0JlKCcjZmYwMDAwJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdCgodGFzay5tZXRhZGF0YSBhcyBhbnkpLnNvdXJjZVR5cGUpLnRvQmUoJ2NhbnZhcycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIEpTT04gZ3JhY2VmdWxseScsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgaW52YWxpZEpzb24gPSAneyBpbnZhbGlkIGpzb24gfSc7XHJcbiAgICAgICAgICAgIGNvbnN0IHRhc2tzID0gcGFyc2VyLnBhcnNlQ2FudmFzRmlsZShpbnZhbGlkSnNvbiwgJ3Rlc3QuY2FudmFzJyk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QodGFza3MpLnRvSGF2ZUxlbmd0aCgwKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWl4ZWQgbm9kZSB0eXBlcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgY2FudmFzRGF0YTogQ2FudmFzRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIG5vZGVzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogJ3RleHQxJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnLSBbIF0gVGV4dCBub2RlIHRhc2snLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDBcclxuICAgICAgICAgICAgICAgICAgICB9IGFzIENhbnZhc1RleHREYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdmaWxlMScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdmaWxlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogJ3NvbWUtZmlsZS5tZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDMwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeTogMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogJ2xpbmsxJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2xpbmsnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeDogNTAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTAwXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAndGV4dDInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICctIFt4XSBBbm90aGVyIHRleHQgdGFzaycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeTogMzAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMFxyXG4gICAgICAgICAgICAgICAgICAgIH0gYXMgQ2FudmFzVGV4dERhdGFcclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBlZGdlczogW11cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNhbnZhc0NvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShjYW52YXNEYXRhKTtcclxuICAgICAgICAgICAgY29uc3QgdGFza3MgPSBwYXJzZXIucGFyc2VDYW52YXNGaWxlKGNhbnZhc0NvbnRlbnQsICd0ZXN0LmNhbnZhcycpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHRhc2tzKS50b0hhdmVMZW5ndGgoMik7XHJcbiAgICAgICAgICAgIGV4cGVjdCh0YXNrc1swXS5jb250ZW50KS50b0JlKCdUZXh0IG5vZGUgdGFzaycpO1xyXG4gICAgICAgICAgICBleHBlY3QodGFza3NbMF0uY29tcGxldGVkKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAgICAgZXhwZWN0KHRhc2tzWzFdLmNvbnRlbnQpLnRvQmUoJ0Fub3RoZXIgdGV4dCB0YXNrJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdCh0YXNrc1sxXS5jb21wbGV0ZWQpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnaXNWYWxpZENhbnZhc0NvbnRlbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBjb3JyZWN0IGNhbnZhcyBKU09OJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB2YWxpZENhbnZhcyA9IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgIG5vZGVzOiBbXSxcclxuICAgICAgICAgICAgICAgIGVkZ2VzOiBbXVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChDYW52YXNQYXJzZXIuaXNWYWxpZENhbnZhc0NvbnRlbnQodmFsaWRDYW52YXMpKS50b0JlKHRydWUpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCBpbnZhbGlkIEpTT04nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGludmFsaWRKc29uID0gJ3sgaW52YWxpZCB9JztcclxuICAgICAgICAgICAgZXhwZWN0KENhbnZhc1BhcnNlci5pc1ZhbGlkQ2FudmFzQ29udGVudChpbnZhbGlkSnNvbikpLnRvQmUoZmFsc2UpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCBKU09OIHdpdGhvdXQgcmVxdWlyZWQgcHJvcGVydGllcycsICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbWlzc2luZ05vZGVzID0gSlNPTi5zdHJpbmdpZnkoeyBlZGdlczogW10gfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1pc3NpbmdFZGdlcyA9IEpTT04uc3RyaW5naWZ5KHsgbm9kZXM6IFtdIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KENhbnZhc1BhcnNlci5pc1ZhbGlkQ2FudmFzQ29udGVudChtaXNzaW5nTm9kZXMpKS50b0JlKGZhbHNlKTtcclxuICAgICAgICAgICAgZXhwZWN0KENhbnZhc1BhcnNlci5pc1ZhbGlkQ2FudmFzQ29udGVudChtaXNzaW5nRWRnZXMpKS50b0JlKGZhbHNlKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdleHRyYWN0VGV4dE9ubHknLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBleHRyYWN0IHRleHQgY29udGVudCBmcm9tIGFsbCB0ZXh0IG5vZGVzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjYW52YXNEYXRhOiBDYW52YXNEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgbm9kZXM6IFtcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnbm9kZTEnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICdGaXJzdCB0ZXh0IG5vZGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDIwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDBcclxuICAgICAgICAgICAgICAgICAgICB9IGFzIENhbnZhc1RleHREYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdmaWxlMScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdmaWxlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogJ3NvbWUtZmlsZS5tZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDMwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeTogMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogJ25vZGUyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnU2Vjb25kIHRleHQgbm9kZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeTogMzAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMFxyXG4gICAgICAgICAgICAgICAgICAgIH0gYXMgQ2FudmFzVGV4dERhdGFcclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBlZGdlczogW11cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNhbnZhc0NvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShjYW52YXNEYXRhKTtcclxuICAgICAgICAgICAgY29uc3QgdGV4dENvbnRlbnQgPSBwYXJzZXIuZXh0cmFjdFRleHRPbmx5KGNhbnZhc0NvbnRlbnQpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHRleHRDb250ZW50KS50b0JlKCdGaXJzdCB0ZXh0IG5vZGVcXG5cXG5TZWNvbmQgdGV4dCBub2RlJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGNhbnZhcyB3aXRoIG5vIHRleHQgbm9kZXMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNhbnZhc0RhdGE6IENhbnZhc0RhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBub2RlczogW1xyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdmaWxlMScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdmaWxlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogJ3NvbWUtZmlsZS5tZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHg6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeTogMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBlZGdlczogW11cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGNhbnZhc0NvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShjYW52YXNEYXRhKTtcclxuICAgICAgICAgICAgY29uc3QgdGV4dENvbnRlbnQgPSBwYXJzZXIuZXh0cmFjdFRleHRPbmx5KGNhbnZhc0NvbnRlbnQpO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHRleHRDb250ZW50KS50b0JlKCcnKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuIl19