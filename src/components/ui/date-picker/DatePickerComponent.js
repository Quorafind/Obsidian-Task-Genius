import { Component, setIcon, moment, } from "obsidian";
import { t } from "@/translations/helper";
import "@/styles/date-picker.css";
export class DatePickerComponent extends Component {
    constructor(hostEl, app, plugin, initialDate, dateMark = "ðŸ“…") {
        super();
        this.hostEl = hostEl;
        this.app = app;
        this.plugin = plugin;
        this.state = {
            selectedDate: initialDate || null,
            dateMark: dateMark,
        };
        this.currentViewDate = initialDate ? moment(initialDate) : moment();
    }
    onload() {
        this.render();
    }
    onunload() {
        this.hostEl.empty();
    }
    setOnDateChange(callback) {
        this.onDateChange = callback;
    }
    getSelectedDate() {
        return this.state.selectedDate;
    }
    setSelectedDate(date) {
        this.state.selectedDate = date;
        this.updateSelectedDateDisplay();
        if (this.onDateChange && date) {
            // Only pass the date string, let the caller handle formatting
            this.onDateChange(date);
        }
    }
    render() {
        this.hostEl.empty();
        this.hostEl.addClass("date-picker-root-container");
        const mainPanel = this.hostEl.createDiv({
            cls: "date-picker-main-panel",
        });
        // Create two-column layout
        const leftPanel = mainPanel.createDiv({
            cls: "date-picker-left-panel",
        });
        const rightPanel = mainPanel.createDiv({
            cls: "date-picker-right-panel",
        });
        this.renderQuickOptions(leftPanel);
        this.renderCalendar(rightPanel);
    }
    renderQuickOptions(container) {
        const quickOptionsContainer = container.createDiv({
            cls: "quick-options-container",
        });
        // Add quick date options
        const quickOptions = [
            { amount: 0, unit: "days", label: t("Today") },
            { amount: 1, unit: "days", label: t("Tomorrow") },
            { amount: 2, unit: "days", label: t("In 2 days") },
            { amount: 3, unit: "days", label: t("In 3 days") },
            { amount: 5, unit: "days", label: t("In 5 days") },
            { amount: 1, unit: "weeks", label: t("In 1 week") },
            { amount: 10, unit: "days", label: t("In 10 days") },
            { amount: 2, unit: "weeks", label: t("In 2 weeks") },
            { amount: 1, unit: "months", label: t("In 1 month") },
            { amount: 2, unit: "months", label: t("In 2 months") },
            { amount: 3, unit: "months", label: t("In 3 months") },
            { amount: 6, unit: "months", label: t("In 6 months") },
            { amount: 1, unit: "years", label: t("In 1 year") },
        ];
        quickOptions.forEach((option) => {
            const optionEl = quickOptionsContainer.createDiv({
                cls: "quick-option-item",
            });
            optionEl.createSpan({
                text: option.label,
                cls: "quick-option-label",
            });
            const date = moment().add(option.amount, option.unit);
            const formattedDate = date.format("YYYY-MM-DD");
            optionEl.createSpan({
                text: formattedDate,
                cls: "quick-option-date",
            });
            this.registerDomEvent(optionEl, "click", (e) => {
                e.preventDefault();
                e.stopPropagation();
                this.setSelectedDate(formattedDate);
            });
            // Highlight if this is the selected date
            if (this.state.selectedDate === formattedDate) {
                optionEl.addClass("selected");
            }
        });
        // Add clear option
        const clearOption = container.createDiv({
            cls: "quick-option-item clear-option",
        });
        clearOption.createSpan({
            text: t("Clear Date"),
            cls: "quick-option-label",
        });
        this.registerDomEvent(clearOption, "click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            this.setSelectedDate(null);
        });
    }
    renderCalendar(container) {
        const calendarContainer = container.createDiv({
            cls: "calendar-container",
        });
        this.renderCalendarHeader(calendarContainer, this.currentViewDate);
        this.renderCalendarGrid(calendarContainer, this.currentViewDate);
    }
    renderCalendarHeader(container, currentDate) {
        const header = container.createDiv({
            cls: "calendar-header",
        });
        // Previous month button
        const prevBtn = header.createDiv({
            cls: "calendar-nav-btn",
        });
        setIcon(prevBtn, "chevron-left");
        this.registerDomEvent(prevBtn, "click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            this.navigateMonth(-1);
        });
        // Month/Year display
        const monthYear = header.createDiv({
            cls: "calendar-month-year",
            text: currentDate.format("MMMM YYYY"),
        });
        // Next month button
        const nextBtn = header.createDiv({
            cls: "calendar-nav-btn",
        });
        setIcon(nextBtn, "chevron-right");
        this.registerDomEvent(nextBtn, "click", (e) => {
            e.preventDefault();
            e.stopPropagation();
            this.navigateMonth(1);
        });
    }
    renderCalendarGrid(container, currentDate) {
        const grid = container.createDiv({
            cls: "calendar-grid",
        });
        // Day headers
        const dayHeaders = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];
        dayHeaders.forEach((day) => {
            grid.createDiv({
                cls: "calendar-day-header",
                text: day,
            });
        });
        // Get first day of month and number of days
        const firstDay = currentDate.clone().startOf("month");
        const lastDay = currentDate.clone().endOf("month");
        const startDate = firstDay.clone().startOf("week");
        const endDate = lastDay.clone().endOf("week");
        // Generate calendar days
        const current = startDate.clone();
        while (current.isSameOrBefore(endDate)) {
            const dayEl = grid.createDiv({
                cls: "calendar-day",
                text: current.format("D"),
            });
            const dateStr = current.format("YYYY-MM-DD");
            // Store the full date string for easy comparison later
            dayEl.setAttribute("data-date", dateStr);
            // Add classes for styling
            if (!current.isSame(firstDay, "month")) {
                dayEl.addClass("other-month");
            }
            if (current.isSame(moment(), "day")) {
                dayEl.addClass("today");
            }
            if (this.state.selectedDate === dateStr) {
                dayEl.addClass("selected");
            }
            // Add click handler
            this.registerDomEvent(dayEl, "click", (e) => {
                e.preventDefault();
                e.stopPropagation();
                this.setSelectedDate(dateStr);
            });
            current.add(1, "day");
        }
    }
    navigateMonth(direction) {
        console.log(`Navigating month: ${direction}`);
        this.currentViewDate.add(direction, "month");
        this.render();
    }
    updateSelectedDateDisplay() {
        // Update the visual state of selected items
        this.hostEl.querySelectorAll(".selected").forEach((el) => {
            el.removeClass("selected");
        });
        if (this.state.selectedDate) {
            // Highlight selected quick option
            this.hostEl.querySelectorAll(".quick-option-item").forEach((el) => {
                const dateSpan = el.querySelector(".quick-option-date");
                if (dateSpan &&
                    dateSpan.textContent === this.state.selectedDate) {
                    el.addClass("selected");
                }
            });
            // Highlight selected calendar day
            this.hostEl.querySelectorAll(".calendar-day").forEach((el) => {
                const storedDate = el.getAttribute("data-date");
                if (storedDate && this.state.selectedDate === storedDate) {
                    el.addClass("selected");
                }
            });
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0ZVBpY2tlckNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkRhdGVQaWNrZXJDb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNOLFNBQVMsRUFFVCxPQUFPLEVBSVAsTUFBTSxHQUVOLE1BQU0sVUFBVSxDQUFDO0FBQ2xCLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUMxQyxPQUFPLDBCQUEwQixDQUFDO0FBUWxDLE1BQU0sT0FBTyxtQkFBb0IsU0FBUSxTQUFTO0lBUWpELFlBQ0MsTUFBbUIsRUFDbkIsR0FBUSxFQUNSLE1BQThCLEVBQzlCLFdBQW9CLEVBQ3BCLFdBQW1CLElBQUk7UUFFdkIsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUNmLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxLQUFLLEdBQUc7WUFDWixZQUFZLEVBQUUsV0FBVyxJQUFJLElBQUk7WUFDakMsUUFBUSxFQUFFLFFBQVE7U0FDbEIsQ0FBQztRQUNGLElBQUksQ0FBQyxlQUFlLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3JFLENBQUM7SUFFRCxNQUFNO1FBQ0wsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2YsQ0FBQztJQUVELFFBQVE7UUFDUCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxlQUFlLENBQUMsUUFBZ0M7UUFDL0MsSUFBSSxDQUFDLFlBQVksR0FBRyxRQUFRLENBQUM7SUFDOUIsQ0FBQztJQUVELGVBQWU7UUFDZCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDO0lB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Q0FBa0M7WUFDbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFO2dCQUNqRSxNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDLG9CQUFvQixDQUFDLENBQUM7Z0JBQ3hELElBQ0MsUUFBUTtvQkFDUixRQUFRLENBQUMsV0FBVyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUMvQztvQkFDRCxFQUFFLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO2lCQUN4QjtZQUNGLENBQUMsQ0FBQyxDQUFDO1lBRUgsa0NBQWtDO1lBQ2xDLElBQUksQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsZUFBZSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUU7Z0JBQzVELE1BQU0sVUFBVSxHQUFJLEVBQWtCLENBQUMsWUFBWSxDQUNsRCxXQUFXLENBQ1gsQ0FBQztnQkFDRixJQUFJLFVBQVUsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksS0FBSyxVQUFVLEVBQUU7b0JBQ3pELEVBQUUsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUM7aUJBQ3hCO1lBQ0YsQ0FBQyxDQUFDLENBQUM7U0FDSDtJQUNGLENBQUM7Q0FDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcblx0Q29tcG9uZW50LFxyXG5cdEV4dHJhQnV0dG9uQ29tcG9uZW50LFxyXG5cdHNldEljb24sXHJcblx0RHJvcGRvd25Db21wb25lbnQsXHJcblx0QnV0dG9uQ29tcG9uZW50LFxyXG5cdEFwcCxcclxuXHRtb21lbnQsXHJcblx0c2V0VG9vbHRpcCxcclxufSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IHsgdCB9IGZyb20gXCJAL3RyYW5zbGF0aW9ucy9oZWxwZXJcIjtcclxuaW1wb3J0IFwiQC9zdHlsZXMvZGF0ZS1waWNrZXIuY3NzXCI7XHJcbmltcG9ydCB0eXBlIFRhc2tQcm9ncmVzc0JhclBsdWdpbiBmcm9tIFwiQC9pbmRleFwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBEYXRlUGlja2VyU3RhdGUge1xyXG5cdHNlbGVjdGVkRGF0ZTogc3RyaW5nIHwgbnVsbDtcclxuXHRkYXRlTWFyazogc3RyaW5nO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRGF0ZVBpY2tlckNvbXBvbmVudCBleHRlbmRzIENvbXBvbmVudCB7XHJcblx0cHJpdmF0ZSBob3N0RWw6IEhUTUxFbGVtZW50O1xyXG5cdHByaXZhdGUgYXBwOiBBcHA7XHJcblx0cHJpdmF0ZSBwbHVnaW4/OiBUYXNrUHJvZ3Jlc3NCYXJQbHVnaW47XHJcblx0cHJpdmF0ZSBzdGF0ZTogRGF0ZVBpY2tlclN0YXRlO1xyXG5cdHByaXZhdGUgb25EYXRlQ2hhbmdlPzogKGRhdGU6IHN0cmluZykgPT4gdm9pZDtcclxuXHRwcml2YXRlIGN1cnJlbnRWaWV3RGF0ZTogbW9tZW50Lk1vbWVudDtcclxuXHJcblx0Y29uc3RydWN0b3IoXHJcblx0XHRob3N0RWw6IEhUTUxFbGVtZW50LFxyXG5cdFx0YXBwOiBBcHAsXHJcblx0XHRwbHVnaW4/OiBUYXNrUHJvZ3Jlc3NCYXJQbHVnaW4sXHJcblx0XHRpbml0aWFsRGF0ZT86IHN0cmluZyxcclxuXHRcdGRhdGVNYXJrOiBzdHJpbmcgPSBcIvCfk4VcIlxyXG5cdCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdHRoaXMuaG9zdEVsID0gaG9zdEVsO1xyXG5cdFx0dGhpcy5hcHAgPSBhcHA7XHJcblx0XHR0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuXHRcdHRoaXMuc3RhdGUgPSB7XHJcblx0XHRcdHNlbGVjdGVkRGF0ZTogaW5pdGlhbERhdGUgfHwgbnVsbCxcclxuXHRcdFx0ZGF0ZU1hcms6IGRhdGVNYXJrLFxyXG5cdFx0fTtcclxuXHRcdHRoaXMuY3VycmVudFZpZXdEYXRlID0gaW5pdGlhbERhdGUgPyBtb21lbnQoaW5pdGlhbERhdGUpIDogbW9tZW50KCk7XHJcblx0fVxyXG5cclxuXHRvbmxvYWQoKTogdm9pZCB7XHJcblx0XHR0aGlzLnJlbmRlcigpO1xyXG5cdH1cclxuXHJcblx0b251bmxvYWQoKTogdm9pZCB7XHJcblx0XHR0aGlzLmhvc3RFbC5lbXB0eSgpO1xyXG5cdH1cclxuXHJcblx0c2V0T25EYXRlQ2hhbmdlKGNhbGxiYWNrOiAoZGF0ZTogc3RyaW5nKSA9PiB2b2lkKTogdm9pZCB7XHJcblx0XHR0aGlzLm9uRGF0ZUNoYW5nZSA9IGNhbGxiYWNrO1xyXG5cdH1cclxuXHJcblx0Z2V0U2VsZWN0ZWREYXRlKCk6IHN0cmluZyB8IG51bGwge1xyXG5cdFx0cmV0dXJuIHRoaXMuc3RhdGUuc2VsZWN0ZWREYXRlO1xyXG5cdH1cclxuXHJcblx0c2V0U2VsZWN0ZWREYXRlKGRhdGU6IHN0cmluZyB8IG51bGwpOiB2b2lkIHtcclxuXHRcdHRoaXMuc3RhdGUuc2VsZWN0ZWREYXRlID0gZGF0ZTtcclxuXHRcdHRoaXMudXBkYXRlU2VsZWN0ZWREYXRlRGlzcGxheSgpO1xyXG5cdFx0aWYgKHRoaXMub25EYXRlQ2hhbmdlICYmIGRhdGUpIHtcclxuXHRcdFx0Ly8gT25seSBwYXNzIHRoZSBkYXRlIHN0cmluZywgbGV0IHRoZSBjYWxsZXIgaGFuZGxlIGZvcm1hdHRpbmdcclxuXHRcdFx0dGhpcy5vbkRhdGVDaGFuZ2UoZGF0ZSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHJlbmRlcigpOiB2b2lkIHtcclxuXHRcdHRoaXMuaG9zdEVsLmVtcHR5KCk7XHJcblx0XHR0aGlzLmhvc3RFbC5hZGRDbGFzcyhcImRhdGUtcGlja2VyLXJvb3QtY29udGFpbmVyXCIpO1xyXG5cclxuXHRcdGNvbnN0IG1haW5QYW5lbCA9IHRoaXMuaG9zdEVsLmNyZWF0ZURpdih7XHJcblx0XHRcdGNsczogXCJkYXRlLXBpY2tlci1tYWluLXBhbmVsXCIsXHJcblx0XHR9KTtcclxuXHJcblx0XHQvLyBDcmVhdGUgdHdvLWNvbHVtbiBsYXlvdXRcclxuXHRcdGNvbnN0IGxlZnRQYW5lbCA9IG1haW5QYW5lbC5jcmVhdGVEaXYoe1xyXG5cdFx0XHRjbHM6IFwiZGF0ZS1waWNrZXItbGVmdC1wYW5lbFwiLFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0Y29uc3QgcmlnaHRQYW5lbCA9IG1haW5QYW5lbC5jcmVhdGVEaXYoe1xyXG5cdFx0XHRjbHM6IFwiZGF0ZS1waWNrZXItcmlnaHQtcGFuZWxcIixcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMucmVuZGVyUXVpY2tPcHRpb25zKGxlZnRQYW5lbCk7XHJcblx0XHR0aGlzLnJlbmRlckNhbGVuZGFyKHJpZ2h0UGFuZWwpO1xyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSByZW5kZXJRdWlja09wdGlvbnMoY29udGFpbmVyOiBIVE1MRWxlbWVudCk6IHZvaWQge1xyXG5cdFx0Y29uc3QgcXVpY2tPcHRpb25zQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7XHJcblx0XHRcdGNsczogXCJxdWljay1vcHRpb25zLWNvbnRhaW5lclwiLFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0Ly8gQWRkIHF1aWNrIGRhdGUgb3B0aW9uc1xyXG5cdFx0Y29uc3QgcXVpY2tPcHRpb25zID0gW1xyXG5cdFx0XHR7IGFtb3VudDogMCwgdW5pdDogXCJkYXlzXCIsIGxhYmVsOiB0KFwiVG9kYXlcIikgfSxcclxuXHRcdFx0eyBhbW91bnQ6IDEsIHVuaXQ6IFwiZGF5c1wiLCBsYWJlbDogdChcIlRvbW9ycm93XCIpIH0sXHJcblx0XHRcdHsgYW1vdW50OiAyLCB1bml0OiBcImRheXNcIiwgbGFiZWw6IHQoXCJJbiAyIGRheXNcIikgfSxcclxuXHRcdFx0eyBhbW91bnQ6IDMsIHVuaXQ6IFwiZGF5c1wiLCBsYWJlbDogdChcIkluIDMgZGF5c1wiKSB9LFxyXG5cdFx0XHR7IGFtb3VudDogNSwgdW5pdDogXCJkYXlzXCIsIGxhYmVsOiB0KFwiSW4gNSBkYXlzXCIpIH0sXHJcblx0XHRcdHsgYW1vdW50OiAxLCB1bml0OiBcIndlZWtzXCIsIGxhYmVsOiB0KFwiSW4gMSB3ZWVrXCIpIH0sXHJcblx0XHRcdHsgYW1vdW50OiAxMCwgdW5pdDogXCJkYXlzXCIsIGxhYmVsOiB0KFwiSW4gMTAgZGF5c1wiKSB9LFxyXG5cdFx0XHR7IGFtb3VudDogMiwgdW5pdDogXCJ3ZWVrc1wiLCBsYWJlbDogdChcIkluIDIgd2Vla3NcIikgfSxcclxuXHRcdFx0eyBhbW91bnQ6IDEsIHVuaXQ6IFwibW9udGhzXCIsIGxhYmVsOiB0KFwiSW4gMSBtb250aFwiKSB9LFxyXG5cdFx0XHR7IGFtb3VudDogMiwgdW5pdDogXCJtb250aHNcIiwgbGFiZWw6IHQoXCJJbiAyIG1vbnRoc1wiKSB9LFxyXG5cdFx0XHR7IGFtb3VudDogMywgdW5pdDogXCJtb250aHNcIiwgbGFiZWw6IHQoXCJJbiAzIG1vbnRoc1wiKSB9LFxyXG5cdFx0XHR7IGFtb3VudDogNiwgdW5pdDogXCJtb250aHNcIiwgbGFiZWw6IHQoXCJJbiA2IG1vbnRoc1wiKSB9LFxyXG5cdFx0XHR7IGFtb3VudDogMSwgdW5pdDogXCJ5ZWFyc1wiLCBsYWJlbDogdChcIkluIDEgeWVhclwiKSB9LFxyXG5cdFx0XTtcclxuXHJcblx0XHRxdWlja09wdGlvbnMuZm9yRWFjaCgob3B0aW9uKSA9PiB7XHJcblx0XHRcdGNvbnN0IG9wdGlvbkVsID0gcXVpY2tPcHRpb25zQ29udGFpbmVyLmNyZWF0ZURpdih7XHJcblx0XHRcdFx0Y2xzOiBcInF1aWNrLW9wdGlvbi1pdGVtXCIsXHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0b3B0aW9uRWwuY3JlYXRlU3Bhbih7XHJcblx0XHRcdFx0dGV4dDogb3B0aW9uLmxhYmVsLFxyXG5cdFx0XHRcdGNsczogXCJxdWljay1vcHRpb24tbGFiZWxcIixcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRjb25zdCBkYXRlID0gbW9tZW50KCkuYWRkKFxyXG5cdFx0XHRcdG9wdGlvbi5hbW91bnQsXHJcblx0XHRcdFx0b3B0aW9uLnVuaXQgYXMgbW9tZW50LnVuaXRPZlRpbWUuRHVyYXRpb25Db25zdHJ1Y3RvclxyXG5cdFx0XHQpO1xyXG5cdFx0XHRjb25zdCBmb3JtYXR0ZWREYXRlID0gZGF0ZS5mb3JtYXQoXCJZWVlZLU1NLUREXCIpO1xyXG5cclxuXHRcdFx0b3B0aW9uRWwuY3JlYXRlU3Bhbih7XHJcblx0XHRcdFx0dGV4dDogZm9ybWF0dGVkRGF0ZSxcclxuXHRcdFx0XHRjbHM6IFwicXVpY2stb3B0aW9uLWRhdGVcIixcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHR0aGlzLnJlZ2lzdGVyRG9tRXZlbnQob3B0aW9uRWwsIFwiY2xpY2tcIiwgKGUpID0+IHtcclxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHRcdFx0XHR0aGlzLnNldFNlbGVjdGVkRGF0ZShmb3JtYXR0ZWREYXRlKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHQvLyBIaWdobGlnaHQgaWYgdGhpcyBpcyB0aGUgc2VsZWN0ZWQgZGF0ZVxyXG5cdFx0XHRpZiAodGhpcy5zdGF0ZS5zZWxlY3RlZERhdGUgPT09IGZvcm1hdHRlZERhdGUpIHtcclxuXHRcdFx0XHRvcHRpb25FbC5hZGRDbGFzcyhcInNlbGVjdGVkXCIpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0XHQvLyBBZGQgY2xlYXIgb3B0aW9uXHJcblx0XHRjb25zdCBjbGVhck9wdGlvbiA9IGNvbnRhaW5lci5jcmVhdGVEaXYoe1xyXG5cdFx0XHRjbHM6IFwicXVpY2stb3B0aW9uLWl0ZW0gY2xlYXItb3B0aW9uXCIsXHJcblx0XHR9KTtcclxuXHJcblx0XHRjbGVhck9wdGlvbi5jcmVhdGVTcGFuKHtcclxuXHRcdFx0dGV4dDogdChcIkNsZWFyIERhdGVcIiksXHJcblx0XHRcdGNsczogXCJxdWljay1vcHRpb24tbGFiZWxcIixcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMucmVnaXN0ZXJEb21FdmVudChjbGVhck9wdGlvbiwgXCJjbGlja1wiLCAoZSkgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblx0XHRcdHRoaXMuc2V0U2VsZWN0ZWREYXRlKG51bGwpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHJlbmRlckNhbGVuZGFyKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpOiB2b2lkIHtcclxuXHRcdGNvbnN0IGNhbGVuZGFyQ29udGFpbmVyID0gY29udGFpbmVyLmNyZWF0ZURpdih7XHJcblx0XHRcdGNsczogXCJjYWxlbmRhci1jb250YWluZXJcIixcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMucmVuZGVyQ2FsZW5kYXJIZWFkZXIoY2FsZW5kYXJDb250YWluZXIsIHRoaXMuY3VycmVudFZpZXdEYXRlKTtcclxuXHRcdHRoaXMucmVuZGVyQ2FsZW5kYXJHcmlkKGNhbGVuZGFyQ29udGFpbmVyLCB0aGlzLmN1cnJlbnRWaWV3RGF0ZSk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHJlbmRlckNhbGVuZGFySGVhZGVyKFxyXG5cdFx0Y29udGFpbmVyOiBIVE1MRWxlbWVudCxcclxuXHRcdGN1cnJlbnREYXRlOiBtb21lbnQuTW9tZW50XHJcblx0KTogdm9pZCB7XHJcblx0XHRjb25zdCBoZWFkZXIgPSBjb250YWluZXIuY3JlYXRlRGl2KHtcclxuXHRcdFx0Y2xzOiBcImNhbGVuZGFyLWhlYWRlclwiLFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0Ly8gUHJldmlvdXMgbW9udGggYnV0dG9uXHJcblx0XHRjb25zdCBwcmV2QnRuID0gaGVhZGVyLmNyZWF0ZURpdih7XHJcblx0XHRcdGNsczogXCJjYWxlbmRhci1uYXYtYnRuXCIsXHJcblx0XHR9KTtcclxuXHRcdHNldEljb24ocHJldkJ0biwgXCJjaGV2cm9uLWxlZnRcIik7XHJcblx0XHR0aGlzLnJlZ2lzdGVyRG9tRXZlbnQocHJldkJ0biwgXCJjbGlja1wiLCAoZSkgPT4ge1xyXG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XHJcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblx0XHRcdHRoaXMubmF2aWdhdGVNb250aCgtMSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHQvLyBNb250aC9ZZWFyIGRpc3BsYXlcclxuXHRcdGNvbnN0IG1vbnRoWWVhciA9IGhlYWRlci5jcmVhdGVEaXYoe1xyXG5cdFx0XHRjbHM6IFwiY2FsZW5kYXItbW9udGgteWVhclwiLFxyXG5cdFx0XHR0ZXh0OiBjdXJyZW50RGF0ZS5mb3JtYXQoXCJNTU1NIFlZWVlcIiksXHJcblx0XHR9KTtcclxuXHJcblx0XHQvLyBOZXh0IG1vbnRoIGJ1dHRvblxyXG5cdFx0Y29uc3QgbmV4dEJ0biA9IGhlYWRlci5jcmVhdGVEaXYoe1xyXG5cdFx0XHRjbHM6IFwiY2FsZW5kYXItbmF2LWJ0blwiLFxyXG5cdFx0fSk7XHJcblx0XHRzZXRJY29uKG5leHRCdG4sIFwiY2hldnJvbi1yaWdodFwiKTtcclxuXHRcdHRoaXMucmVnaXN0ZXJEb21FdmVudChuZXh0QnRuLCBcImNsaWNrXCIsIChlKSA9PiB7XHJcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHRcdFx0dGhpcy5uYXZpZ2F0ZU1vbnRoKDEpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRwcml2YXRlIHJlbmRlckNhbGVuZGFyR3JpZChcclxuXHRcdGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsXHJcblx0XHRjdXJyZW50RGF0ZTogbW9tZW50Lk1vbWVudFxyXG5cdCk6IHZvaWQge1xyXG5cdFx0Y29uc3QgZ3JpZCA9IGNvbnRhaW5lci5jcmVhdGVEaXYoe1xyXG5cdFx0XHRjbHM6IFwiY2FsZW5kYXItZ3JpZFwiLFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0Ly8gRGF5IGhlYWRlcnNcclxuXHRcdGNvbnN0IGRheUhlYWRlcnMgPSBbXCJTdVwiLCBcIk1vXCIsIFwiVHVcIiwgXCJXZVwiLCBcIlRoXCIsIFwiRnJcIiwgXCJTYVwiXTtcclxuXHRcdGRheUhlYWRlcnMuZm9yRWFjaCgoZGF5KSA9PiB7XHJcblx0XHRcdGdyaWQuY3JlYXRlRGl2KHtcclxuXHRcdFx0XHRjbHM6IFwiY2FsZW5kYXItZGF5LWhlYWRlclwiLFxyXG5cdFx0XHRcdHRleHQ6IGRheSxcclxuXHRcdFx0fSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHQvLyBHZXQgZmlyc3QgZGF5IG9mIG1vbnRoIGFuZCBudW1iZXIgb2YgZGF5c1xyXG5cdFx0Y29uc3QgZmlyc3REYXkgPSBjdXJyZW50RGF0ZS5jbG9uZSgpLnN0YXJ0T2YoXCJtb250aFwiKTtcclxuXHRcdGNvbnN0IGxhc3REYXkgPSBjdXJyZW50RGF0ZS5jbG9uZSgpLmVuZE9mKFwibW9udGhcIik7XHJcblx0XHRjb25zdCBzdGFydERhdGUgPSBmaXJzdERheS5jbG9uZSgpLnN0YXJ0T2YoXCJ3ZWVrXCIpO1xyXG5cdFx0Y29uc3QgZW5kRGF0ZSA9IGxhc3REYXkuY2xvbmUoKS5lbmRPZihcIndlZWtcIik7XHJcblxyXG5cdFx0Ly8gR2VuZXJhdGUgY2FsZW5kYXIgZGF5c1xyXG5cdFx0Y29uc3QgY3VycmVudCA9IHN0YXJ0RGF0ZS5jbG9uZSgpO1xyXG5cdFx0d2hpbGUgKGN1cnJlbnQuaXNTYW1lT3JCZWZvcmUoZW5kRGF0ZSkpIHtcclxuXHRcdFx0Y29uc3QgZGF5RWwgPSBncmlkLmNyZWF0ZURpdih7XHJcblx0XHRcdFx0Y2xzOiBcImNhbGVuZGFyLWRheVwiLFxyXG5cdFx0XHRcdHRleHQ6IGN1cnJlbnQuZm9ybWF0KFwiRFwiKSxcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRjb25zdCBkYXRlU3RyID0gY3VycmVudC5mb3JtYXQoXCJZWVlZLU1NLUREXCIpO1xyXG5cclxuXHRcdFx0Ly8gU3RvcmUgdGhlIGZ1bGwgZGF0ZSBzdHJpbmcgZm9yIGVhc3kgY29tcGFyaXNvbiBsYXRlclxyXG5cdFx0XHRkYXlFbC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWRhdGVcIiwgZGF0ZVN0cik7XHJcblxyXG5cdFx0XHQvLyBBZGQgY2xhc3NlcyBmb3Igc3R5bGluZ1xyXG5cdFx0XHRpZiAoIWN1cnJlbnQuaXNTYW1lKGZpcnN0RGF5LCBcIm1vbnRoXCIpKSB7XHJcblx0XHRcdFx0ZGF5RWwuYWRkQ2xhc3MoXCJvdGhlci1tb250aFwiKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKGN1cnJlbnQuaXNTYW1lKG1vbWVudCgpLCBcImRheVwiKSkge1xyXG5cdFx0XHRcdGRheUVsLmFkZENsYXNzKFwidG9kYXlcIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh0aGlzLnN0YXRlLnNlbGVjdGVkRGF0ZSA9PT0gZGF0ZVN0cikge1xyXG5cdFx0XHRcdGRheUVsLmFkZENsYXNzKFwic2VsZWN0ZWRcIik7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIEFkZCBjbGljayBoYW5kbGVyXHJcblx0XHRcdHRoaXMucmVnaXN0ZXJEb21FdmVudChkYXlFbCwgXCJjbGlja1wiLCAoZSkgPT4ge1xyXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cdFx0XHRcdHRoaXMuc2V0U2VsZWN0ZWREYXRlKGRhdGVTdHIpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdGN1cnJlbnQuYWRkKDEsIFwiZGF5XCIpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cHJpdmF0ZSBuYXZpZ2F0ZU1vbnRoKGRpcmVjdGlvbjogbnVtYmVyKTogdm9pZCB7XHJcblx0XHRjb25zb2xlLmxvZyhgTmF2aWdhdGluZyBtb250aDogJHtkaXJlY3Rpb259YCk7XHJcblx0XHR0aGlzLmN1cnJlbnRWaWV3RGF0ZS5hZGQoZGlyZWN0aW9uLCBcIm1vbnRoXCIpO1xyXG5cdFx0dGhpcy5yZW5kZXIoKTtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgdXBkYXRlU2VsZWN0ZWREYXRlRGlzcGxheSgpOiB2b2lkIHtcclxuXHRcdC8vIFVwZGF0ZSB0aGUgdmlzdWFsIHN0YXRlIG9mIHNlbGVjdGVkIGl0ZW1zXHJcblx0XHR0aGlzLmhvc3RFbC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNlbGVjdGVkXCIpLmZvckVhY2goKGVsKSA9PiB7XHJcblx0XHRcdGVsLnJlbW92ZUNsYXNzKFwic2VsZWN0ZWRcIik7XHJcblx0XHR9KTtcclxuXHJcblx0XHRpZiAodGhpcy5zdGF0ZS5zZWxlY3RlZERhdGUpIHtcclxuXHRcdFx0Ly8gSGlnaGxpZ2h0IHNlbGVjdGVkIHF1aWNrIG9wdGlvblxyXG5cdFx0XHR0aGlzLmhvc3RFbC5xdWVyeVNlbGVjdG9yQWxsKFwiLnF1aWNrLW9wdGlvbi1pdGVtXCIpLmZvckVhY2goKGVsKSA9PiB7XHJcblx0XHRcdFx0Y29uc3QgZGF0ZVNwYW4gPSBlbC5xdWVyeVNlbGVjdG9yKFwiLnF1aWNrLW9wdGlvbi1kYXRlXCIpO1xyXG5cdFx0XHRcdGlmIChcclxuXHRcdFx0XHRcdGRhdGVTcGFuICYmXHJcblx0XHRcdFx0XHRkYXRlU3Bhbi50ZXh0Q29udGVudCA9PT0gdGhpcy5zdGF0ZS5zZWxlY3RlZERhdGVcclxuXHRcdFx0XHQpIHtcclxuXHRcdFx0XHRcdGVsLmFkZENsYXNzKFwic2VsZWN0ZWRcIik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdC8vIEhpZ2hsaWdodCBzZWxlY3RlZCBjYWxlbmRhciBkYXlcclxuXHRcdFx0dGhpcy5ob3N0RWwucXVlcnlTZWxlY3RvckFsbChcIi5jYWxlbmRhci1kYXlcIikuZm9yRWFjaCgoZWwpID0+IHtcclxuXHRcdFx0XHRjb25zdCBzdG9yZWREYXRlID0gKGVsIGFzIEhUTUxFbGVtZW50KS5nZXRBdHRyaWJ1dGUoXHJcblx0XHRcdFx0XHRcImRhdGEtZGF0ZVwiXHJcblx0XHRcdFx0KTtcclxuXHRcdFx0XHRpZiAoc3RvcmVkRGF0ZSAmJiB0aGlzLnN0YXRlLnNlbGVjdGVkRGF0ZSA9PT0gc3RvcmVkRGF0ZSkge1xyXG5cdFx0XHRcdFx0ZWwuYWRkQ2xhc3MoXCJzZWxlY3RlZFwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG4iXX0=