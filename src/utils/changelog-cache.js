const STORAGE_KEY = "task-genius-changelog-cache";
const getChannelKey = (isBeta) => isBeta ? "beta" : "stable";
const isChangelogCacheEntry = (value) => {
    if (!value || typeof value !== "object") {
        return false;
    }
    const entry = value;
    return (typeof entry.version === "string" &&
        typeof entry.markdown === "string" &&
        typeof entry.sourceUrl === "string" &&
        typeof entry.updatedAt === "number");
};
const sanitizeCachePayload = (value) => {
    if (!value || typeof value !== "object") {
        return {};
    }
    const payload = value;
    const sanitized = {};
    if (isChangelogCacheEntry(payload.stable)) {
        sanitized.stable = payload.stable;
    }
    if (isChangelogCacheEntry(payload.beta)) {
        sanitized.beta = payload.beta;
    }
    return sanitized;
};
const getStorage = () => {
    var _a;
    try {
        if (typeof window === "undefined") {
            return null;
        }
        return (_a = window.localStorage) !== null && _a !== void 0 ? _a : null;
    }
    catch (_b) {
        return null;
    }
};
const loadCache = (app) => {
    try {
        if (typeof (app === null || app === void 0 ? void 0 : app.loadLocalStorage) === "function") {
            return sanitizeCachePayload(app.loadLocalStorage(STORAGE_KEY));
        }
    }
    catch (error) {
        console.warn("[ChangelogCache] Failed to load via app localStorage", error);
    }
    const storage = getStorage();
    if (!storage) {
        return {};
    }
    try {
        const raw = storage.getItem(STORAGE_KEY);
        if (!raw) {
            return {};
        }
        return sanitizeCachePayload(JSON.parse(raw));
    }
    catch (error) {
        console.warn("[ChangelogCache] Failed to load via window localStorage", error);
        return {};
    }
};
const saveCache = (cache, app) => {
    try {
        if (typeof (app === null || app === void 0 ? void 0 : app.saveLocalStorage) === "function") {
            app.saveLocalStorage(STORAGE_KEY, cache);
            return;
        }
    }
    catch (error) {
        console.warn("[ChangelogCache] Failed to save via app localStorage", error);
    }
    const storage = getStorage();
    if (!storage) {
        return;
    }
    try {
        if (!cache.stable && !cache.beta) {
            storage.removeItem(STORAGE_KEY);
            return;
        }
        storage.setItem(STORAGE_KEY, JSON.stringify(cache));
    }
    catch (error) {
        console.warn("[ChangelogCache] Failed to save via window localStorage", error);
    }
};
export const getCachedChangelog = (version, isBeta, app) => {
    const cache = loadCache(app);
    const channel = getChannelKey(isBeta);
    const entry = cache[channel];
    if (!entry || entry.version !== version) {
        return null;
    }
    return entry;
};
export const getLatestCachedChangelog = (isBeta, app) => {
    var _a;
    const cache = loadCache(app);
    const channel = getChannelKey(isBeta);
    return (_a = cache[channel]) !== null && _a !== void 0 ? _a : null;
};
export const cacheChangelog = (version, isBeta, data, app) => {
    const cache = loadCache(app);
    const channel = getChannelKey(isBeta);
    cache[channel] = {
        version,
        markdown: data.markdown,
        sourceUrl: data.sourceUrl,
        updatedAt: Date.now(),
    };
    saveCache(cache, app);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbmdlbG9nLWNhY2hlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2hhbmdlbG9nLWNhY2hlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE1BQU0sV0FBVyxHQUFHLDZCQUE2QixDQUFDO0FBZ0JsRCxNQUFNLGFBQWEsR0FBRyxDQUFDLE1BQWUsRUFBZ0IsRUFBRSxDQUN2RCxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0FBRTVCLE1BQU0scUJBQXFCLEdBQUcsQ0FDN0IsS0FBYyxFQUNpQixFQUFFO0lBQ2pDLElBQUksQ0FBQyxLQUFLLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1FBQ3hDLE9BQU8sS0FBSyxDQUFDO0tBQ2I7SUFFRCxNQUFNLEtBQUssR0FBRyxLQUFxQyxDQUFDO0lBQ3BELE9BQU8sQ0FDTixPQUFPLEtBQUssQ0FBQyxPQUFPLEtBQUssUUFBUTtRQUNqQyxPQUFPLEtBQUssQ0FBQyxRQUFRLEtBQUssUUFBUTtRQUNsQyxPQUFPLEtBQUssQ0FBQyxTQUFTLEtBQUssUUFBUTtRQUNuQyxPQUFPLEtBQUssQ0FBQyxTQUFTLEtBQUssUUFBUSxDQUNuQyxDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBRUYsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLEtBQWMsRUFBeUIsRUFBRTtJQUN0RSxJQUFJLENBQUMsS0FBSyxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtRQUN4QyxPQUFPLEVBQUUsQ0FBQztLQUNWO0lBRUQsTUFBTSxPQUFPLEdBQUcsS0FBK0MsQ0FBQztJQUNoRSxNQUFNLFNBQVMsR0FBMEIsRUFBRSxDQUFDO0lBRTVDLElBQUkscUJBQXFCLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQzFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztLQUNsQztJQUVELElBQUkscUJBQXFCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FB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QUM7SUFDdEMsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzdCLElBQUksQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLE9BQU8sS0FBSyxPQUFPLEVBQUU7UUFDeEMsT0FBTyxJQUFJLENBQUM7S0FDWjtJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2QsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sd0JBQXdCLEdBQUcsQ0FDdkMsTUFBZSxFQUNmLEdBQVMsRUFDb0IsRUFBRTs7SUFDL0IsTUFBTSxLQUFLLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLE1BQU0sT0FBTyxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN0QyxPQUFPLE1BQUEsS0FBSyxDQUFDLE9BQU8sQ0FBQyxtQ0FBSSxJQUFJLENBQUM7QUFDL0IsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLENBQzdCLE9BQWUsRUFDZixNQUFlLEVBQ2YsSUFBeUQsRUFDekQsR0FBUyxFQUNGLEVBQUU7SUFDVCxNQUFNLEtBQUssR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDN0IsTUFBTSxPQUFPLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3RDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRztRQUNoQixPQUFPO1FBQ1AsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO1FBQ3ZCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztRQUN6QixTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtLQUNyQixDQUFDO0lBQ0YsU0FBUyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQztBQUN2QixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuXHJcbmNvbnN0IFNUT1JBR0VfS0VZID0gXCJ0YXNrLWdlbml1cy1jaGFuZ2Vsb2ctY2FjaGVcIjtcclxuXHJcbnR5cGUgQ2FjaGVDaGFubmVsID0gXCJzdGFibGVcIiB8IFwiYmV0YVwiO1xyXG5cclxuaW50ZXJmYWNlIENoYW5nZWxvZ0NhY2hlRW50cnkge1xyXG5cdHZlcnNpb246IHN0cmluZztcclxuXHRtYXJrZG93bjogc3RyaW5nO1xyXG5cdHNvdXJjZVVybDogc3RyaW5nO1xyXG5cdHVwZGF0ZWRBdDogbnVtYmVyO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQ2hhbmdlbG9nQ2FjaGVQYXlsb2FkIHtcclxuXHRzdGFibGU/OiBDaGFuZ2Vsb2dDYWNoZUVudHJ5O1xyXG5cdGJldGE/OiBDaGFuZ2Vsb2dDYWNoZUVudHJ5O1xyXG59XHJcblxyXG5jb25zdCBnZXRDaGFubmVsS2V5ID0gKGlzQmV0YTogYm9vbGVhbik6IENhY2hlQ2hhbm5lbCA9PlxyXG5cdGlzQmV0YSA/IFwiYmV0YVwiIDogXCJzdGFibGVcIjtcclxuXHJcbmNvbnN0IGlzQ2hhbmdlbG9nQ2FjaGVFbnRyeSA9IChcclxuXHR2YWx1ZTogdW5rbm93bixcclxuKTogdmFsdWUgaXMgQ2hhbmdlbG9nQ2FjaGVFbnRyeSA9PiB7XHJcblx0aWYgKCF2YWx1ZSB8fCB0eXBlb2YgdmFsdWUgIT09IFwib2JqZWN0XCIpIHtcclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcblxyXG5cdGNvbnN0IGVudHJ5ID0gdmFsdWUgYXMgUGFydGlhbDxDaGFuZ2Vsb2dDYWNoZUVudHJ5PjtcclxuXHRyZXR1cm4gKFxyXG5cdFx0dHlwZW9mIGVudHJ5LnZlcnNpb24gPT09IFwic3RyaW5nXCIgJiZcclxuXHRcdHR5cGVvZiBlbnRyeS5tYXJrZG93biA9PT0gXCJzdHJpbmdcIiAmJlxyXG5cdFx0dHlwZW9mIGVudHJ5LnNvdXJjZVVybCA9PT0gXCJzdHJpbmdcIiAmJlxyXG5cdFx0dHlwZW9mIGVudHJ5LnVwZGF0ZWRBdCA9PT0gXCJudW1iZXJcIlxyXG5cdCk7XHJcbn07XHJcblxyXG5jb25zdCBzYW5pdGl6ZUNhY2hlUGF5bG9hZCA9ICh2YWx1ZTogdW5rbm93bik6IENoYW5nZWxvZ0NhY2hlUGF5bG9hZCA9PiB7XHJcblx0aWYgKCF2YWx1ZSB8fCB0eXBlb2YgdmFsdWUgIT09IFwib2JqZWN0XCIpIHtcclxuXHRcdHJldHVybiB7fTtcclxuXHR9XHJcblxyXG5cdGNvbnN0IHBheWxvYWQgPSB2YWx1ZSBhcyBQYXJ0aWFsPFJlY29yZDxDYWNoZUNoYW5uZWwsIHVua25vd24+PjtcclxuXHRjb25zdCBzYW5pdGl6ZWQ6IENoYW5nZWxvZ0NhY2hlUGF5bG9hZCA9IHt9O1xyXG5cclxuXHRpZiAoaXNDaGFuZ2Vsb2dDYWNoZUVudHJ5KHBheWxvYWQuc3RhYmxlKSkge1xyXG5cdFx0c2FuaXRpemVkLnN0YWJsZSA9IHBheWxvYWQuc3RhYmxlO1xyXG5cdH1cclxuXHJcblx0aWYgKGlzQ2hhbmdlbG9nQ2FjaGVFbnRyeShwYXlsb2FkLmJldGEpKSB7XHJcblx0XHRzYW5pdGl6ZWQuYmV0YSA9IHBheWxvYWQuYmV0YTtcclxuXHR9XHJcblxyXG5cdHJldHVybiBzYW5pdGl6ZWQ7XHJcbn07XHJcblxyXG5jb25zdCBnZXRTdG9yYWdlID0gKCk6IFN0b3JhZ2UgfCBudWxsID0+IHtcclxuXHR0cnkge1xyXG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIpIHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2UgPz8gbnVsbDtcclxuXHR9IGNhdGNoIHtcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxufTtcclxuXHJcbmNvbnN0IGxvYWRDYWNoZSA9IChhcHA/OiBBcHApOiBDaGFuZ2Vsb2dDYWNoZVBheWxvYWQgPT4ge1xyXG5cdHRyeSB7XHJcblx0XHRpZiAodHlwZW9mIGFwcD8ubG9hZExvY2FsU3RvcmFnZSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcblx0XHRcdHJldHVybiBzYW5pdGl6ZUNhY2hlUGF5bG9hZChhcHAubG9hZExvY2FsU3RvcmFnZShTVE9SQUdFX0tFWSkpO1xyXG5cdFx0fVxyXG5cdH0gY2F0Y2ggKGVycm9yKSB7XHJcblx0XHRjb25zb2xlLndhcm4oXCJbQ2hhbmdlbG9nQ2FjaGVdIEZhaWxlZCB0byBsb2FkIHZpYSBhcHAgbG9jYWxTdG9yYWdlXCIsIGVycm9yKTtcclxuXHR9XHJcblxyXG5cdGNvbnN0IHN0b3JhZ2UgPSBnZXRTdG9yYWdlKCk7XHJcblx0aWYgKCFzdG9yYWdlKSB7XHJcblx0XHRyZXR1cm4ge307XHJcblx0fVxyXG5cclxuXHR0cnkge1xyXG5cdFx0Y29uc3QgcmF3ID0gc3RvcmFnZS5nZXRJdGVtKFNUT1JBR0VfS0VZKTtcclxuXHRcdGlmICghcmF3KSB7XHJcblx0XHRcdHJldHVybiB7fTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gc2FuaXRpemVDYWNoZVBheWxvYWQoSlNPTi5wYXJzZShyYXcpKTtcclxuXHR9IGNhdGNoIChlcnJvcikge1xyXG5cdFx0Y29uc29sZS53YXJuKFwiW0NoYW5nZWxvZ0NhY2hlXSBGYWlsZWQgdG8gbG9hZCB2aWEgd2luZG93IGxvY2FsU3RvcmFnZVwiLCBlcnJvcik7XHJcblx0XHRyZXR1cm4ge307XHJcblx0fVxyXG59O1xyXG5cclxuY29uc3Qgc2F2ZUNhY2hlID0gKGNhY2hlOiBDaGFuZ2Vsb2dDYWNoZVBheWxvYWQsIGFwcD86IEFwcCk6IHZvaWQgPT4ge1xyXG5cdHRyeSB7XHJcblx0XHRpZiAodHlwZW9mIGFwcD8uc2F2ZUxvY2FsU3RvcmFnZSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcblx0XHRcdGFwcC5zYXZlTG9jYWxTdG9yYWdlKFNUT1JBR0VfS0VZLCBjYWNoZSk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHR9IGNhdGNoIChlcnJvcikge1xyXG5cdFx0Y29uc29sZS53YXJuKFwiW0NoYW5nZWxvZ0NhY2hlXSBGYWlsZWQgdG8gc2F2ZSB2aWEgYXBwIGxvY2FsU3RvcmFnZVwiLCBlcnJvcik7XHJcblx0fVxyXG5cclxuXHRjb25zdCBzdG9yYWdlID0gZ2V0U3RvcmFnZSgpO1xyXG5cdGlmICghc3RvcmFnZSkge1xyXG5cdFx0cmV0dXJuO1xyXG5cdH1cclxuXHJcblx0dHJ5IHtcclxuXHRcdGlmICghY2FjaGUuc3RhYmxlICYmICFjYWNoZS5iZXRhKSB7XHJcblx0XHRcdHN0b3JhZ2UucmVtb3ZlSXRlbShTVE9SQUdFX0tFWSk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRzdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KGNhY2hlKSk7XHJcblx0fSBjYXRjaCAoZXJyb3IpIHtcclxuXHRcdGNvbnNvbGUud2FybihcIltDaGFuZ2Vsb2dDYWNoZV0gRmFpbGVkIHRvIHNhdmUgdmlhIHdpbmRvdyBsb2NhbFN0b3JhZ2VcIiwgZXJyb3IpO1xyXG5cdH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRDYWNoZWRDaGFuZ2Vsb2cgPSAoXHJcblx0dmVyc2lvbjogc3RyaW5nLFxyXG5cdGlzQmV0YTogYm9vbGVhbixcclxuXHRhcHA/OiBBcHAsXHJcbik6IENoYW5nZWxvZ0NhY2hlRW50cnkgfCBudWxsID0+IHtcclxuXHRjb25zdCBjYWNoZSA9IGxvYWRDYWNoZShhcHApO1xyXG5cdGNvbnN0IGNoYW5uZWwgPSBnZXRDaGFubmVsS2V5KGlzQmV0YSk7XHJcblx0Y29uc3QgZW50cnkgPSBjYWNoZVtjaGFubmVsXTtcclxuXHRpZiAoIWVudHJ5IHx8IGVudHJ5LnZlcnNpb24gIT09IHZlcnNpb24pIHtcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIGVudHJ5O1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldExhdGVzdENhY2hlZENoYW5nZWxvZyA9IChcclxuXHRpc0JldGE6IGJvb2xlYW4sXHJcblx0YXBwPzogQXBwLFxyXG4pOiBDaGFuZ2Vsb2dDYWNoZUVudHJ5IHwgbnVsbCA9PiB7XHJcblx0Y29uc3QgY2FjaGUgPSBsb2FkQ2FjaGUoYXBwKTtcclxuXHRjb25zdCBjaGFubmVsID0gZ2V0Q2hhbm5lbEtleShpc0JldGEpO1xyXG5cdHJldHVybiBjYWNoZVtjaGFubmVsXSA/PyBudWxsO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGNhY2hlQ2hhbmdlbG9nID0gKFxyXG5cdHZlcnNpb246IHN0cmluZyxcclxuXHRpc0JldGE6IGJvb2xlYW4sXHJcblx0ZGF0YTogUGljazxDaGFuZ2Vsb2dDYWNoZUVudHJ5LCBcIm1hcmtkb3duXCIgfCBcInNvdXJjZVVybFwiPixcclxuXHRhcHA/OiBBcHAsXHJcbik6IHZvaWQgPT4ge1xyXG5cdGNvbnN0IGNhY2hlID0gbG9hZENhY2hlKGFwcCk7XHJcblx0Y29uc3QgY2hhbm5lbCA9IGdldENoYW5uZWxLZXkoaXNCZXRhKTtcclxuXHRjYWNoZVtjaGFubmVsXSA9IHtcclxuXHRcdHZlcnNpb24sXHJcblx0XHRtYXJrZG93bjogZGF0YS5tYXJrZG93bixcclxuXHRcdHNvdXJjZVVybDogZGF0YS5zb3VyY2VVcmwsXHJcblx0XHR1cGRhdGVkQXQ6IERhdGUubm93KCksXHJcblx0fTtcclxuXHRzYXZlQ2FjaGUoY2FjaGUsIGFwcCk7XHJcbn07XHJcbiJdfQ==